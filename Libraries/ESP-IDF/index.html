
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://sitename.example/Libraries/ESP-IDF/">
      
      
        <link rel="prev" href="../Arduino%20BLE%20Libraries/">
      
      
        <link rel="next" href="../Telink/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>ESP IDF - OpenGlass Firmware Bluetooth Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather+Sans:300,300i,400,400i,700,700i%7CRed+Hat+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Merriweather Sans";--md-code-font:"Red Hat Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#uuid-type" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OpenGlass Firmware Bluetooth Documentation" class="md-header__button md-logo" aria-label="OpenGlass Firmware Bluetooth Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OpenGlass Firmware Bluetooth Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ESP IDF
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OpenGlass Firmware Bluetooth Documentation" class="md-nav__button md-logo" aria-label="OpenGlass Firmware Bluetooth Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    OpenGlass Firmware Bluetooth Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to MkDocs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Firmware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Firmware
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Libraries
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Libraries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Arduino%20BLE%20Libraries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arduino BLE Libraries
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ESP IDF
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ESP IDF
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#uuid-type" class="md-nav__link">
    <span class="md-ellipsis">
      UUID type
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_err_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_err_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_init" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_sec_cfg_t" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_sec_cfg_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_sec_scheme_t" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_sec_scheme_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_init_partition" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_init_partition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvspartitionmanagerinit_partition" class="md-nav__link">
    <span class="md-ellipsis">
      NVSPartitionManager::init_partition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvspartition" class="md-nav__link">
    <span class="md-ellipsis">
      NVSPartition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_partition_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_partition_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lookup_storage_from_name" class="md-nav__link">
    <span class="md-ellipsis">
      lookup_storage_from_name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_partition_get_main_flash_sector_size" class="md-nav__link">
    <span class="md-ellipsis">
      esp_partition_get_main_flash_sector_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvspartitionmanagerget_instance" class="md-nav__link">
    <span class="md-ellipsis">
      NVSPartitionManager::get_instance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lockinit" class="md-nav__link">
    <span class="md-ellipsis">
      Lock::init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_secure_init" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_secure_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_generate_keys_v2" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_generate_keys_v2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_read_security_cfg_v2" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_read_security_cfg_v2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_init_partition_1" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_init_partition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_controller_mem_release" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_controller_mem_release
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_mode_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_mode_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_controller_config_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_controller_config_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bt_controller_init_config_default" class="md-nav__link">
    <span class="md-ellipsis">
      BT_CONTROLLER_INIT_CONFIG_DEFAULT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_controller_init" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_controller_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_controller_enable" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_controller_enable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_status_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_status_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_get_status" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_get_status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_init" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_config_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_config_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bt_bluedroid_init_config_default" class="md-nav__link">
    <span class="md-ellipsis">
      BT_BLUEDROID_INIT_CONFIG_DEFAULT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_init_with_cfg" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_init_with_cfg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bluedroid_config_init" class="md-nav__link">
    <span class="md-ellipsis">
      bluedroid_config_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btc_init" class="md-nav__link">
    <span class="md-ellipsis">
      btc_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btc_main_get_future_p" class="md-nav__link">
    <span class="md-ellipsis">
      btc_main_get_future_p
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future_new" class="md-nav__link">
    <span class="md-ellipsis">
      future_new
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btc_msg" class="md-nav__link">
    <span class="md-ellipsis">
      btc_msg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btc_transfer_context" class="md-nav__link">
    <span class="md-ellipsis">
      btc_transfer_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future_await" class="md-nav__link">
    <span class="md-ellipsis">
      future_await
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_enable" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_enable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gap_register_callback" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gap_register_callback
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gattc_register_callback" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gattc_register_callback
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gap_set_device_name" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gap_set_device_name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gap_set_security_param" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gap_set_security_param
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_controller_get_status" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_controller_get_status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btdm_controller_status" class="md-nav__link">
    <span class="md-ellipsis">
      btdm_controller_status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_err_to_name" class="md-nav__link">
    <span class="md-ellipsis">
      esp_err_to_name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_app_register" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_app_register
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_create_service" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_create_service
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_gatt_char_prop_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_gatt_char_prop_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_attr_value_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_attr_value_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_set_attr_value" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_set_attr_value
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_start_service" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_start_service
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_attr_control_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_attr_control_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_gatt_perm_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_gatt_perm_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_add_char_descr" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_add_char_descr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_adv_data_type" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_adv_data_type
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_adv_params_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_adv_params_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_send_indicate" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_send_indicate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_gatt_status_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_gatt_status_t
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Telink/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Telink
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#uuid-type" class="md-nav__link">
    <span class="md-ellipsis">
      UUID type
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_err_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_err_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_init" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_sec_cfg_t" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_sec_cfg_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_sec_scheme_t" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_sec_scheme_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_init_partition" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_init_partition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvspartitionmanagerinit_partition" class="md-nav__link">
    <span class="md-ellipsis">
      NVSPartitionManager::init_partition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvspartition" class="md-nav__link">
    <span class="md-ellipsis">
      NVSPartition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_partition_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_partition_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lookup_storage_from_name" class="md-nav__link">
    <span class="md-ellipsis">
      lookup_storage_from_name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_partition_get_main_flash_sector_size" class="md-nav__link">
    <span class="md-ellipsis">
      esp_partition_get_main_flash_sector_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvspartitionmanagerget_instance" class="md-nav__link">
    <span class="md-ellipsis">
      NVSPartitionManager::get_instance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lockinit" class="md-nav__link">
    <span class="md-ellipsis">
      Lock::init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_secure_init" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_secure_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_generate_keys_v2" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_generate_keys_v2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_read_security_cfg_v2" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_read_security_cfg_v2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nvs_flash_init_partition_1" class="md-nav__link">
    <span class="md-ellipsis">
      nvs_flash_init_partition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_controller_mem_release" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_controller_mem_release
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_mode_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_mode_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_controller_config_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_controller_config_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bt_controller_init_config_default" class="md-nav__link">
    <span class="md-ellipsis">
      BT_CONTROLLER_INIT_CONFIG_DEFAULT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_controller_init" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_controller_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_controller_enable" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_controller_enable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_status_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_status_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_get_status" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_get_status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_init" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_config_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_config_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bt_bluedroid_init_config_default" class="md-nav__link">
    <span class="md-ellipsis">
      BT_BLUEDROID_INIT_CONFIG_DEFAULT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_init_with_cfg" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_init_with_cfg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bluedroid_config_init" class="md-nav__link">
    <span class="md-ellipsis">
      bluedroid_config_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btc_init" class="md-nav__link">
    <span class="md-ellipsis">
      btc_init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btc_main_get_future_p" class="md-nav__link">
    <span class="md-ellipsis">
      btc_main_get_future_p
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future_new" class="md-nav__link">
    <span class="md-ellipsis">
      future_new
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btc_msg" class="md-nav__link">
    <span class="md-ellipsis">
      btc_msg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btc_transfer_context" class="md-nav__link">
    <span class="md-ellipsis">
      btc_transfer_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future_await" class="md-nav__link">
    <span class="md-ellipsis">
      future_await
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bluedroid_enable" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bluedroid_enable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gap_register_callback" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gap_register_callback
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gattc_register_callback" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gattc_register_callback
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gap_set_device_name" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gap_set_device_name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gap_set_security_param" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gap_set_security_param
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_bt_controller_get_status" class="md-nav__link">
    <span class="md-ellipsis">
      esp_bt_controller_get_status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btdm_controller_status" class="md-nav__link">
    <span class="md-ellipsis">
      btdm_controller_status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_err_to_name" class="md-nav__link">
    <span class="md-ellipsis">
      esp_err_to_name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_app_register" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_app_register
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_create_service" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_create_service
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_gatt_char_prop_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_gatt_char_prop_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_attr_value_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_attr_value_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_set_attr_value" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_set_attr_value
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_start_service" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_start_service
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_attr_control_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_attr_control_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_gatt_perm_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_gatt_perm_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_add_char_descr" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_add_char_descr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_adv_data_type" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_adv_data_type
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_adv_params_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_adv_params_t
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_ble_gatts_send_indicate" class="md-nav__link">
    <span class="md-ellipsis">
      esp_ble_gatts_send_indicate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esp_gatt_status_t" class="md-nav__link">
    <span class="md-ellipsis">
      esp_gatt_status_t
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>ESP IDF</h1>

<h6 id="uuid-type">UUID type</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="cp">#define ESP_UUID_LEN_16     2</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="cp">#define ESP_UUID_LEN_32     4</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="cp">#define ESP_UUID_LEN_128    16</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w">                           </span><span class="cm">/* linked UUID length, 16bit, 32bit or 128bit */</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">        </span><span class="kt">uint16_t</span><span class="w">    </span><span class="n">uuid16</span><span class="p">;</span><span class="w">                 </span><span class="cm">/* linked 16bit UUID */</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">        </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">uuid32</span><span class="p">;</span><span class="w">                 </span><span class="cm">/* linked 32bit UUID */</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">        </span><span class="kt">uint8_t</span><span class="w">     </span><span class="n">uuid128</span><span class="p">[</span><span class="n">ESP_UUID_LEN_128</span><span class="p">];</span><span class="w"> </span><span class="cm">/* linked 128bit UUID */</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">uuid</span><span class="p">;</span><span class="w">                                 </span><span class="cm">/* linked UUID */</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="p">}</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">))</span><span class="w"> </span><span class="n">esp_bt_uuid_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="esp_err_t">esp_err_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">esp_err_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="nvs_flash_init">nvs_flash_init</h6>
<p><a href="./#nvs_sec_cfg_t">nvs_sec_cfg_t</a><br />
<a href="./#nvs_flash_read_security_cfg_v2">nvs_flash_read_security_cfg_v2</a><br />
<a href="./#nvs_sec_scheme_t">nvs_sec_scheme_t</a><br />
<a href="./#nvs_flash_generate_keys_v2">nvs_flash_generate_keys_v2</a><br />
<a href="./#nvs_flash_secure_init">nvs_flash_secure_init</a><br />
<a href="./#nvs_flash_init_partition">nvs_flash_init_partition</a></p>
<p>This API initialises the default NVS partition. The default NVS partition is the one that is labeled "nvs" in the partition table.</p>
<p>When "NVS_ENCRYPTION" is enabled in the menuconfig, this API enables the NVS encryption for the default NVS partition as follows</p>
<ol>
<li>
<p>Read security configurations from the first NVS key partition listed in the partition table. (NVS key partition is any "data" type partition which has the subtype value set to "nvs_keys")</p>
</li>
<li>
<p>If the NVS key partition obtained in the previous step is empty, generate and store new keys in that NVS key partition.</p>
</li>
<li>
<p>Internally call "nvs_flash_secure_init()" with the security configurations obtained/generated in the previous steps.
<div class="language-c highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">nvs_flash_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="cp">#ifdef CONFIG_NVS_ENCRYPTION</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="n">nvs_sec_cfg_t</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">//[nvs_sec_cfg_t](ESP-IDF.md/#nvs_sec_cfg_t)</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvs_flash_read_security_cfg_v2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nvs_sec_default_scheme_cfg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cfg</span><span class="p">);</span><span class="c1">//[nvs_flash_read_security_cfg_v2](ESP-IDF.md/#nvs_flash_read_security_cfg_v2) and static [nvs_sec_scheme_t](ESP-IDF.md/#nvs_sec_scheme_t) nvs_sec_default_scheme_cfg;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="n">ESP_LOGW</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Failed to read NVS security cfg: [0x%02X] (%s)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">esp_err_to_name</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Generating NVS encr-keys...&quot;</span><span class="p">);</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvs_flash_generate_keys_v2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nvs_sec_default_scheme_cfg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cfg</span><span class="p">);</span><span class="w"> </span><span class="c1">//[nvs_flash_generate_keys_v2](ESP-IDF.md/#nvs_flash_generate_keys_v2)</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">            </span><span class="n">ESP_LOGE</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Failed to generate NVS encr-keys: [0x%02X] (%s)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">esp_err_to_name</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvs_flash_secure_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cfg</span><span class="p">);</span><span class="w"> </span><span class="c1">//[nvs_flash_secure_init](ESP-IDF.md/#nvs_flash_secure_init)</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_ERR_NVS_NO_FREE_PAGES</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">        </span><span class="n">ESP_LOGE</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Failed to initialize NVS partition: [0x%02X] (%s)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">esp_err_to_name</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">    </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NVS partition </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s"> is encrypted.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">NVS_DEFAULT_PART_NAME</span><span class="p">);</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="cp">#else </span><span class="c1">// CONFIG_NVS_ENCRYPTION</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">nvs_flash_init_partition</span><span class="p">(</span><span class="n">NVS_DEFAULT_PART_NAME</span><span class="p">);</span><span class="w"> </span><span class="c1">//[nvs_flash_init_partition](ESP-IDF.md/#nvs_flash_init_partition)</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="cp">#endif</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ol>
<h6 id="nvs_sec_cfg_t">nvs_sec_cfg_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">eky</span><span class="p">[</span><span class="n">NVS_KEY_SIZE</span><span class="p">];</span><span class="w"> </span><span class="cm">/* linked  XTS encryption and decryption key*/</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">tky</span><span class="p">[</span><span class="n">NVS_KEY_SIZE</span><span class="p">];</span><span class="w"> </span><span class="cm">/* linked  XTS tweak key */</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="p">}</span><span class="w"> </span><span class="n">nvs_sec_cfg_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="nvs_sec_scheme_t">nvs_sec_scheme_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">scheme_id</span><span class="p">;</span><span class="w">                                </span><span class="cm">/* linked  Security Scheme ID (E.g. HMAC) */</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">scheme_data</span><span class="p">;</span><span class="w">                            </span><span class="cm">/* linked  Scheme-specific data (E.g. eFuse block for HMAC-based key generation) */</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="n">nvs_flash_generate_keys_t</span><span class="w"> </span><span class="n">nvs_flash_key_gen</span><span class="p">;</span><span class="w">  </span><span class="cm">/* linked  Callback for the nvs_flash_key_gen implementation */</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="n">nvs_flash_read_cfg_t</span><span class="w"> </span><span class="n">nvs_flash_read_cfg</span><span class="p">;</span><span class="w">      </span><span class="cm">/* linked  Callback for the nvs_flash_read_keys implementation */</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="p">}</span><span class="w"> </span><span class="n">nvs_sec_scheme_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="nvs_flash_init_partition">nvs_flash_init_partition</h6>
<p><a href="./#lockinit">Lock-init</a><br />
<a href="./#nvspartitionmanagerget_instance">NVSPartitionManager-get_instance</a><br />
<a href="./#nvspartitionmanagerinit_partition">NVSPartitionManager-init_partition</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">nvs_flash_init_partition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">part_name</span><span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">lock_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Lock</span><span class="o">::</span><span class="n">init</span><span class="p">();</span><span class="w"> </span><span class="c1">//[Lock-init](ESP-IDF.md/#lock-init)</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lock_result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lock_result</span><span class="p">;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="n">Lock</span><span class="w"> </span><span class="n">lock</span><span class="p">;</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">nvs</span><span class="o">::</span><span class="n">Page</span><span class="o">::</span><span class="n">SEC_SIZE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">esp_partition_get_main_flash_sector_size</span><span class="p">());</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NVSPartitionManager</span><span class="o">::</span><span class="n">get_instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">init_partition</span><span class="p">(</span><span class="n">part_name</span><span class="p">);</span><span class="w"> </span><span class="c1">//[NVSPartitionManager-get_instance](ESP-IDF.md/#nvspartitionmanager-get_instance) and [NVSPartitionManager-init_partition](ESP-IDF.md/#nvspartitionmanager-init_partition)</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="nvspartitionmanagerinit_partition">NVSPartitionManager::init_partition</h6>
<p><a href="./#esp_partition_get_main_flash_sector_size">esp_partition_get_main_flash_sector_size</a><br />
<a href="./#lookup_storage_from_name">lookup_storage_from_name</a><br />
<a href="./#nvspartition">NVSPartition</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">NVSPartitionManager::init_partition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">partition_label</span><span class="p">)</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">partition_label</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">NVS_PART_NAME_MAX_SIZE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">sec_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_partition_get_main_flash_sector_size</span><span class="p">();</span><span class="w"> </span><span class="c1">//[esp_partition_get_main_flash_sector_size](ESP-IDF.md/#esp_partition_get_main_flash_sector_size)</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="n">Storage</span><span class="o">*</span><span class="w"> </span><span class="n">mStorage</span><span class="p">;</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">    </span><span class="n">mStorage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lookup_storage_from_name</span><span class="p">(</span><span class="n">partition_label</span><span class="p">);</span><span class="w"> </span><span class="c1">//[lookup_storage_from_name](ESP-IDF.md/#lookup_storage_from_name)</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mStorage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">;</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span><span class="n">NVS_ASSERT_OR_RETURN</span><span class="p">(</span><span class="n">sec_size</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">);</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">    </span><span class="n">NVSPartition</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">//[NVSPartition](ESP-IDF.md/#nvspartition)</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">partition_lookup</span><span class="o">::</span><span class="n">lookup_nvs_partition</span><span class="p">(</span><span class="n">partition_label</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="w">    </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">get_size</span><span class="p">();</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_custom</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sec_size</span><span class="p">);</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">    </span><span class="n">nvs_partition_list</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">;</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="nl">error</span><span class="p">:</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="nvspartition">NVSPartition</h6>
<p><a href="./#esp_partition_t">esp_partition_t</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">NVSPartition</span><span class="o">::</span><span class="n">NVSPartition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">esp_partition_t</span><span class="o">*</span><span class="w"> </span><span class="n">partition</span><span class="p">)</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">mESPPartition</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span><span class="w"> </span><span class="c1">//const [esp_partition_t](ESP-IDF.md/#esp_partition_t)* mESPPartition;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="p">{</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="c1">// ensure the class is in a valid state</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">abort</span><span class="p">();</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_partition_t">esp_partition_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="n">esp_flash_t</span><span class="o">*</span><span class="w"> </span><span class="n">flash_chip</span><span class="p">;</span><span class="w">            </span><span class="cm">/* linked SPI flash chip on which the partition resides */</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="n">esp_partition_type_t</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w">          </span><span class="cm">/* linked partition type (app/data) */</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="n">esp_partition_subtype_t</span><span class="w"> </span><span class="n">subtype</span><span class="p">;</span><span class="w">    </span><span class="cm">/* linked partition subtype */</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">address</span><span class="p">;</span><span class="w">                   </span><span class="cm">/* linked starting address of the partition in flash */</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w">                      </span><span class="cm">/* linked size of the partition, in bytes */</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">erase_size</span><span class="p">;</span><span class="w">                </span><span class="cm">/* linked size the erase operation should be aligned to */</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">label</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span><span class="w">                     </span><span class="cm">/* linked partition label, zero-terminated ASCII string */</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">encrypted</span><span class="p">;</span><span class="w">                     </span><span class="cm">/* linked flag is set to true if partition is encrypted */</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">readonly</span><span class="p">;</span><span class="w">                      </span><span class="cm">/* linked flag is set to true if partition is read-only */</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="p">}</span><span class="w"> </span><span class="n">esp_partition_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="lookup_storage_from_name">lookup_storage_from_name</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">static</span><span class="w"> </span><span class="n">nvs</span><span class="o">::</span><span class="n">Storage</span><span class="o">*</span><span class="w"> </span><span class="nf">lookup_storage_from_name</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="p">{</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NVSPartitionManager</span><span class="o">::</span><span class="n">get_instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">lookup_storage_from_name</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="esp_partition_get_main_flash_sector_size">esp_partition_get_main_flash_sector_size</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="nf">esp_partition_get_main_flash_sector_size</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="p">{</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SPI_FLASH_SEC_SIZE</span><span class="p">;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="nvspartitionmanagerget_instance">NVSPartitionManager::get_instance</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">NVSPartitionManager</span><span class="o">*</span><span class="w"> </span><span class="nf">NVSPartitionManager::get_instance</span><span class="p">()</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="p">{</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">        </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">nothrow</span><span class="p">)</span><span class="w"> </span><span class="n">NVSPartitionManager</span><span class="p">();</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="lockinit">Lock::init</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">Lock::init</span><span class="p">()</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="p">{</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="c1">// Let postpone initialization to the Lock::Lock.</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="c1">// It is designed to lazy initialize the semaphore in a properly guarded critical section</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">;</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="nvs_flash_secure_init">nvs_flash_secure_init</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">nvs_flash_secure_init_partition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">part_name</span><span class="p">,</span><span class="w"> </span><span class="n">nvs_sec_cfg_t</span><span class="o">*</span><span class="w"> </span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="p">{</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">lock_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Lock</span><span class="o">::</span><span class="n">init</span><span class="p">();</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lock_result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lock_result</span><span class="p">;</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="n">Lock</span><span class="w"> </span><span class="n">lock</span><span class="p">;</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">nvs</span><span class="o">::</span><span class="n">Page</span><span class="o">::</span><span class="n">SEC_SIZE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">esp_partition_get_main_flash_sector_size</span><span class="p">());</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NVSPartitionManager</span><span class="o">::</span><span class="n">get_instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">secure_init_partition</span><span class="p">(</span><span class="n">part_name</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">);</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="p">}</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">nvs_flash_secure_init</span><span class="p">(</span><span class="n">nvs_sec_cfg_t</span><span class="o">*</span><span class="w"> </span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="p">{</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">nvs_flash_secure_init_partition</span><span class="p">(</span><span class="n">NVS_DEFAULT_PART_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">);</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="nvs_flash_generate_keys_v2">nvs_flash_generate_keys_v2</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">nvs_flash_generate_keys_v2</span><span class="p">(</span><span class="n">nvs_sec_scheme_t</span><span class="w"> </span><span class="o">*</span><span class="n">scheme_cfg</span><span class="p">,</span><span class="w"> </span><span class="n">nvs_sec_cfg_t</span><span class="o">*</span><span class="w"> </span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="p">{</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scheme_cfg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">scheme_cfg</span><span class="o">-&gt;</span><span class="n">nvs_flash_key_gen</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">scheme_cfg</span><span class="o">-&gt;</span><span class="n">nvs_flash_key_gen</span><span class="p">)(</span><span class="n">scheme_cfg</span><span class="o">-&gt;</span><span class="n">scheme_data</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">);</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="nvs_flash_read_security_cfg_v2">nvs_flash_read_security_cfg_v2</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">nvs_flash_read_security_cfg_v2</span><span class="p">(</span><span class="n">nvs_sec_scheme_t</span><span class="w"> </span><span class="o">*</span><span class="n">scheme_cfg</span><span class="p">,</span><span class="w"> </span><span class="n">nvs_sec_cfg_t</span><span class="o">*</span><span class="w"> </span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="p">{</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scheme_cfg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">scheme_cfg</span><span class="o">-&gt;</span><span class="n">nvs_flash_read_cfg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">scheme_cfg</span><span class="o">-&gt;</span><span class="n">nvs_flash_read_cfg</span><span class="p">)(</span><span class="n">scheme_cfg</span><span class="o">-&gt;</span><span class="n">scheme_data</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">);</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="nvs_flash_init_partition_1">nvs_flash_init_partition</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">nvs_flash_init_partition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">part_name</span><span class="p">)</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="p">{</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">lock_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Lock</span><span class="o">::</span><span class="n">init</span><span class="p">();</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lock_result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lock_result</span><span class="p">;</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="n">Lock</span><span class="w"> </span><span class="n">lock</span><span class="p">;</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">nvs</span><span class="o">::</span><span class="n">Page</span><span class="o">::</span><span class="n">SEC_SIZE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">esp_partition_get_main_flash_sector_size</span><span class="p">());</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NVSPartitionManager</span><span class="o">::</span><span class="n">get_instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">init_partition</span><span class="p">(</span><span class="n">part_name</span><span class="p">);</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="esp_bt_controller_mem_release">esp_bt_controller_mem_release</h6>
<p><a href="../Telink/#memory-allocation">Memory Allocation</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_bt_controller_mem_release</span><span class="p">(</span><span class="n">esp_bt_mode_t</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="c1">//[Memory Allocation](Telink.md/#memory-allocation)</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="p">{</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">;</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">btdm_controller_status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_IDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_STATE</span><span class="p">;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BT_MODE_BTDM</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">        </span><span class="n">bt_area_t</span><span class="w"> </span><span class="n">cont_bss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">            </span><span class="p">.</span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">intptr_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">_bt_controller_bss_start</span><span class="p">,</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">            </span><span class="p">.</span><span class="n">end</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">intptr_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">_bt_controller_bss_end</span><span class="p">,</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">            </span><span class="p">.</span><span class="n">name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BT Controller BSS&quot;</span><span class="p">,</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">        </span><span class="n">bt_area_t</span><span class="w"> </span><span class="n">cont_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">            </span><span class="p">.</span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">intptr_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">_bt_controller_data_start</span><span class="p">,</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">            </span><span class="p">.</span><span class="n">end</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">intptr_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">_bt_controller_data_end</span><span class="p">,</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">            </span><span class="p">.</span><span class="n">name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BT Controller Data&quot;</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_bt_mem_release_areas</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cont_data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cont_bss</span><span class="p">);</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_bt_controller_rom_mem_release</span><span class="p">(</span><span class="n">mode</span><span class="p">);</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_bt_mode_t">esp_bt_mode_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="n">ESP_BT_MODE_IDLE</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w">   </span><span class="cm">/* linked Bluetooth is not operating. */</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="n">ESP_BT_MODE_BLE</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w">   </span><span class="cm">/* linked Bluetooth is operating in BLE mode. */</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">    </span><span class="n">ESP_BT_MODE_CLASSIC_BT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x02</span><span class="p">,</span><span class="w">   </span><span class="cm">/* linked Bluetooth is operating in Classic Bluetooth mode. */</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">    </span><span class="n">ESP_BT_MODE_BTDM</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">0x03</span><span class="p">,</span><span class="w">   </span><span class="cm">/* linked Bluetooth is operating in Dual mode. */</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="p">}</span><span class="w"> </span><span class="n">esp_bt_mode_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="esp_bt_controller_config_t">esp_bt_controller_config_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">controller_task_stack_size</span><span class="p">;</span><span class="w">    </span><span class="cm">/* linked Bluetooth Controller task stack size in bytes */</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">controller_task_prio</span><span class="p">;</span><span class="w">           </span><span class="cm">/* linked Bluetooth Controller task priority */</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">hci_uart_no</span><span class="p">;</span><span class="w">                    </span><span class="cm">/* linked UART number as HCI I/O interface. Configurable in menuconfig.</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="cm">                                                - 1 - URAT 1 (default)</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="cm">                                                - 2 - URAT 2 */</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">hci_uart_baudrate</span><span class="p">;</span><span class="w">             </span><span class="cm">/* linked  UART baudrate. Configurable in menuconfig.</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="cm">                                                - Range: 115200 - 921600</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="cm">                                                - Default: 921600 */</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">scan_duplicate_mode</span><span class="p">;</span><span class="w">            </span><span class="cm">/* linked Scan duplicate filtering mode. Configurable in menuconfig.</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="cm">                                                - 0 - Normal scan duplicate filtering mode (default)</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="cm">                                                - 1 - Special scan duplicate filtering mode for BLE Mesh */</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">scan_duplicate_type</span><span class="p">;</span><span class="w">            </span><span class="cm">/* linked Scan duplicate filtering type. If `scan_duplicate_mode` is set to 1, this parameter will be ignored. Configurable in menuconfig.</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="cm">                                                - 0 - Filter scan duplicates by device address only (default)</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="cm">                                                - 1 - Filter scan duplicates by advertising data only, even if they originate from different devices.</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="cm">                                                - 2 - Filter scan duplicated by device address and advertising data. */</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">normal_adv_size</span><span class="p">;</span><span class="w">               </span><span class="cm">/* linked Maximum number of devices in scan duplicate filtering list. Configurable in menuconfig</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="cm">                                                - Range: 10 - 1000</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="cm">                                                - Default: 100 */</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">mesh_adv_size</span><span class="p">;</span><span class="w">                 </span><span class="cm">/* linked Maximum number of Mesh advertising packets in scan duplicate filtering list. Configurable in menuconfig</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="cm">                                                - Range: 10 - 1000</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="cm">                                                - Default: 100 */</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">send_adv_reserved_size</span><span class="p">;</span><span class="w">        </span><span class="cm">/* linked Controller minimum memory value in bytes. Internal use only */</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w">  </span><span class="n">controller_debug_flag</span><span class="p">;</span><span class="w">        </span><span class="cm">/* linked Controller debug log flag. Internal use only */</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">mode</span><span class="p">;</span><span class="w">                           </span><span class="cm">/* linked Controller mode.  Configurable in menuconfig</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="cm">                                                - 1 - BLE mode</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="cm">                                                - 2 - Classic Bluetooth mode</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="cm">                                                - 3 - Dual mode</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="cm">                                                - 4 - Others: Invalid */</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">ble_max_conn</span><span class="p">;</span><span class="w">                   </span><span class="cm">/* linked Maximum number of BLE connections. Configurable in menuconfig</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="cm">                                                - Range: 1 - 9</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="cm">                                                - Default: 3 */</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">bt_max_acl_conn</span><span class="p">;</span><span class="w">                </span><span class="cm">/* linked Maximum number of BR/EDR ACL connections. Configurable in menuconfig</span>
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a><span class="cm">                                                - Range: 1 - 7</span>
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a><span class="cm">                                                - Default: 2 */</span>
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">bt_sco_datapath</span><span class="p">;</span><span class="w">                </span><span class="cm">/* linked SCO data path. Configurable in menuconfig</span>
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a><span class="cm">                                                - 0 - HCI module (default)</span>
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a><span class="cm">                                                - 1 - PCM module */</span>
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">auto_latency</span><span class="p">;</span><span class="w">                      </span><span class="cm">/* linked True if BLE auto latency is enabled, used to enhance Classic Bluetooth performance in the Dual mode; false otherwise (default). Configurable in menuconfig */</span>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bt_legacy_auth_vs_evt</span><span class="p">;</span><span class="w">             </span><span class="cm">/* linked True if BR/EDR Legacy Authentication Vendor Specific Event is enabled (default in the classic bluetooth or Dual mode), which is required to protect from BIAS attack; false otherwise. Configurable in menuconfig */</span>
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">bt_max_sync_conn</span><span class="p">;</span><span class="w">               </span><span class="cm">/* linked Maximum number of BR/EDR synchronous connections. Configurable in menuconfig</span>
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a><span class="cm">                                                - Range: 0 - 3</span>
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a><span class="cm">                                                - Default: 0 */</span>
</span><span id="__span-19-44"><a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">ble_sca</span><span class="p">;</span><span class="w">                        </span><span class="cm">/* linked BLE low power crystal accuracy index. Configurable in menuconfig</span>
</span><span id="__span-19-45"><a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a><span class="cm">                                                - 0 - `BTDM_BLE_DEFAULT_SCA_500PPM`</span>
</span><span id="__span-19-46"><a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a><span class="cm">                                                - 1 - `BTDM_BLE_DEFAULT_SCA_250PPM` (default) */</span>
</span><span id="__span-19-47"><a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">pcm_role</span><span class="p">;</span><span class="w">                       </span><span class="cm">/* linked PCM role. Configurable in menuconfig</span>
</span><span id="__span-19-48"><a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a><span class="cm">                                                - 0 - PCM master (default)</span>
</span><span id="__span-19-49"><a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a><span class="cm">                                                - 1 - PCM slave (default) */</span>
</span><span id="__span-19-50"><a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">pcm_polar</span><span class="p">;</span><span class="w">                      </span><span class="cm">/* linked PCM polarity (falling clk edge &amp; rising clk edge). Configurable in menuconfig</span>
</span><span id="__span-19-51"><a id="__codelineno-19-51" name="__codelineno-19-51" href="#__codelineno-19-51"></a><span class="cm">                                                - 0 - Falling Edge (default)</span>
</span><span id="__span-19-52"><a id="__codelineno-19-52" name="__codelineno-19-52" href="#__codelineno-19-52"></a><span class="cm">                                                - 1 - Rising Edge */</span>
</span><span id="__span-19-53"><a id="__codelineno-19-53" name="__codelineno-19-53" href="#__codelineno-19-53"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">pcm_fsyncshp</span><span class="p">;</span><span class="w">                   </span><span class="cm">/* linked Physical shape of the PCM Frame Synchronization signal. Configurable in menuconfig</span>
</span><span id="__span-19-54"><a id="__codelineno-19-54" name="__codelineno-19-54" href="#__codelineno-19-54"></a><span class="cm">                                                - 0 - Stereo Mode (default)</span>
</span><span id="__span-19-55"><a id="__codelineno-19-55" name="__codelineno-19-55" href="#__codelineno-19-55"></a><span class="cm">                                                - 1 - Mono Mode 1</span>
</span><span id="__span-19-56"><a id="__codelineno-19-56" name="__codelineno-19-56" href="#__codelineno-19-56"></a><span class="cm">                                                - 2 - Mono Mode 2 */</span>
</span><span id="__span-19-57"><a id="__codelineno-19-57" name="__codelineno-19-57" href="#__codelineno-19-57"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">hli</span><span class="p">;</span><span class="w">                               </span><span class="cm">/* linked True if using high-level (level 4) interrupt (default); false otherwise. Configurable in menuconfig */</span>
</span><span id="__span-19-58"><a id="__codelineno-19-58" name="__codelineno-19-58" href="#__codelineno-19-58"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">enc_key_sz_min</span><span class="p">;</span><span class="w">                 </span><span class="cm">/* linked Minimum size of the encryption key</span>
</span><span id="__span-19-59"><a id="__codelineno-19-59" name="__codelineno-19-59" href="#__codelineno-19-59"></a><span class="cm">                                                - Range: 7 - 16</span>
</span><span id="__span-19-60"><a id="__codelineno-19-60" name="__codelineno-19-60" href="#__codelineno-19-60"></a><span class="cm">                                                - Default: 7 */</span>
</span><span id="__span-19-61"><a id="__codelineno-19-61" name="__codelineno-19-61" href="#__codelineno-19-61"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">dup_list_refresh_period</span><span class="p">;</span><span class="w">       </span><span class="cm">/* linked Scan duplicate filtering list refresh period in seconds. Configurable in menuconfig</span>
</span><span id="__span-19-62"><a id="__codelineno-19-62" name="__codelineno-19-62" href="#__codelineno-19-62"></a><span class="cm">                                                - Range: 0 - 100 seconds</span>
</span><span id="__span-19-63"><a id="__codelineno-19-63" name="__codelineno-19-63" href="#__codelineno-19-63"></a><span class="cm">                                                - Default: 0 second */</span>
</span><span id="__span-19-64"><a id="__codelineno-19-64" name="__codelineno-19-64" href="#__codelineno-19-64"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">ble_scan_backoff</span><span class="p">;</span><span class="w">                  </span><span class="cm">/* linked True if BLE scan backoff is enabled; false otherwise (default). Configurable in menuconfig */</span>
</span><span id="__span-19-65"><a id="__codelineno-19-65" name="__codelineno-19-65" href="#__codelineno-19-65"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">ble_llcp_disc_flag</span><span class="p">;</span><span class="w">             </span><span class="cm">/* linked Flag indicating whether the Controller disconnects after Instant Passed (0x28) error occurs. Configurable in menuconfig.</span>
</span><span id="__span-19-66"><a id="__codelineno-19-66" name="__codelineno-19-66" href="#__codelineno-19-66"></a><span class="cm">                                                - The Controller does not disconnect after Instant Passed (0x28) by default. */</span>
</span><span id="__span-19-67"><a id="__codelineno-19-67" name="__codelineno-19-67" href="#__codelineno-19-67"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">ble_aa_check</span><span class="p">;</span><span class="w">                      </span><span class="cm">/* linked True if adds a verification step for the Access Address within the `CONNECT_IND` PDU; false otherwise (default). Configurable in menuconfig */</span>
</span><span id="__span-19-68"><a id="__codelineno-19-68" name="__codelineno-19-68" href="#__codelineno-19-68"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">ble_chan_ass_en</span><span class="p">;</span><span class="w">                </span><span class="cm">/* linked True if BLE channel assessment is enabled (default), false otherwise. Configurable in menuconfig */</span>
</span><span id="__span-19-69"><a id="__codelineno-19-69" name="__codelineno-19-69" href="#__codelineno-19-69"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">ble_ping_en</span><span class="p">;</span><span class="w">                    </span><span class="cm">/* linked True if BLE ping procedure is enabled (default), false otherwise. Configurable in menuconfig */</span>
</span><span id="__span-19-70"><a id="__codelineno-19-70" name="__codelineno-19-70" href="#__codelineno-19-70"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">magic</span><span class="p">;</span><span class="w">                         </span><span class="cm">/* linked Magic number */</span>
</span><span id="__span-19-71"><a id="__codelineno-19-71" name="__codelineno-19-71" href="#__codelineno-19-71"></a><span class="p">}</span><span class="w"> </span><span class="n">esp_bt_controller_config_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="bt_controller_init_config_default">BT_CONTROLLER_INIT_CONFIG_DEFAULT</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="cp">#define BT_CONTROLLER_INIT_CONFIG_DEFAULT() {                              \</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="cp">    .controller_task_stack_size = ESP_TASK_BT_CONTROLLER_STACK,            \</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="cp">    .controller_task_prio = ESP_TASK_BT_CONTROLLER_PRIO,                   \</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="cp">    .hci_uart_no = BT_HCI_UART_NO_DEFAULT,                                 \</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="cp">    .hci_uart_baudrate = BT_HCI_UART_BAUDRATE_DEFAULT,                     \</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="cp">    .scan_duplicate_mode = SCAN_DUPLICATE_MODE,                            \</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="cp">    .scan_duplicate_type = SCAN_DUPLICATE_TYPE_VALUE,                      \</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="cp">    .normal_adv_size = NORMAL_SCAN_DUPLICATE_CACHE_SIZE,                   \</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="cp">    .mesh_adv_size = MESH_DUPLICATE_SCAN_CACHE_SIZE,                       \</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="cp">    .send_adv_reserved_size = SCAN_SEND_ADV_RESERVED_SIZE,                 \</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="cp">    .controller_debug_flag = BTDM_CTRL_CONTROLLER_DEBUG_FLAG,              \</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="cp">    .mode = BTDM_CONTROLLER_MODE_EFF,                                      \</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="cp">    .ble_max_conn = CONFIG_BTDM_CTRL_BLE_MAX_CONN_EFF,                     \</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="cp">    .bt_max_acl_conn = CONFIG_BTDM_CTRL_BR_EDR_MAX_ACL_CONN_EFF,           \</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="cp">    .bt_sco_datapath = CONFIG_BTDM_CTRL_BR_EDR_SCO_DATA_PATH_EFF,          \</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="cp">    .auto_latency = BTDM_CTRL_AUTO_LATENCY_EFF,                            \</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="cp">    .bt_legacy_auth_vs_evt = BTDM_CTRL_LEGACY_AUTH_VENDOR_EVT_EFF,         \</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="cp">    .bt_max_sync_conn = CONFIG_BTDM_CTRL_BR_EDR_MAX_SYNC_CONN_EFF,         \</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="cp">    .ble_sca = CONFIG_BTDM_BLE_SLEEP_CLOCK_ACCURACY_INDEX_EFF,             \</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="cp">    .pcm_role = CONFIG_BTDM_CTRL_PCM_ROLE_EFF,                             \</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="cp">    .pcm_polar = CONFIG_BTDM_CTRL_PCM_POLAR_EFF,                           \</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="cp">    .pcm_fsyncshp = CONFIG_BTDM_CTRL_PCM_FSYNCSHP_EFF,                     \</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="cp">    .hli = BTDM_CTRL_HLI,                                                  \</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="cp">    .enc_key_sz_min = CONFIG_BTDM_CTRL_BR_EDR_MIN_ENC_KEY_SZ_DFT_EFF,      \</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="cp">    .dup_list_refresh_period = SCAN_DUPL_CACHE_REFRESH_PERIOD,             \</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="cp">    .ble_scan_backoff = BTDM_CTRL_SCAN_BACKOFF_UPPERLIMITMAX,              \</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="cp">    .ble_llcp_disc_flag = BTDM_BLE_LLCP_DISC_FLAG,                         \</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="cp">    .ble_aa_check = BTDM_CTRL_CHECK_CONNECT_IND_ACCESS_ADDRESS_ENABLED,    \</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="cp">    .ble_chan_ass_en = BTDM_BLE_CHAN_ASS_EN,                               \</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="cp">    .ble_ping_en = BTDM_BLE_PING_EN,                                       \</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="cp">    .magic = ESP_BT_CONTROLLER_CONFIG_MAGIC_VAL,                           \</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="cp">}</span>
</span></code></pre></div>
<h6 id="esp_bt_controller_init">esp_bt_controller_init</h6>
<p><a href="../Telink/#controller-init">Controller Init</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_bt_controller_init</span><span class="p">(</span><span class="n">esp_bt_controller_config_t</span><span class="w"> </span><span class="o">*</span><span class="n">cfg</span><span class="p">)</span><span class="w"> </span><span class="c1">//[Controller Init](Telink.md/#controller-init)</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="p">{</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">btdm_cfg_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="cp">#if CONFIG_BTDM_CTRL_HLI</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="n">hli_queue_setup_pinned_to_core</span><span class="p">(</span><span class="n">CONFIG_BTDM_CTRL_PINNED_TO_CORE</span><span class="p">);</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="cp">#endif </span><span class="cm">/* CONFIG_BTDM_CTRL_HLI */</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">    </span><span class="c1">//if all the bt available memory was already released, cannot initialize bluetooth controller</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">btdm_dram_available_region</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BT_MODE_IDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_STATE</span><span class="p">;</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">    </span><span class="n">osi_funcs_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">osi_funcs_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc_internal_wrapper</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">osi_funcs_t</span><span class="p">));</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">osi_funcs_p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_NO_MEM</span><span class="p">;</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">osi_funcs_p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">osi_funcs_ro</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">osi_funcs_t</span><span class="p">));</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">btdm_osi_funcs_register</span><span class="p">(</span><span class="n">osi_funcs_p</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">btdm_controller_status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_IDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_STATE</span><span class="p">;</span>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cfg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a>
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">controller_task_prio</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_TASK_BT_CONTROLLER_PRIO</span>
</span><span id="__span-21-34"><a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="w">            </span><span class="o">||</span><span class="w"> </span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">controller_task_stack_size</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ESP_TASK_BT_CONTROLLER_STACK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-35"><a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-21-36"><a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-37"><a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>
</span><span id="__span-21-38"><a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a><span class="w">    </span><span class="c1">//overwrite some parameters</span>
</span><span id="__span-21-39"><a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a><span class="w">    </span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">bt_max_sync_conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CONFIG_BTDM_CTRL_BR_EDR_MAX_SYNC_CONN_EFF</span><span class="p">;</span>
</span><span id="__span-21-40"><a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="w">    </span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">magic</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_CONFIG_MAGIC_VAL</span><span class="p">;</span>
</span><span id="__span-21-41"><a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a>
</span><span id="__span-21-42"><a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(((</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">mode</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ESP_BT_MODE_BLE</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">ble_max_conn</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">ble_max_conn</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">BTDM_CONTROLLER_BLE_MAX_CONN_LIMIT</span><span class="p">))</span>
</span><span id="__span-21-43"><a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a><span class="w">            </span><span class="o">||</span><span class="w"> </span><span class="p">((</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">mode</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ESP_BT_MODE_CLASSIC_BT</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">bt_max_acl_conn</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">bt_max_acl_conn</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">BTDM_CONTROLLER_BR_EDR_MAX_ACL_CONN_LIMIT</span><span class="p">))</span>
</span><span id="__span-21-44"><a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="w">            </span><span class="o">||</span><span class="w"> </span><span class="p">((</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">mode</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ESP_BT_MODE_CLASSIC_BT</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">bt_max_sync_conn</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">BTDM_CONTROLLER_BR_EDR_MAX_SYNC_CONN_LIMIT</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-45"><a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-21-46"><a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-47"><a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a>
</span><span id="__span-21-48"><a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a><span class="w">    </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">BTDM_LOG_TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;BT controller compile version [%s]&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">btdm_controller_get_compile_version</span><span class="p">());</span>
</span><span id="__span-21-49"><a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a>
</span><span id="__span-21-50"><a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a><span class="w">    </span><span class="n">s_wakeup_req_sem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">semphr_create_wrapper</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-21-51"><a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">s_wakeup_req_sem</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-52"><a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a><span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_ERR_NO_MEM</span><span class="p">;</span>
</span><span id="__span-21-53"><a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
</span><span id="__span-21-54"><a id="__codelineno-21-54" name="__codelineno-21-54" href="#__codelineno-21-54"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-55"><a id="__codelineno-21-55" name="__codelineno-21-55" href="#__codelineno-21-55"></a>
</span><span id="__span-21-56"><a id="__codelineno-21-56" name="__codelineno-21-56" href="#__codelineno-21-56"></a><span class="w">    </span><span class="n">esp_phy_modem_init</span><span class="p">();</span>
</span><span id="__span-21-57"><a id="__codelineno-21-57" name="__codelineno-21-57" href="#__codelineno-21-57"></a>
</span><span id="__span-21-58"><a id="__codelineno-21-58" name="__codelineno-21-58" href="#__codelineno-21-58"></a><span class="w">    </span><span class="n">esp_bt_power_domain_on</span><span class="p">();</span>
</span><span id="__span-21-59"><a id="__codelineno-21-59" name="__codelineno-21-59" href="#__codelineno-21-59"></a>
</span><span id="__span-21-60"><a id="__codelineno-21-60" name="__codelineno-21-60" href="#__codelineno-21-60"></a><span class="w">    </span><span class="n">btdm_controller_mem_init</span><span class="p">();</span>
</span><span id="__span-21-61"><a id="__codelineno-21-61" name="__codelineno-21-61" href="#__codelineno-21-61"></a>
</span><span id="__span-21-62"><a id="__codelineno-21-62" name="__codelineno-21-62" href="#__codelineno-21-62"></a><span class="w">    </span><span class="n">periph_module_enable</span><span class="p">(</span><span class="n">PERIPH_BT_MODULE</span><span class="p">);</span>
</span><span id="__span-21-63"><a id="__codelineno-21-63" name="__codelineno-21-63" href="#__codelineno-21-63"></a><span class="w">    </span><span class="n">periph_module_reset</span><span class="p">(</span><span class="n">PERIPH_BT_MODULE</span><span class="p">);</span>
</span><span id="__span-21-64"><a id="__codelineno-21-64" name="__codelineno-21-64" href="#__codelineno-21-64"></a>
</span><span id="__span-21-65"><a id="__codelineno-21-65" name="__codelineno-21-65" href="#__codelineno-21-65"></a><span class="cp">#if CONFIG_BTDM_CTRL_HCI_UART_FLOW_CTRL_EN</span>
</span><span id="__span-21-66"><a id="__codelineno-21-66" name="__codelineno-21-66" href="#__codelineno-21-66"></a><span class="w">    </span><span class="n">sdk_config_set_uart_flow_ctrl_enable</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-21-67"><a id="__codelineno-21-67" name="__codelineno-21-67" href="#__codelineno-21-67"></a><span class="cp">#else</span>
</span><span id="__span-21-68"><a id="__codelineno-21-68" name="__codelineno-21-68" href="#__codelineno-21-68"></a><span class="w">    </span><span class="n">sdk_config_set_uart_flow_ctrl_enable</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span><span id="__span-21-69"><a id="__codelineno-21-69" name="__codelineno-21-69" href="#__codelineno-21-69"></a><span class="cp">#endif</span>
</span><span id="__span-21-70"><a id="__codelineno-21-70" name="__codelineno-21-70" href="#__codelineno-21-70"></a>
</span><span id="__span-21-71"><a id="__codelineno-21-71" name="__codelineno-21-71" href="#__codelineno-21-71"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">btdm_low_power_mode_init</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-72"><a id="__codelineno-21-72" name="__codelineno-21-72" href="#__codelineno-21-72"></a><span class="w">        </span><span class="n">ESP_LOGE</span><span class="p">(</span><span class="n">BTDM_LOG_TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Low power module initialization failed&quot;</span><span class="p">);</span>
</span><span id="__span-21-73"><a id="__codelineno-21-73" name="__codelineno-21-73" href="#__codelineno-21-73"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
</span><span id="__span-21-74"><a id="__codelineno-21-74" name="__codelineno-21-74" href="#__codelineno-21-74"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-75"><a id="__codelineno-21-75" name="__codelineno-21-75" href="#__codelineno-21-75"></a>
</span><span id="__span-21-76"><a id="__codelineno-21-76" name="__codelineno-21-76" href="#__codelineno-21-76"></a><span class="cp">#if CONFIG_SW_COEXIST_ENABLE</span>
</span><span id="__span-21-77"><a id="__codelineno-21-77" name="__codelineno-21-77" href="#__codelineno-21-77"></a><span class="w">    </span><span class="n">coex_init</span><span class="p">();</span>
</span><span id="__span-21-78"><a id="__codelineno-21-78" name="__codelineno-21-78" href="#__codelineno-21-78"></a><span class="cp">#endif</span>
</span><span id="__span-21-79"><a id="__codelineno-21-79" name="__codelineno-21-79" href="#__codelineno-21-79"></a>
</span><span id="__span-21-80"><a id="__codelineno-21-80" name="__codelineno-21-80" href="#__codelineno-21-80"></a><span class="cp">#if CONFIG_BT_BLE_LOG_SPI_OUT_ENABLED</span>
</span><span id="__span-21-81"><a id="__codelineno-21-81" name="__codelineno-21-81" href="#__codelineno-21-81"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ble_log_spi_out_init</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-82"><a id="__codelineno-21-82" name="__codelineno-21-82" href="#__codelineno-21-82"></a><span class="w">        </span><span class="n">ESP_LOGE</span><span class="p">(</span><span class="n">BTDM_LOG_TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;BLE Log SPI output init failed&quot;</span><span class="p">);</span>
</span><span id="__span-21-83"><a id="__codelineno-21-83" name="__codelineno-21-83" href="#__codelineno-21-83"></a><span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_ERR_NO_MEM</span><span class="p">;</span>
</span><span id="__span-21-84"><a id="__codelineno-21-84" name="__codelineno-21-84" href="#__codelineno-21-84"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
</span><span id="__span-21-85"><a id="__codelineno-21-85" name="__codelineno-21-85" href="#__codelineno-21-85"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-86"><a id="__codelineno-21-86" name="__codelineno-21-86" href="#__codelineno-21-86"></a><span class="cp">#endif </span><span class="c1">// CONFIG_BT_BLE_LOG_SPI_OUT_ENABLED</span>
</span><span id="__span-21-87"><a id="__codelineno-21-87" name="__codelineno-21-87" href="#__codelineno-21-87"></a>
</span><span id="__span-21-88"><a id="__codelineno-21-88" name="__codelineno-21-88" href="#__codelineno-21-88"></a><span class="w">    </span><span class="n">btdm_cfg_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">btdm_config_mask_load</span><span class="p">();</span>
</span><span id="__span-21-89"><a id="__codelineno-21-89" name="__codelineno-21-89" href="#__codelineno-21-89"></a>
</span><span id="__span-21-90"><a id="__codelineno-21-90" name="__codelineno-21-90" href="#__codelineno-21-90"></a><span class="w">    </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">btdm_controller_init</span><span class="p">(</span><span class="n">btdm_cfg_mask</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">);</span>
</span><span id="__span-21-91"><a id="__codelineno-21-91" name="__codelineno-21-91" href="#__codelineno-21-91"></a>
</span><span id="__span-21-92"><a id="__codelineno-21-92" name="__codelineno-21-92" href="#__codelineno-21-92"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-93"><a id="__codelineno-21-93" name="__codelineno-21-93" href="#__codelineno-21-93"></a><span class="w">        </span><span class="n">ESP_LOGE</span><span class="p">(</span><span class="n">BTDM_LOG_TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">__func__</span><span class="p">,</span><span class="n">err</span><span class="p">);</span>
</span><span id="__span-21-94"><a id="__codelineno-21-94" name="__codelineno-21-94" href="#__codelineno-21-94"></a><span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_ERR_NO_MEM</span><span class="p">;</span>
</span><span id="__span-21-95"><a id="__codelineno-21-95" name="__codelineno-21-95" href="#__codelineno-21-95"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
</span><span id="__span-21-96"><a id="__codelineno-21-96" name="__codelineno-21-96" href="#__codelineno-21-96"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-97"><a id="__codelineno-21-97" name="__codelineno-21-97" href="#__codelineno-21-97"></a>
</span><span id="__span-21-98"><a id="__codelineno-21-98" name="__codelineno-21-98" href="#__codelineno-21-98"></a><span class="cp">#ifdef CONFIG_BT_BLUEDROID_ENABLED</span>
</span><span id="__span-21-99"><a id="__codelineno-21-99" name="__codelineno-21-99" href="#__codelineno-21-99"></a><span class="w">    </span><span class="n">bt_stack_enableSecCtrlVsCmd</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-21-100"><a id="__codelineno-21-100" name="__codelineno-21-100" href="#__codelineno-21-100"></a><span class="cp">#endif </span><span class="c1">// CONFIG_BT_BLUEDROID_ENABLED</span>
</span><span id="__span-21-101"><a id="__codelineno-21-101" name="__codelineno-21-101" href="#__codelineno-21-101"></a><span class="cp">#if defined(CONFIG_BT_NIMBLE_ENABLED) || defined(CONFIG_BT_BLUEDROID_ENABLED)</span>
</span><span id="__span-21-102"><a id="__codelineno-21-102" name="__codelineno-21-102" href="#__codelineno-21-102"></a><span class="w">    </span><span class="n">bt_stack_enableCoexVsCmd</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-21-103"><a id="__codelineno-21-103" name="__codelineno-21-103" href="#__codelineno-21-103"></a><span class="w">    </span><span class="n">scan_stack_enableAdvFlowCtrlVsCmd</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-21-104"><a id="__codelineno-21-104" name="__codelineno-21-104" href="#__codelineno-21-104"></a><span class="w">    </span><span class="n">adv_stack_enableClearLegacyAdvVsCmd</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-21-105"><a id="__codelineno-21-105" name="__codelineno-21-105" href="#__codelineno-21-105"></a><span class="w">    </span><span class="n">advFilter_stack_enableDupExcListVsCmd</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-21-106"><a id="__codelineno-21-106" name="__codelineno-21-106" href="#__codelineno-21-106"></a><span class="cp">#endif </span><span class="c1">// (CONFIG_BT_NIMBLE_ENABLED) || (CONFIG_BT_BLUEDROID_ENABLED)</span>
</span><span id="__span-21-107"><a id="__codelineno-21-107" name="__codelineno-21-107" href="#__codelineno-21-107"></a>
</span><span id="__span-21-108"><a id="__codelineno-21-108" name="__codelineno-21-108" href="#__codelineno-21-108"></a><span class="w">    </span><span class="n">btdm_controller_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_INITED</span><span class="p">;</span>
</span><span id="__span-21-109"><a id="__codelineno-21-109" name="__codelineno-21-109" href="#__codelineno-21-109"></a>
</span><span id="__span-21-110"><a id="__codelineno-21-110" name="__codelineno-21-110" href="#__codelineno-21-110"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">;</span>
</span><span id="__span-21-111"><a id="__codelineno-21-111" name="__codelineno-21-111" href="#__codelineno-21-111"></a>
</span><span id="__span-21-112"><a id="__codelineno-21-112" name="__codelineno-21-112" href="#__codelineno-21-112"></a><span class="nl">error</span><span class="p">:</span>
</span><span id="__span-21-113"><a id="__codelineno-21-113" name="__codelineno-21-113" href="#__codelineno-21-113"></a>
</span><span id="__span-21-114"><a id="__codelineno-21-114" name="__codelineno-21-114" href="#__codelineno-21-114"></a><span class="cp">#if CONFIG_BT_BLE_LOG_SPI_OUT_ENABLED</span>
</span><span id="__span-21-115"><a id="__codelineno-21-115" name="__codelineno-21-115" href="#__codelineno-21-115"></a><span class="w">    </span><span class="n">ble_log_spi_out_deinit</span><span class="p">();</span>
</span><span id="__span-21-116"><a id="__codelineno-21-116" name="__codelineno-21-116" href="#__codelineno-21-116"></a><span class="cp">#endif </span><span class="c1">// CONFIG_BT_BLE_LOG_SPI_OUT_ENABLED</span>
</span><span id="__span-21-117"><a id="__codelineno-21-117" name="__codelineno-21-117" href="#__codelineno-21-117"></a>
</span><span id="__span-21-118"><a id="__codelineno-21-118" name="__codelineno-21-118" href="#__codelineno-21-118"></a><span class="w">    </span><span class="n">bt_controller_deinit_internal</span><span class="p">();</span>
</span><span id="__span-21-119"><a id="__codelineno-21-119" name="__codelineno-21-119" href="#__codelineno-21-119"></a>
</span><span id="__span-21-120"><a id="__codelineno-21-120" name="__codelineno-21-120" href="#__codelineno-21-120"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
</span><span id="__span-21-121"><a id="__codelineno-21-121" name="__codelineno-21-121" href="#__codelineno-21-121"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_bt_controller_enable">esp_bt_controller_enable</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_bt_controller_enable</span><span class="p">(</span><span class="n">esp_bt_mode_t</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="p">{</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">btdm_controller_status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_INITED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_STATE</span><span class="p">;</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">    </span><span class="c1">//As the history reason, mode should be equal to the mode which set in esp_bt_controller_init()</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">btdm_controller_get_mode</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="cp">#ifdef CONFIG_PM_ENABLE</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">s_btdm_allow_light_sleep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">        </span><span class="n">esp_pm_lock_acquire</span><span class="p">(</span><span class="n">s_light_sleep_pm_lock</span><span class="p">);</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">    </span><span class="n">esp_pm_lock_acquire</span><span class="p">(</span><span class="n">s_pm_lock</span><span class="p">);</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="cp">#endif</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="w">    </span><span class="n">esp_phy_enable</span><span class="p">(</span><span class="n">PHY_MODEM_BT</span><span class="p">);</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="cp">#if CONFIG_SW_COEXIST_ENABLE</span>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="w">    </span><span class="n">coex_enable</span><span class="p">();</span>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="cp">#endif</span>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">btdm_controller_get_sleep_mode</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BTDM_MODEM_SLEEP_MODE_ORIG</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="w">        </span><span class="n">btdm_controller_enable_sleep</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="w">    </span><span class="n">sdk_config_set_bt_pll_track_enable</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="w">    </span><span class="c1">// initialize bluetooth baseband</span>
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="w">    </span><span class="n">btdm_check_and_init_bb</span><span class="p">();</span>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a>
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">btdm_controller_enable</span><span class="p">(</span><span class="n">mode</span><span class="p">);</span>
</span><span id="__span-22-37"><a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-38"><a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a><span class="cp">#if CONFIG_SW_COEXIST_ENABLE</span>
</span><span id="__span-22-39"><a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a><span class="w">        </span><span class="n">coex_disable</span><span class="p">();</span>
</span><span id="__span-22-40"><a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a><span class="cp">#endif</span>
</span><span id="__span-22-41"><a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a><span class="w">        </span><span class="n">esp_phy_disable</span><span class="p">(</span><span class="n">PHY_MODEM_BT</span><span class="p">);</span>
</span><span id="__span-22-42"><a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a><span class="cp">#ifdef CONFIG_PM_ENABLE</span>
</span><span id="__span-22-43"><a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">s_btdm_allow_light_sleep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-44"><a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a><span class="w">            </span><span class="n">esp_pm_lock_release</span><span class="p">(</span><span class="n">s_light_sleep_pm_lock</span><span class="p">);</span>
</span><span id="__span-22-45"><a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-22-46"><a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a><span class="w">        </span><span class="n">esp_pm_lock_release</span><span class="p">(</span><span class="n">s_pm_lock</span><span class="p">);</span>
</span><span id="__span-22-47"><a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a><span class="cp">#endif</span>
</span><span id="__span-22-48"><a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_STATE</span><span class="p">;</span>
</span><span id="__span-22-49"><a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-50"><a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a>
</span><span id="__span-22-51"><a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a><span class="w">    </span><span class="n">btdm_controller_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_ENABLED</span><span class="p">;</span>
</span><span id="__span-22-52"><a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_register_shutdown_handler</span><span class="p">(</span><span class="n">bt_shutdown</span><span class="p">);</span>
</span><span id="__span-22-53"><a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-54"><a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a><span class="w">        </span><span class="n">ESP_LOGW</span><span class="p">(</span><span class="n">BTDM_LOG_TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Register shutdown handler failed, ret = 0x%x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span>
</span><span id="__span-22-55"><a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-56"><a id="__codelineno-22-56" name="__codelineno-22-56" href="#__codelineno-22-56"></a>
</span><span id="__span-22-57"><a id="__codelineno-22-57" name="__codelineno-22-57" href="#__codelineno-22-57"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">;</span>
</span><span id="__span-22-58"><a id="__codelineno-22-58" name="__codelineno-22-58" href="#__codelineno-22-58"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="esp_bluedroid_status_t">esp_bluedroid_status_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_UNINITIALIZED</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">        </span><span class="cm">/* linked Bluetooth not initialized */</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_INITIALIZED</span><span class="p">,</span><span class="w">                </span><span class="cm">/* linked Bluetooth initialized but not enabled */</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="w">                     </span><span class="cm">/* linked Bluetooth initialized and enabled */</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="p">}</span><span class="w"> </span><span class="n">esp_bluedroid_status_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="esp_bluedroid_get_status">esp_bluedroid_get_status</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">esp_bluedroid_status_t</span><span class="w"> </span><span class="nf">esp_bluedroid_get_status</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="p">{</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bd_already_init</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bd_already_enable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">;</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_BLUEDROID_STATUS_INITIALIZED</span><span class="p">;</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_BLUEDROID_STATUS_UNINITIALIZED</span><span class="p">;</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="esp_bluedroid_init">esp_bluedroid_init</h6>
<p><a href="../Telink/#bluetooth-stack-init">Bluetooth stack init</a><br />
<a href="./#esp_bluedroid_config_t">esp_bluedroid_config_t</a><br />
<a href="./#bt_bluedroid_init_config_default">BT_BLUEDROID_INIT_CONFIG_DEFAULT</a><br />
<a href="./#esp_bluedroid_init_with_cfg">esp_bluedroid_init_with_cfg</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_bluedroid_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="c1">//[Bluetooth stack init](Telink.md/#bluetooth-stack-init)</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="p">{</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="n">esp_bluedroid_config_t</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT_BLUEDROID_INIT_CONFIG_DEFAULT</span><span class="p">();</span><span class="w"> </span><span class="c1">//[esp_bluedroid_config_t](ESP-IDF.md/#esp_bluedroid_config_t) and [BT_BLUEDROID_INIT_CONFIG_DEFAULT](ESP-IDF.md/#bt_bluedroid_init_config_default)</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">esp_bluedroid_init_with_cfg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cfg</span><span class="p">);</span><span class="w"> </span><span class="c1">//[esp_bluedroid_init_with_cfg](ESP-IDF.md/#esp_bluedroid_init_with_cfg)</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_bluedroid_config_t">esp_bluedroid_config_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">ssp_en</span><span class="p">;</span><span class="w"> </span><span class="cm">/* linked Whether SSP(secure simple pairing) or legacy pairing is used for Classic Bluetooth */</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">sc_en</span><span class="p">;</span><span class="w"> </span><span class="cm">/* linked Whether secure connection host support is enabled or disabled for Classic Bluetooth */</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="p">}</span><span class="w"> </span><span class="n">esp_bluedroid_config_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="bt_bluedroid_init_config_default">BT_BLUEDROID_INIT_CONFIG_DEFAULT</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="cp">#define BT_BLUEDROID_INIT_CONFIG_DEFAULT()                                                                             \</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="cp">    {                                                                                                                  \</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="cp">        .ssp_en = true,                                                                                                \</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="cp">        .sc_en = false,                                                                                                \</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="cp">    }</span>
</span></code></pre></div>
<h6 id="esp_bluedroid_init_with_cfg">esp_bluedroid_init_with_cfg</h6>
<p><a href="../Telink/#bluetooth-stack-configs">Bluetooth stack configs</a><br />
<a href="./#btc_msg">btc_msg</a><br />
<a href="./#bluedroid_config_init">bluedroid_config_init</a><br />
<a href="./#btc_init">btc_init</a><br />
<a href="./#btc_main_get_future_p">btc_main_get_future_p</a><br />
<a href="./#future_new">future_new</a><br />
<a href="./#btc_transfer_context">btc_transfer_context</a><br />
<a href="./#future_await">future_await</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_bluedroid_init_with_cfg</span><span class="p">(</span><span class="n">esp_bluedroid_config_t</span><span class="w"> </span><span class="o">*</span><span class="n">cfg</span><span class="p">)</span><span class="w"> </span><span class="c1">//[Bluetooth stack configs](Telink.md/#bluetooth-stack-configs)</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="p">{</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="n">btc_msg_t</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span><span class="w"> </span><span class="c1">//[btc_msg](ESP-IDF.md/#btc_msg)</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="n">future_t</span><span class="w"> </span><span class="o">**</span><span class="n">future_p</span><span class="p">;</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="n">bt_status_t</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cfg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;%s cfg is NULL&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">__func__</span><span class="p">);</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">sc_en</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="cp">#if (SC_MODE_INCLUDED == FALSE)</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Secure Connections should not be enabled when target controller is ESP32.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;It may trigger unresolved bugs in the controller.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="cp">#endif </span><span class="c1">// SC_MODE_INCLUDED</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">ssp_en</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a><span class="w">            </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;secure simple pairing should be enabled when secure connection host support is enabled</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="w">        </span><span class="n">LOG_WARN</span><span class="p">(</span><span class="s">&quot;Please make sure to clear the bond list before enabling the secure connection host support</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-26"><a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>
</span><span id="__span-28-27"><a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a><span class="cp">#if (BT_CONTROLLER_INCLUDED == TRUE)</span>
</span><span id="__span-28-28"><a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">esp_bt_controller_get_status</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_ENABLED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-29"><a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Controller not initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-28-30"><a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_STATE</span><span class="p">;</span>
</span><span id="__span-28-31"><a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-32"><a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a><span class="cp">#endif</span>
</span><span id="__span-28-33"><a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a>
</span><span id="__span-28-34"><a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bd_already_init</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-35"><a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Bluedroid already initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-28-36"><a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_STATE</span><span class="p">;</span>
</span><span id="__span-28-37"><a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-38"><a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a>
</span><span id="__span-28-39"><a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a><span class="cp">#if HEAP_MEMORY_DEBUG</span>
</span><span id="__span-28-40"><a id="__codelineno-28-40" name="__codelineno-28-40" href="#__codelineno-28-40"></a><span class="w">    </span><span class="n">osi_mem_dbg_init</span><span class="p">();</span>
</span><span id="__span-28-41"><a id="__codelineno-28-41" name="__codelineno-28-41" href="#__codelineno-28-41"></a><span class="cp">#endif</span>
</span><span id="__span-28-42"><a id="__codelineno-28-42" name="__codelineno-28-42" href="#__codelineno-28-42"></a>
</span><span id="__span-28-43"><a id="__codelineno-28-43" name="__codelineno-28-43" href="#__codelineno-28-43"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bluedroid_config_init</span><span class="p">(</span><span class="n">cfg</span><span class="p">);</span><span class="w"> </span><span class="c1">//[bluedroid_config_init](ESP-IDF.md/#bluedroid_config_init)</span>
</span><span id="__span-28-44"><a id="__codelineno-28-44" name="__codelineno-28-44" href="#__codelineno-28-44"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-45"><a id="__codelineno-28-45" name="__codelineno-28-45" href="#__codelineno-28-45"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Bluedroid stack initialize fail, ret:%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span>
</span><span id="__span-28-46"><a id="__codelineno-28-46" name="__codelineno-28-46" href="#__codelineno-28-46"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">;</span>
</span><span id="__span-28-47"><a id="__codelineno-28-47" name="__codelineno-28-47" href="#__codelineno-28-47"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-48"><a id="__codelineno-28-48" name="__codelineno-28-48" href="#__codelineno-28-48"></a>
</span><span id="__span-28-49"><a id="__codelineno-28-49" name="__codelineno-28-49" href="#__codelineno-28-49"></a><span class="w">    </span><span class="cm">/*</span>
</span><span id="__span-28-50"><a id="__codelineno-28-50" name="__codelineno-28-50" href="#__codelineno-28-50"></a><span class="cm">     * BTC Init</span>
</span><span id="__span-28-51"><a id="__codelineno-28-51" name="__codelineno-28-51" href="#__codelineno-28-51"></a><span class="cm">     */</span>
</span><span id="__span-28-52"><a id="__codelineno-28-52" name="__codelineno-28-52" href="#__codelineno-28-52"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">btc_init</span><span class="p">();</span><span class="w"> </span><span class="c1">//[btc_init](ESP-IDF.md/#btc_init)</span>
</span><span id="__span-28-53"><a id="__codelineno-28-53" name="__codelineno-28-53" href="#__codelineno-28-53"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-54"><a id="__codelineno-28-54" name="__codelineno-28-54" href="#__codelineno-28-54"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Bluedroid Initialize Fail&quot;</span><span class="p">);</span>
</span><span id="__span-28-55"><a id="__codelineno-28-55" name="__codelineno-28-55" href="#__codelineno-28-55"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">;</span>
</span><span id="__span-28-56"><a id="__codelineno-28-56" name="__codelineno-28-56" href="#__codelineno-28-56"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-57"><a id="__codelineno-28-57" name="__codelineno-28-57" href="#__codelineno-28-57"></a>
</span><span id="__span-28-58"><a id="__codelineno-28-58" name="__codelineno-28-58" href="#__codelineno-28-58"></a><span class="w">    </span><span class="n">future_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">btc_main_get_future_p</span><span class="p">(</span><span class="n">BTC_MAIN_INIT_FUTURE</span><span class="p">);</span><span class="w"> </span><span class="c1">//[btc_main_get_future_p](ESP-IDF.md/#btc_main_get_future_p)</span>
</span><span id="__span-28-59"><a id="__codelineno-28-59" name="__codelineno-28-59" href="#__codelineno-28-59"></a><span class="w">    </span><span class="o">*</span><span class="n">future_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future_new</span><span class="p">();</span><span class="w"> </span><span class="c1">//[future_new](ESP-IDF.md/#future_new)</span>
</span><span id="__span-28-60"><a id="__codelineno-28-60" name="__codelineno-28-60" href="#__codelineno-28-60"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">future_p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-61"><a id="__codelineno-28-61" name="__codelineno-28-61" href="#__codelineno-28-61"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Bluedroid Initialize Fail!&quot;</span><span class="p">);</span>
</span><span id="__span-28-62"><a id="__codelineno-28-62" name="__codelineno-28-62" href="#__codelineno-28-62"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_NO_MEM</span><span class="p">;</span>
</span><span id="__span-28-63"><a id="__codelineno-28-63" name="__codelineno-28-63" href="#__codelineno-28-63"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-64"><a id="__codelineno-28-64" name="__codelineno-28-64" href="#__codelineno-28-64"></a>
</span><span id="__span-28-65"><a id="__codelineno-28-65" name="__codelineno-28-65" href="#__codelineno-28-65"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_SIG_API_CALL</span><span class="p">;</span>
</span><span id="__span-28-66"><a id="__codelineno-28-66" name="__codelineno-28-66" href="#__codelineno-28-66"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_PID_MAIN_INIT</span><span class="p">;</span>
</span><span id="__span-28-67"><a id="__codelineno-28-67" name="__codelineno-28-67" href="#__codelineno-28-67"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_MAIN_ACT_INIT</span><span class="p">;</span>
</span><span id="__span-28-68"><a id="__codelineno-28-68" name="__codelineno-28-68" href="#__codelineno-28-68"></a>
</span><span id="__span-28-69"><a id="__codelineno-28-69" name="__codelineno-28-69" href="#__codelineno-28-69"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">btc_transfer_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="c1">// [btc_transfer_context](ESP-IDF.md/#btc_transfer_context)</span>
</span><span id="__span-28-70"><a id="__codelineno-28-70" name="__codelineno-28-70" href="#__codelineno-28-70"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-28-71"><a id="__codelineno-28-71" name="__codelineno-28-71" href="#__codelineno-28-71"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Bluedroid Initialize Fail&quot;</span><span class="p">);</span>
</span><span id="__span-28-72"><a id="__codelineno-28-72" name="__codelineno-28-72" href="#__codelineno-28-72"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">;</span>
</span><span id="__span-28-73"><a id="__codelineno-28-73" name="__codelineno-28-73" href="#__codelineno-28-73"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-74"><a id="__codelineno-28-74" name="__codelineno-28-74" href="#__codelineno-28-74"></a>
</span><span id="__span-28-75"><a id="__codelineno-28-75" name="__codelineno-28-75" href="#__codelineno-28-75"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">future_await</span><span class="p">(</span><span class="o">*</span><span class="n">future_p</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FUTURE_FAIL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//[future_await](ESP-IDF.md/#future_await)</span>
</span><span id="__span-28-76"><a id="__codelineno-28-76" name="__codelineno-28-76" href="#__codelineno-28-76"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Bluedroid Initialize Fail&quot;</span><span class="p">);</span>
</span><span id="__span-28-77"><a id="__codelineno-28-77" name="__codelineno-28-77" href="#__codelineno-28-77"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">;</span>
</span><span id="__span-28-78"><a id="__codelineno-28-78" name="__codelineno-28-78" href="#__codelineno-28-78"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-79"><a id="__codelineno-28-79" name="__codelineno-28-79" href="#__codelineno-28-79"></a>
</span><span id="__span-28-80"><a id="__codelineno-28-80" name="__codelineno-28-80" href="#__codelineno-28-80"></a><span class="w">    </span><span class="n">bd_already_init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-28-81"><a id="__codelineno-28-81" name="__codelineno-28-81" href="#__codelineno-28-81"></a>
</span><span id="__span-28-82"><a id="__codelineno-28-82" name="__codelineno-28-82" href="#__codelineno-28-82"></a><span class="cp">#if (BT_HCI_LOG_INCLUDED == TRUE)</span>
</span><span id="__span-28-83"><a id="__codelineno-28-83" name="__codelineno-28-83" href="#__codelineno-28-83"></a><span class="w">    </span><span class="n">bt_hci_log_init</span><span class="p">();</span>
</span><span id="__span-28-84"><a id="__codelineno-28-84" name="__codelineno-28-84" href="#__codelineno-28-84"></a><span class="cp">#endif </span><span class="c1">// (BT_HCI_LOG_INCLUDED == TRUE)</span>
</span><span id="__span-28-85"><a id="__codelineno-28-85" name="__codelineno-28-85" href="#__codelineno-28-85"></a>
</span><span id="__span-28-86"><a id="__codelineno-28-86" name="__codelineno-28-86" href="#__codelineno-28-86"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">;</span>
</span><span id="__span-28-87"><a id="__codelineno-28-87" name="__codelineno-28-87" href="#__codelineno-28-87"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="bluedroid_config_init">bluedroid_config_init</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">bt_status_t</span><span class="w"> </span><span class="nf">bluedroid_config_init</span><span class="p">(</span><span class="n">esp_bluedroid_config_t</span><span class="w"> </span><span class="o">*</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="p">{</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">    </span><span class="n">s_stack_config_env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">osi_calloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">stack_config_env_tag</span><span class="p">));</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">s_stack_config_env</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">BT_STATUS_NOMEM</span><span class="p">;</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s_stack_config_env</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">esp_bluedroid_config_t</span><span class="p">));</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">bluedroid_config</span><span class="w"> </span><span class="o">*</span><span class="n">interface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s_stack_config_env</span><span class="o">-&gt;</span><span class="n">interface</span><span class="p">;</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">    </span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">get_ssp_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_ssp_enabled</span><span class="p">;</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">    </span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">get_sc_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_sc_enabled</span><span class="p">;</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="p">;</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="btc_init">btc_init</h6>
<p><a href="../Telink/#task-controller">Task Controller</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">bt_status_t</span><span class="w"> </span><span class="nf">btc_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="c1">//[Task Controller](Telink.md/#task-controller)</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="p">{</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">workqueue_len</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">BTC_TASK_WORKQUEUE0_LEN</span><span class="p">,</span><span class="w"> </span><span class="n">BTC_TASK_WORKQUEUE1_LEN</span><span class="p">};</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">    </span><span class="n">btc_thread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">osi_thread_create</span><span class="p">(</span><span class="n">BTC_TASK_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">BTC_TASK_STACK_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">BTC_TASK_PRIO</span><span class="p">,</span><span class="w"> </span><span class="n">BTC_TASK_PINNED_TO_CORE</span><span class="p">,</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">                                   </span><span class="n">BTC_TASK_WORKQUEUE_NUM</span><span class="p">,</span><span class="w"> </span><span class="n">workqueue_len</span><span class="p">);</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">btc_thread</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">BT_STATUS_NOMEM</span><span class="p">;</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="cp">#if BTC_DYNAMIC_MEMORY</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">btc_init_mem</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="p">){</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">BT_STATUS_NOMEM</span><span class="p">;</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="cp">#endif</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="cp">#if BTC_GAP_BT_INCLUDED</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="w">    </span><span class="n">btc_gap_bt_init</span><span class="p">();</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="cp">#endif</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="cp">#if (BLE_INCLUDED == TRUE)</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="w">    </span><span class="n">btc_gap_callback_init</span><span class="p">();</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a><span class="cp">#if (BLE_FEAT_ISO_EN == TRUE)</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="w">    </span><span class="n">btc_iso_callback_init</span><span class="p">();</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="cp">#endif </span><span class="c1">// #if (BLE_FEAT_ISO_EN == TRUE)</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a><span class="cp">#if (BLE_FEAT_CTE_EN == TRUE)</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a><span class="w">    </span><span class="n">btc_cte_callback_init</span><span class="p">();</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="cp">#endif </span><span class="c1">// #if (BLE_FEAT_CTE_EN == TRUE)</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a><span class="w">    </span><span class="n">btc_gap_ble_init</span><span class="p">();</span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a><span class="cp">#endif  </span><span class="c1">///BLE_INCLUDED == TRUE</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="w">    </span><span class="cm">/* TODO: initial the profile_tab */</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="p">;</span>
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="btc_main_get_future_p">btc_main_get_future_p</h6>
<p><a href="../Telink/#future-pointer">Future pointer</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">future_t</span><span class="w"> </span><span class="o">**</span><span class="nf">btc_main_get_future_p</span><span class="p">(</span><span class="n">btc_main_future_type_t</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="c1">//[Future pointer](Telink.md/#future-pointer)</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="p">{</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">main_future</span><span class="p">[</span><span class="n">type</span><span class="p">];</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="future_new">future_new</h6>
<p><a href="../Telink/#tlkos_semphr_createbinary">tlkos_semphr_createBinary</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">future_t</span><span class="w"> </span><span class="o">*</span><span class="nf">future_new</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="c1">//[tlkos_semphr_createBinary](Telink.md/#tlkos_semphr_createbinary)</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="p">{</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">    </span><span class="n">future_t</span><span class="w"> </span><span class="o">*</span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">osi_calloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">future_t</span><span class="p">));</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">        </span><span class="n">OSI_TRACE_ERROR</span><span class="p">(</span><span class="s">&quot;%s unable to allocate memory for return value.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">__func__</span><span class="p">);</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">osi_sem_new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ret</span><span class="o">-&gt;</span><span class="n">semaphore</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">        </span><span class="n">OSI_TRACE_ERROR</span><span class="p">(</span><span class="s">&quot;%s unable to allocate memory for the semaphore.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">__func__</span><span class="p">);</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">    </span><span class="n">ret</span><span class="o">-&gt;</span><span class="n">ready_can_be_called</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="nl">error</span><span class="p">:;</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">    </span><span class="n">future_free</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="btc_msg">btc_msg</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">btc_msg</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">sig</span><span class="p">;</span><span class="w">    </span><span class="c1">//event signal</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">aid</span><span class="p">;</span><span class="w">    </span><span class="c1">//application id</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span><span class="w">    </span><span class="c1">//profile id</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">act</span><span class="p">;</span><span class="w">    </span><span class="c1">//profile action, defined in seprerate header files</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">    </span><span class="n">UINT8</span><span class="w">   </span><span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="c1">//param for btc function or function param</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="p">}</span><span class="w"> </span><span class="n">btc_msg_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="btc_transfer_context">btc_transfer_context</h6>
<p><a href="../Telink/#tlksys_task_input">tlksys_task_input</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">bt_status_t</span><span class="w"> </span><span class="nf">btc_transfer_context</span><span class="p">(</span><span class="n">btc_msg_t</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">arg_len</span><span class="p">,</span><span class="w"> </span><span class="n">btc_arg_deep_copy_t</span><span class="w"> </span><span class="n">copy_func</span><span class="p">,</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">                                    </span><span class="n">btc_arg_deep_free_t</span><span class="w"> </span><span class="n">free_func</span><span class="p">)</span><span class="w"> </span><span class="c1">//[tlksys_task_input](ESP-IDF.md/#tlksys_task_input)</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="p">{</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">    </span><span class="n">btc_msg_t</span><span class="o">*</span><span class="w"> </span><span class="n">lmsg</span><span class="p">;</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">    </span><span class="n">bt_status_t</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">    </span><span class="c1">//                              arg XOR arg_len</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">((</span><span class="n">arg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">arg_len</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">        </span><span class="n">BTC_TRACE_WARNING</span><span class="p">(</span><span class="s">&quot;%s Invalid parameters</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">__func__</span><span class="p">);</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">BT_STATUS_PARM_INVALID</span><span class="p">;</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">    </span><span class="n">BTC_TRACE_DEBUG</span><span class="p">(</span><span class="s">&quot;%s msg %u %u %u %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">__func__</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">sig</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">act</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">);</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">    </span><span class="n">lmsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">btc_msg_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">osi_malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">btc_msg_t</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">arg_len</span><span class="p">);</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lmsg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w">        </span><span class="n">BTC_TRACE_WARNING</span><span class="p">(</span><span class="s">&quot;%s No memory</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">__func__</span><span class="p">);</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">BT_STATUS_NOMEM</span><span class="p">;</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">lmsg</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">btc_msg_t</span><span class="p">));</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="w">        </span><span class="n">memset</span><span class="p">(</span><span class="n">lmsg</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="n">arg_len</span><span class="p">);</span><span class="w">    </span><span class="c1">//important, avoid arg which have no length</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="w">        </span><span class="n">memcpy</span><span class="p">(</span><span class="n">lmsg</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="n">arg_len</span><span class="p">);</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">copy_func</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="w">            </span><span class="n">copy_func</span><span class="p">(</span><span class="n">lmsg</span><span class="p">,</span><span class="w"> </span><span class="n">lmsg</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">);</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">btc_task_post</span><span class="p">(</span><span class="n">lmsg</span><span class="p">,</span><span class="w"> </span><span class="n">OSI_THREAD_MAX_TIMEOUT</span><span class="p">);</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">copy_func</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">free_func</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="w">            </span><span class="n">free_func</span><span class="p">(</span><span class="n">lmsg</span><span class="p">);</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a><span class="w">        </span><span class="n">osi_free</span><span class="p">(</span><span class="n">lmsg</span><span class="p">);</span>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a>
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="future_await">future_await</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">future_await</span><span class="p">(</span><span class="n">future_t</span><span class="w"> </span><span class="o">*</span><span class="n">future</span><span class="p">)</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="p">{</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">future</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">    </span><span class="c1">// If the future is immediate, it will not have a semaphore</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">future</span><span class="o">-&gt;</span><span class="n">semaphore</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">        </span><span class="n">osi_sem_take</span><span class="p">(</span><span class="o">&amp;</span><span class="n">future</span><span class="o">-&gt;</span><span class="n">semaphore</span><span class="p">,</span><span class="w"> </span><span class="n">OSI_SEM_MAX_TIMEOUT</span><span class="p">);</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future</span><span class="o">-&gt;</span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">    </span><span class="n">future_free</span><span class="p">(</span><span class="n">future</span><span class="p">);</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="esp_bluedroid_enable">esp_bluedroid_enable</h6>
<p><a href="../Telink/#tlkapp_enable_bt_stack">tlkapp_enable_bt_stack</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_bluedroid_enable</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="c1">// [tlkapp_enable_bt_stack](Telink.md/#tlkapp_enable_bt_stack)</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="p">{</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="n">btc_msg_t</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">    </span><span class="n">future_t</span><span class="w"> </span><span class="o">**</span><span class="n">future_p</span><span class="p">;</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">bd_already_init</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Bludroid not initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_STATE</span><span class="p">;</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bd_already_enable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Bluedroid already enabled</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_STATE</span><span class="p">;</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="w">    </span><span class="n">future_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">btc_main_get_future_p</span><span class="p">(</span><span class="n">BTC_MAIN_ENABLE_FUTURE</span><span class="p">);</span>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="w">    </span><span class="o">*</span><span class="n">future_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">future_new</span><span class="p">();</span>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">future_p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Bluedroid enable failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_NO_MEM</span><span class="p">;</span>
</span><span id="__span-36-21"><a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-22"><a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a>
</span><span id="__span-36-23"><a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_SIG_API_CALL</span><span class="p">;</span>
</span><span id="__span-36-24"><a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_PID_MAIN_INIT</span><span class="p">;</span>
</span><span id="__span-36-25"><a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_MAIN_ACT_ENABLE</span><span class="p">;</span>
</span><span id="__span-36-26"><a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a>
</span><span id="__span-36-27"><a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">btc_transfer_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-28"><a id="__codelineno-36-28" name="__codelineno-36-28" href="#__codelineno-36-28"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Bluedroid enable failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-36-29"><a id="__codelineno-36-29" name="__codelineno-36-29" href="#__codelineno-36-29"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">;</span>
</span><span id="__span-36-30"><a id="__codelineno-36-30" name="__codelineno-36-30" href="#__codelineno-36-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-31"><a id="__codelineno-36-31" name="__codelineno-36-31" href="#__codelineno-36-31"></a>
</span><span id="__span-36-32"><a id="__codelineno-36-32" name="__codelineno-36-32" href="#__codelineno-36-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">future_await</span><span class="p">(</span><span class="o">*</span><span class="n">future_p</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FUTURE_FAIL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-33"><a id="__codelineno-36-33" name="__codelineno-36-33" href="#__codelineno-36-33"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Bluedroid enable failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-36-34"><a id="__codelineno-36-34" name="__codelineno-36-34" href="#__codelineno-36-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">;</span>
</span><span id="__span-36-35"><a id="__codelineno-36-35" name="__codelineno-36-35" href="#__codelineno-36-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-36"><a id="__codelineno-36-36" name="__codelineno-36-36" href="#__codelineno-36-36"></a>
</span><span id="__span-36-37"><a id="__codelineno-36-37" name="__codelineno-36-37" href="#__codelineno-36-37"></a><span class="w">    </span><span class="n">bd_already_enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-36-38"><a id="__codelineno-36-38" name="__codelineno-36-38" href="#__codelineno-36-38"></a>
</span><span id="__span-36-39"><a id="__codelineno-36-39" name="__codelineno-36-39" href="#__codelineno-36-39"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">;</span>
</span><span id="__span-36-40"><a id="__codelineno-36-40" name="__codelineno-36-40" href="#__codelineno-36-40"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_ble_gap_register_callback">esp_ble_gap_register_callback</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_ble_gap_register_callback</span><span class="p">(</span><span class="n">esp_gap_ble_cb_t</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="p">{</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_CHECK</span><span class="p">(</span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">);</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">btc_profile_cb_set</span><span class="p">(</span><span class="n">BTC_PID_GAP_BLE</span><span class="p">,</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ESP_OK</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">);</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="esp_ble_gattc_register_callback">esp_ble_gattc_register_callback</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_ble_gattc_register_callback</span><span class="p">(</span><span class="n">esp_gattc_cb_t</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="p">{</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_CHECK</span><span class="p">(</span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">);</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">callback</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">;</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">    </span><span class="n">btc_profile_cb_set</span><span class="p">(</span><span class="n">BTC_PID_GATTC</span><span class="p">,</span><span class="w"> </span><span class="n">callback</span><span class="p">);</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">;</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="esp_ble_gap_set_device_name">esp_ble_gap_set_device_name</h6>
<p><a href="../Telink/#blc_svc_setdevicename">blc_svc_setDeviceName</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_ble_gap_set_device_name</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="c1">//[blc_svc_setDeviceName](Telink.md/#blc_svc_setdevicename)</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="p">{</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">    </span><span class="n">btc_msg_t</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">    </span><span class="n">btc_ble_gap_args_t</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">esp_bluedroid_get_status</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_STATE</span><span class="p">;</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">name</span><span class="p">){</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">BTC_MAX_LOC_BD_NAME_LEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_SIG_API_CALL</span><span class="p">;</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_PID_GAP_BLE</span><span class="p">;</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_GAP_BLE_ACT_SET_DEV_NAME</span><span class="p">;</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">set_dev_name</span><span class="p">.</span><span class="n">device_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">btc_transfer_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">btc_ble_gap_args_t</span><span class="p">),</span><span class="w"> </span><span class="n">btc_gap_ble_arg_deep_copy</span><span class="p">,</span><span class="w"> </span><span class="n">btc_gap_ble_arg_deep_free</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ESP_OK</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">);</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_ble_gap_set_security_param">esp_ble_gap_set_security_param</h6>
<p><a href="../Telink/#smp-security">smp security</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_ble_gap_set_security_param</span><span class="p">(</span><span class="n">esp_ble_sm_param_t</span><span class="w"> </span><span class="n">param_type</span><span class="p">,</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="c1">//[smp security](Telink.md/#smp-security)</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="p">{</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">param_type</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">ESP_BLE_SM_MAX_PARAM</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">    </span><span class="k">if</span><span class="p">((</span><span class="n">param_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_BLE_SM_CLEAR_STATIC_PASSKEY</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">uint32_t</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">param_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BLE_SM_SET_STATIC_PASSKEY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">passkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">            </span><span class="n">passkey</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(((</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">value</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">i</span><span class="p">));</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">passkey</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">999999</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">param_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BLE_APP_ENC_KEY_SIZE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;ESP_BLE_APP_ENC_KEY_SIZE is deprecated, use ESP_GATT_PERM_ENCRYPT_KEY_SIZE in characteristic definition&quot;</span><span class="p">);</span>
</span><span id="__span-40-22"><a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_NOT_SUPPORTED</span><span class="p">;</span>
</span><span id="__span-40-23"><a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-24"><a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">param_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BLE_SM_MAX_KEY_SIZE</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">param_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BLE_SM_MIN_KEY_SIZE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-25"><a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(((</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">((</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-26"><a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-40-27"><a id="__codelineno-40-27" name="__codelineno-40-27" href="#__codelineno-40-27"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-28"><a id="__codelineno-40-28" name="__codelineno-40-28" href="#__codelineno-40-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-29"><a id="__codelineno-40-29" name="__codelineno-40-29" href="#__codelineno-40-29"></a><span class="w">    </span><span class="n">btc_msg_t</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-40-30"><a id="__codelineno-40-30" name="__codelineno-40-30" href="#__codelineno-40-30"></a><span class="w">    </span><span class="n">btc_ble_gap_args_t</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span>
</span><span id="__span-40-31"><a id="__codelineno-40-31" name="__codelineno-40-31" href="#__codelineno-40-31"></a>
</span><span id="__span-40-32"><a id="__codelineno-40-32" name="__codelineno-40-32" href="#__codelineno-40-32"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_CHECK</span><span class="p">(</span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">);</span>
</span><span id="__span-40-33"><a id="__codelineno-40-33" name="__codelineno-40-33" href="#__codelineno-40-33"></a>
</span><span id="__span-40-34"><a id="__codelineno-40-34" name="__codelineno-40-34" href="#__codelineno-40-34"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_SIG_API_CALL</span><span class="p">;</span>
</span><span id="__span-40-35"><a id="__codelineno-40-35" name="__codelineno-40-35" href="#__codelineno-40-35"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_PID_GAP_BLE</span><span class="p">;</span>
</span><span id="__span-40-36"><a id="__codelineno-40-36" name="__codelineno-40-36" href="#__codelineno-40-36"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_GAP_BLE_SET_SECURITY_PARAM_EVT</span><span class="p">;</span>
</span><span id="__span-40-37"><a id="__codelineno-40-37" name="__codelineno-40-37" href="#__codelineno-40-37"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">set_security_param</span><span class="p">.</span><span class="n">param_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param_type</span><span class="p">;</span>
</span><span id="__span-40-38"><a id="__codelineno-40-38" name="__codelineno-40-38" href="#__codelineno-40-38"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">set_security_param</span><span class="p">.</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len</span><span class="p">;</span>
</span><span id="__span-40-39"><a id="__codelineno-40-39" name="__codelineno-40-39" href="#__codelineno-40-39"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">set_security_param</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-40-40"><a id="__codelineno-40-40" name="__codelineno-40-40" href="#__codelineno-40-40"></a>
</span><span id="__span-40-41"><a id="__codelineno-40-41" name="__codelineno-40-41" href="#__codelineno-40-41"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">btc_transfer_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">btc_ble_gap_args_t</span><span class="p">),</span><span class="w"> </span><span class="n">btc_gap_ble_arg_deep_copy</span><span class="p">,</span>
</span><span id="__span-40-42"><a id="__codelineno-40-42" name="__codelineno-40-42" href="#__codelineno-40-42"></a><span class="w">                </span><span class="n">btc_gap_ble_arg_deep_free</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ESP_OK</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">);</span>
</span><span id="__span-40-43"><a id="__codelineno-40-43" name="__codelineno-40-43" href="#__codelineno-40-43"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_bt_controller_get_status">esp_bt_controller_get_status</h6>
<p><a href="./#btdm_controller_status">btdm_controller_status</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">esp_bt_controller_status_t</span><span class="w"> </span><span class="nf">esp_bt_controller_get_status</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="p">{</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">btdm_controller_status</span><span class="p">;</span><span class="w"> </span><span class="c1">//[btdm_controller_status](ESP-IDF.md/#btdm_controller_status)</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="btdm_controller_status">btdm_controller_status</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="k">static</span><span class="w"> </span><span class="n">DRAM_ATTR</span><span class="w"> </span><span class="n">esp_bt_controller_status_t</span><span class="w"> </span><span class="n">btdm_controller_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_IDLE</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="esp_err_to_name">esp_err_to_name</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">esp_err_to_name</span><span class="p">(</span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">code</span><span class="p">)</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="p">{</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="cp">#ifdef CONFIG_ESP_ERR_TO_NAME_LOOKUP</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">esp_err_msg_table</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">esp_err_msg_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">esp_err_msg_table</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">esp_err_msg_table</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">msg</span><span class="p">;</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="cp">#endif </span><span class="c1">//CONFIG_ESP_ERR_TO_NAME_LOOKUP</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">esp_unknown_msg</span><span class="p">;</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="esp_ble_gatts_app_register">esp_ble_gatts_app_register</h6>
<p><a href="../Telink/#register-server-app">Register Server App</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_ble_gatts_app_register</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">app_id</span><span class="p">)</span><span class="w"> </span><span class="c1">//[Register Server App](Telink.md/#register-server-app)</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="p">{</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">    </span><span class="n">btc_msg_t</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">    </span><span class="n">btc_ble_gatts_args_t</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_CHECK</span><span class="p">(</span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">);</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">    </span><span class="c1">//if (app_id &lt; ESP_APP_ID_MIN || app_id &gt; ESP_APP_ID_MAX) {</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">app_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ESP_APP_ID_MAX</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_ARG</span><span class="p">;</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_SIG_API_CALL</span><span class="p">;</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_PID_GATTS</span><span class="p">;</span>
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_GATTS_ACT_APP_REGISTER</span><span class="p">;</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">app_reg</span><span class="p">.</span><span class="n">app_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app_id</span><span class="p">;</span>
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a>
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">btc_transfer_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">btc_ble_gatts_args_t</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ESP_OK</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">);</span>
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_ble_gatts_create_service">esp_ble_gatts_create_service</h6>
<p><a href="../Telink/#create-service">Create Service</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_ble_gatts_create_service</span><span class="p">(</span><span class="n">esp_gatt_if_t</span><span class="w"> </span><span class="n">gatts_if</span><span class="p">,</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">                                       </span><span class="n">esp_gatt_srvc_id_t</span><span class="w"> </span><span class="o">*</span><span class="n">service_id</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">num_handle</span><span class="p">)</span><span class="w"> </span><span class="c1">//[Create Service](Telink.md/#create-service)</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="p">{</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">    </span><span class="n">btc_msg_t</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">    </span><span class="n">btc_ble_gatts_args_t</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_CHECK</span><span class="p">(</span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">);</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_SIG_API_CALL</span><span class="p">;</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_PID_GATTS</span><span class="p">;</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_GATTS_ACT_CREATE_SERVICE</span><span class="p">;</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">create_srvc</span><span class="p">.</span><span class="n">gatts_if</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gatts_if</span><span class="p">;</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">create_srvc</span><span class="p">.</span><span class="n">num_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_handle</span><span class="p">;</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arg</span><span class="p">.</span><span class="n">create_srvc</span><span class="p">.</span><span class="n">service_id</span><span class="p">,</span><span class="w"> </span><span class="n">service_id</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">esp_gatt_srvc_id_t</span><span class="p">));</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">btc_transfer_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">btc_ble_gatts_args_t</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ESP_OK</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">);</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_gatt_char_prop_t">esp_gatt_char_prop_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">esp_gatt_char_prop_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="esp_attr_value_t">esp_attr_value_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="p">{</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">attr_max_len</span><span class="p">;</span><span class="w">                                  </span><span class="cm">/* linked  attribute max value length */</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">attr_len</span><span class="p">;</span><span class="w">                                      </span><span class="cm">/* linked  attribute current value length */</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w">  </span><span class="o">*</span><span class="n">attr_value</span><span class="p">;</span><span class="w">                                   </span><span class="cm">/* linked  the pointer to attribute value */</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="p">}</span><span class="w"> </span><span class="n">esp_attr_value_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="esp_ble_gatts_set_attr_value">esp_ble_gatts_set_attr_value</h6>
<p><a href="../Telink/#attribute-values">Attribute Values</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_ble_gatts_set_attr_value</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">attr_handle</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="c1">//[Attribute Values](Telink.md/#attribute-values)</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="p">{</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">    </span><span class="n">btc_msg_t</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">    </span><span class="n">btc_ble_gatts_args_t</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_CHECK</span><span class="p">(</span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">);</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_SIG_API_CALL</span><span class="p">;</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_PID_GATTS</span><span class="p">;</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_GATTS_ACT_SET_ATTR_VALUE</span><span class="p">;</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">set_attr_val</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attr_handle</span><span class="p">;</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">set_attr_val</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">;</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">set_attr_val</span><span class="p">.</span><span class="n">value</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">btc_transfer_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">btc_ble_gatts_args_t</span><span class="p">),</span><span class="w"> </span><span class="n">btc_gatts_arg_deep_copy</span><span class="p">,</span>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="w">                </span><span class="n">btc_gatts_arg_deep_free</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ESP_OK</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">);</span>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_ble_gatts_start_service">esp_ble_gatts_start_service</h6>
<p><a href="../Telink/#gatt-start-service">GATT Start Service</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_ble_gatts_start_service</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">service_handle</span><span class="p">)</span><span class="w"> </span><span class="c1">//[GATT Start Service](Telink.md/#gatt-start-service)</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="p">{</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w">    </span><span class="n">btc_msg_t</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">    </span><span class="n">btc_ble_gatts_args_t</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_CHECK</span><span class="p">(</span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">);</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_SIG_API_CALL</span><span class="p">;</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_PID_GATTS</span><span class="p">;</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_GATTS_ACT_START_SERVICE</span><span class="p">;</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">start_srvc</span><span class="p">.</span><span class="n">service_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service_handle</span><span class="p">;</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">btc_transfer_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">btc_ble_gatts_args_t</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ESP_OK</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">);</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_attr_control_t">esp_attr_control_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="p">{</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="cm">     * @brief Controls who handles the response to Read/Write operations.</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="cm">     *</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="cm">     * - If set to @c ESP_GATT_RSP_BY_APP, the application is responsible for</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="cm">     *   generating the response.</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="cm">     * - If set to @c ESP_GATT_AUTO_RSP, the GATT stack will automatically generate</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="cm">     *   the response.</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="cm">     */</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">auto_rsp</span><span class="p">;</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="p">}</span><span class="w"> </span><span class="n">esp_attr_control_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="esp_gatt_perm_t">esp_gatt_perm_t</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">esp_gatt_perm_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="esp_ble_gatts_add_char_descr">esp_ble_gatts_add_char_descr</h6>
<p><a href="../Telink/#add-characteristic">Add Characteristic</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_ble_gatts_add_char_descr</span><span class="w"> </span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">service_handle</span><span class="p">,</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">                                        </span><span class="n">esp_bt_uuid_t</span><span class="w">   </span><span class="o">*</span><span class="n">descr_uuid</span><span class="p">,</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="w">                                        </span><span class="n">esp_gatt_perm_t</span><span class="w"> </span><span class="n">perm</span><span class="p">,</span><span class="w"> </span><span class="n">esp_attr_value_t</span><span class="w"> </span><span class="o">*</span><span class="n">char_descr_val</span><span class="p">,</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">                                        </span><span class="n">esp_attr_control_t</span><span class="w"> </span><span class="o">*</span><span class="n">control</span><span class="p">)</span><span class="w"> </span><span class="c1">//[Add Characteristic](Telink.md/#add-characteristic)</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="p">{</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">    </span><span class="n">btc_msg_t</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="w">    </span><span class="n">btc_ble_gatts_args_t</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_CHECK</span><span class="p">(</span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">);</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="w">    </span><span class="cm">/* parameter validation check */</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_ble_gatts_add_char_desc_param_check</span><span class="p">(</span><span class="n">char_descr_val</span><span class="p">,</span><span class="w"> </span><span class="n">control</span><span class="p">);</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">){</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">btc_ble_gatts_args_t</span><span class="p">));</span>
</span><span id="__span-52-19"><a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_SIG_API_CALL</span><span class="p">;</span>
</span><span id="__span-52-20"><a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_PID_GATTS</span><span class="p">;</span>
</span><span id="__span-52-21"><a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_GATTS_ACT_ADD_CHAR_DESCR</span><span class="p">;</span>
</span><span id="__span-52-22"><a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">add_descr</span><span class="p">.</span><span class="n">service_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service_handle</span><span class="p">;</span>
</span><span id="__span-52-23"><a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">add_descr</span><span class="p">.</span><span class="n">perm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">perm</span><span class="p">;</span>
</span><span id="__span-52-24"><a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a>
</span><span id="__span-52-25"><a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">char_descr_val</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-26"><a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a><span class="w">        </span><span class="n">arg</span><span class="p">.</span><span class="n">add_descr</span><span class="p">.</span><span class="n">descr_val</span><span class="p">.</span><span class="n">attr_max_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">char_descr_val</span><span class="o">-&gt;</span><span class="n">attr_max_len</span><span class="p">;</span>
</span><span id="__span-52-27"><a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a><span class="w">        </span><span class="n">arg</span><span class="p">.</span><span class="n">add_descr</span><span class="p">.</span><span class="n">descr_val</span><span class="p">.</span><span class="n">attr_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">char_descr_val</span><span class="o">-&gt;</span><span class="n">attr_len</span><span class="p">;</span>
</span><span id="__span-52-28"><a id="__codelineno-52-28" name="__codelineno-52-28" href="#__codelineno-52-28"></a><span class="w">        </span><span class="n">arg</span><span class="p">.</span><span class="n">add_descr</span><span class="p">.</span><span class="n">descr_val</span><span class="p">.</span><span class="n">attr_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">char_descr_val</span><span class="o">-&gt;</span><span class="n">attr_value</span><span class="p">;</span>
</span><span id="__span-52-29"><a id="__codelineno-52-29" name="__codelineno-52-29" href="#__codelineno-52-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-30"><a id="__codelineno-52-30" name="__codelineno-52-30" href="#__codelineno-52-30"></a>
</span><span id="__span-52-31"><a id="__codelineno-52-31" name="__codelineno-52-31" href="#__codelineno-52-31"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">control</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-32"><a id="__codelineno-52-32" name="__codelineno-52-32" href="#__codelineno-52-32"></a><span class="w">        </span><span class="n">arg</span><span class="p">.</span><span class="n">add_descr</span><span class="p">.</span><span class="n">attr_control</span><span class="p">.</span><span class="n">auto_rsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">control</span><span class="o">-&gt;</span><span class="n">auto_rsp</span><span class="p">;</span>
</span><span id="__span-52-33"><a id="__codelineno-52-33" name="__codelineno-52-33" href="#__codelineno-52-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-34"><a id="__codelineno-52-34" name="__codelineno-52-34" href="#__codelineno-52-34"></a><span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arg</span><span class="p">.</span><span class="n">add_descr</span><span class="p">.</span><span class="n">descr_uuid</span><span class="p">,</span><span class="w"> </span><span class="n">descr_uuid</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">esp_bt_uuid_t</span><span class="p">));</span>
</span><span id="__span-52-35"><a id="__codelineno-52-35" name="__codelineno-52-35" href="#__codelineno-52-35"></a>
</span><span id="__span-52-36"><a id="__codelineno-52-36" name="__codelineno-52-36" href="#__codelineno-52-36"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">btc_transfer_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">btc_ble_gatts_args_t</span><span class="p">),</span><span class="w"> </span><span class="n">btc_gatts_arg_deep_copy</span><span class="p">,</span>
</span><span id="__span-52-37"><a id="__codelineno-52-37" name="__codelineno-52-37" href="#__codelineno-52-37"></a><span class="w">                </span><span class="n">btc_gatts_arg_deep_free</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ESP_OK</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">);</span>
</span><span id="__span-52-38"><a id="__codelineno-52-38" name="__codelineno-52-38" href="#__codelineno-52-38"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_ble_adv_data_type">esp_ble_adv_data_type</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_FLAG</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_FLAG in stack/btm_ble_api.h */</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_16SRV_PART</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="mh">0x02</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_16SRV_PART in stack/btm_ble_api.h */</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_16SRV_CMPL</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="mh">0x03</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_16SRV_CMPL in stack/btm_ble_api.h */</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_32SRV_PART</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="mh">0x04</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_32SRV_PART in stack/btm_ble_api.h */</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_32SRV_CMPL</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="mh">0x05</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_32SRV_CMPL in stack/btm_ble_api.h */</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_128SRV_PART</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="mh">0x06</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_128SRV_PART in stack/btm_ble_api.h */</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_128SRV_CMPL</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="mh">0x07</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_128SRV_CMPL in stack/btm_ble_api.h */</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_NAME_SHORT</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="mh">0x08</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_NAME_SHORT in stack/btm_ble_api.h */</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_NAME_CMPL</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="mh">0x09</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_NAME_CMPL in stack/btm_ble_api.h */</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_TX_PWR</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0A</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_TX_PWR in stack/btm_ble_api.h */</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_DEV_CLASS</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0D</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_DEV_CLASS in stack/btm_ble_api.h */</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_SM_TK</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="mh">0x10</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_SM_TK in stack/btm_ble_api.h */</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_SM_OOB_FLAG</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="mh">0x11</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_SM_OOB_FLAG in stack/btm_ble_api.h */</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_INT_RANGE</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="mh">0x12</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_INT_RANGE in stack/btm_ble_api.h */</span>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_SOL_SRV_UUID</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="mh">0x14</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_SOL_SRV_UUID in stack/btm_ble_api.h */</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_128SOL_SRV_UUID</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mh">0x15</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_128SOL_SRV_UUID in stack/btm_ble_api.h */</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_SERVICE_DATA</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="mh">0x16</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_SERVICE_DATA in stack/btm_ble_api.h */</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_PUBLIC_TARGET</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="mh">0x17</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_PUBLIC_TARGET in stack/btm_ble_api.h */</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_RANDOM_TARGET</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="mh">0x18</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_RANDOM_TARGET in stack/btm_ble_api.h */</span>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_APPEARANCE</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="mh">0x19</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_APPEARANCE in stack/btm_ble_api.h */</span>
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_ADV_INT</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1A</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_ADV_INT in stack/btm_ble_api.h */</span>
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_LE_DEV_ADDR</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1b</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_LE_DEV_ADDR in stack/btm_ble_api.h */</span>
</span><span id="__span-53-24"><a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_LE_ROLE</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1c</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_LE_ROLE in stack/btm_ble_api.h */</span>
</span><span id="__span-53-25"><a id="__codelineno-53-25" name="__codelineno-53-25" href="#__codelineno-53-25"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_SPAIR_C256</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1d</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_SPAIR_C256 in stack/btm_ble_api.h */</span>
</span><span id="__span-53-26"><a id="__codelineno-53-26" name="__codelineno-53-26" href="#__codelineno-53-26"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_SPAIR_R256</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1e</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_SPAIR_R256 in stack/btm_ble_api.h */</span>
</span><span id="__span-53-27"><a id="__codelineno-53-27" name="__codelineno-53-27" href="#__codelineno-53-27"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_32SOL_SRV_UUID</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1f</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_32SOL_SRV_UUID in stack/btm_ble_api.h */</span>
</span><span id="__span-53-28"><a id="__codelineno-53-28" name="__codelineno-53-28" href="#__codelineno-53-28"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_32SERVICE_DATA</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="mh">0x20</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_32SERVICE_DATA in stack/btm_ble_api.h */</span>
</span><span id="__span-53-29"><a id="__codelineno-53-29" name="__codelineno-53-29" href="#__codelineno-53-29"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_128SERVICE_DATA</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mh">0x21</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_128SERVICE_DATA in stack/btm_ble_api.h */</span>
</span><span id="__span-53-30"><a id="__codelineno-53-30" name="__codelineno-53-30" href="#__codelineno-53-30"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_LE_SECURE_CONFIRM</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mh">0x22</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_LE_SECURE_CONFIRM in stack/btm_ble_api.h */</span>
</span><span id="__span-53-31"><a id="__codelineno-53-31" name="__codelineno-53-31" href="#__codelineno-53-31"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_LE_SECURE_RANDOM</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mh">0x23</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_LE_SECURE_RANDOM in stack/btm_ble_api.h */</span>
</span><span id="__span-53-32"><a id="__codelineno-53-32" name="__codelineno-53-32" href="#__codelineno-53-32"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_URI</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="mh">0x24</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_URI in stack/btm_ble_api.h */</span>
</span><span id="__span-53-33"><a id="__codelineno-53-33" name="__codelineno-53-33" href="#__codelineno-53-33"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_INDOOR_POSITION</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mh">0x25</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_INDOOR_POSITION in stack/btm_ble_api.h */</span>
</span><span id="__span-53-34"><a id="__codelineno-53-34" name="__codelineno-53-34" href="#__codelineno-53-34"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_TRANS_DISC_DATA</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mh">0x26</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_TRANS_DISC_DATA in stack/btm_ble_api.h */</span>
</span><span id="__span-53-35"><a id="__codelineno-53-35" name="__codelineno-53-35" href="#__codelineno-53-35"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_LE_SUPPORT_FEATURE</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">0x27</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_LE_SUPPORT_FEATURE in stack/btm_ble_api.h */</span>
</span><span id="__span-53-36"><a id="__codelineno-53-36" name="__codelineno-53-36" href="#__codelineno-53-36"></a><span class="w">    </span><span class="n">ESP_BLE_AD_TYPE_CHAN_MAP_UPDATE</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mh">0x28</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_TYPE_CHAN_MAP_UPDATE in stack/btm_ble_api.h */</span>
</span><span id="__span-53-37"><a id="__codelineno-53-37" name="__codelineno-53-37" href="#__codelineno-53-37"></a><span class="w">    </span><span class="n">ESP_BLE_AD_MANUFACTURER_SPECIFIC_TYPE</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span><span class="w">    </span><span class="cm">/* relate to BTM_BLE_AD_MANUFACTURER_SPECIFIC_TYPE in stack/btm_ble_api.h */</span>
</span><span id="__span-53-38"><a id="__codelineno-53-38" name="__codelineno-53-38" href="#__codelineno-53-38"></a><span class="p">}</span><span class="w"> </span><span class="n">esp_ble_adv_data_type</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="esp_ble_adv_params_t">esp_ble_adv_params_t</h6>
<div class="language-c highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w">                </span><span class="n">adv_int_min</span><span class="p">;</span><span class="w">        </span><span class="cm">/* linked Minimum advertising interval for</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="cm">                                                  undirected and low duty cycle directed advertising.</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="cm">                                                  Range: 0x0020 to 0x4000 Default: N = 0x0800 (1.28 second)</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="cm">                                                  Time = N * 0.625 msec Time Range: 20 ms to 10.24 sec */</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w">                </span><span class="n">adv_int_max</span><span class="p">;</span><span class="w">        </span><span class="cm">/* linked Maximum advertising interval for</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="cm">                                                  undirected and low duty cycle directed advertising.</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="cm">                                                  Range: 0x0020 to 0x4000 Default: N = 0x0800 (1.28 second)</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="cm">                                                  Time = N * 0.625 msec Time Range: 20 ms to 10.24 sec Advertising max interval */</span>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="w">    </span><span class="n">esp_ble_adv_type_t</span><span class="w">      </span><span class="n">adv_type</span><span class="p">;</span><span class="w">           </span><span class="cm">/* linked Advertising type */</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="w">    </span><span class="n">esp_ble_addr_type_t</span><span class="w">     </span><span class="n">own_addr_type</span><span class="p">;</span><span class="w">      </span><span class="cm">/* linked Owner bluetooth device address type */</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="w">    </span><span class="n">esp_bd_addr_t</span><span class="w">           </span><span class="n">peer_addr</span><span class="p">;</span><span class="w">          </span><span class="cm">/* linked Peer device bluetooth device address */</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="w">    </span><span class="n">esp_ble_addr_type_t</span><span class="w">     </span><span class="n">peer_addr_type</span><span class="p">;</span><span class="w">     </span><span class="cm">/* linked Peer device bluetooth device address type, only support public address type and random address type */</span>
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a><span class="w">    </span><span class="n">esp_ble_adv_channel_t</span><span class="w">   </span><span class="n">channel_map</span><span class="p">;</span><span class="w">        </span><span class="cm">/* linked Advertising channel map */</span>
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a><span class="w">    </span><span class="n">esp_ble_adv_filter_t</span><span class="w">    </span><span class="n">adv_filter_policy</span><span class="p">;</span><span class="w">  </span><span class="cm">/* linked Advertising filter policy */</span>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a><span class="p">}</span><span class="w"> </span><span class="n">esp_ble_adv_params_t</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="esp_ble_gatts_send_indicate">esp_ble_gatts_send_indicate</h6>
<p><a href="../Telink/#gatts-notify">GATTS Notify</a>
<div class="language-c highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">esp_ble_gatts_send_indicate</span><span class="p">(</span><span class="n">esp_gatt_if_t</span><span class="w"> </span><span class="n">gatts_if</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">conn_id</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">attr_handle</span><span class="p">,</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">                                      </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">value_len</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">need_confirm</span><span class="p">)</span><span class="w"> </span><span class="c1">//[GATTS Notify](Telink.md/#gatts-notify)</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="p">{</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value_len</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ESP_GATT_MAX_ATTR_LEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">        </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;%s, value_len &gt; ESP_GATT_MAX_ATTR_LEN.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">__func__</span><span class="p">);</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_SIZE</span><span class="p">;</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="w">    </span><span class="n">btc_msg_t</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">    </span><span class="n">btc_ble_gatts_args_t</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="w">    </span><span class="n">ESP_BLUEDROID_STATUS_CHECK</span><span class="p">(</span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">);</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a><span class="w">    </span><span class="n">tGATT_TCB</span><span class="w">       </span><span class="o">*</span><span class="n">p_tcb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gatt_get_tcb_by_idx</span><span class="p">(</span><span class="n">conn_id</span><span class="p">);</span>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">gatt_check_connection_state_by_tcb</span><span class="p">(</span><span class="n">p_tcb</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="w">        </span><span class="n">LOG_WARN</span><span class="p">(</span><span class="s">&quot;%s, The connection not created.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">__func__</span><span class="p">);</span>
</span><span id="__span-55-17"><a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_ERR_INVALID_STATE</span><span class="p">;</span>
</span><span id="__span-55-18"><a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-55-19"><a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a>
</span><span id="__span-55-20"><a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L2CA_CheckIsCongest</span><span class="p">(</span><span class="n">L2CAP_ATT_CID</span><span class="p">,</span><span class="w"> </span><span class="n">p_tcb</span><span class="o">-&gt;</span><span class="n">peer_bda</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-21"><a id="__codelineno-55-21" name="__codelineno-55-21" href="#__codelineno-55-21"></a><span class="w">        </span><span class="n">LOG_DEBUG</span><span class="p">(</span><span class="s">&quot;%s, the l2cap channel is congest.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">__func__</span><span class="p">);</span>
</span><span id="__span-55-22"><a id="__codelineno-55-22" name="__codelineno-55-22" href="#__codelineno-55-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">;</span>
</span><span id="__span-55-23"><a id="__codelineno-55-23" name="__codelineno-55-23" href="#__codelineno-55-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-55-24"><a id="__codelineno-55-24" name="__codelineno-55-24" href="#__codelineno-55-24"></a>
</span><span id="__span-55-25"><a id="__codelineno-55-25" name="__codelineno-55-25" href="#__codelineno-55-25"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_SIG_API_CALL</span><span class="p">;</span>
</span><span id="__span-55-26"><a id="__codelineno-55-26" name="__codelineno-55-26" href="#__codelineno-55-26"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_PID_GATTS</span><span class="p">;</span>
</span><span id="__span-55-27"><a id="__codelineno-55-27" name="__codelineno-55-27" href="#__codelineno-55-27"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_GATTS_ACT_SEND_INDICATE</span><span class="p">;</span>
</span><span id="__span-55-28"><a id="__codelineno-55-28" name="__codelineno-55-28" href="#__codelineno-55-28"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">send_ind</span><span class="p">.</span><span class="n">conn_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTC_GATT_CREATE_CONN_ID</span><span class="p">(</span><span class="n">gatts_if</span><span class="p">,</span><span class="w"> </span><span class="n">conn_id</span><span class="p">);</span>
</span><span id="__span-55-29"><a id="__codelineno-55-29" name="__codelineno-55-29" href="#__codelineno-55-29"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">send_ind</span><span class="p">.</span><span class="n">attr_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attr_handle</span><span class="p">;</span>
</span><span id="__span-55-30"><a id="__codelineno-55-30" name="__codelineno-55-30" href="#__codelineno-55-30"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">send_ind</span><span class="p">.</span><span class="n">need_confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">need_confirm</span><span class="p">;</span>
</span><span id="__span-55-31"><a id="__codelineno-55-31" name="__codelineno-55-31" href="#__codelineno-55-31"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">send_ind</span><span class="p">.</span><span class="n">value_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value_len</span><span class="p">;</span>
</span><span id="__span-55-32"><a id="__codelineno-55-32" name="__codelineno-55-32" href="#__codelineno-55-32"></a><span class="w">    </span><span class="n">arg</span><span class="p">.</span><span class="n">send_ind</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-55-33"><a id="__codelineno-55-33" name="__codelineno-55-33" href="#__codelineno-55-33"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">need_confirm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="p">){</span>
</span><span id="__span-55-34"><a id="__codelineno-55-34" name="__codelineno-55-34" href="#__codelineno-55-34"></a><span class="w">        </span><span class="n">l2ble_update_att_acl_pkt_num</span><span class="p">(</span><span class="n">L2CA_ADD_BTC_NUM</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</span><span id="__span-55-35"><a id="__codelineno-55-35" name="__codelineno-55-35" href="#__codelineno-55-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-55-36"><a id="__codelineno-55-36" name="__codelineno-55-36" href="#__codelineno-55-36"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">btc_transfer_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">btc_ble_gatts_args_t</span><span class="p">),</span><span class="w"> </span><span class="n">btc_gatts_arg_deep_copy</span><span class="p">,</span>
</span><span id="__span-55-37"><a id="__codelineno-55-37" name="__codelineno-55-37" href="#__codelineno-55-37"></a><span class="w">                </span><span class="n">btc_gatts_arg_deep_free</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BT_STATUS_SUCCESS</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ESP_OK</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">);</span>
</span><span id="__span-55-38"><a id="__codelineno-55-38" name="__codelineno-55-38" href="#__codelineno-55-38"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="esp_gatt_status_t">esp_gatt_status_t</h6>
<p>```c
typedef enum {
    ESP_GATT_OK                     =   0x0,    /<em> linked 0x0, Operation successful. Corresponds to BTA_GATT_OK. </em>/
    ESP_GATT_INVALID_HANDLE         =   0x01,   /<em> linked 0x01, Invalid handle. Corresponds to BTA_GATT_INVALID_HANDLE. </em>/
    ESP_GATT_READ_NOT_PERMIT        =   0x02,   /<em> linked 0x02, Read operation not permitted. Corresponds to BTA_GATT_READ_NOT_PERMIT. </em>/
    ESP_GATT_WRITE_NOT_PERMIT       =   0x03,   /<em> linked 0x03, Write operation not permitted. Corresponds to BTA_GATT_WRITE_NOT_PERMIT. </em>/
    ESP_GATT_INVALID_PDU            =   0x04,   /<em> linked 0x04, Invalid PDU. Corresponds to BTA_GATT_INVALID_PDU. </em>/
    ESP_GATT_INSUF_AUTHENTICATION   =   0x05,   /<em> linked 0x05, Insufficient authentication. Corresponds to BTA_GATT_INSUF_AUTHENTICATION. </em>/
    ESP_GATT_REQ_NOT_SUPPORTED      =   0x06,   /<em> linked 0x06, Request not supported. Corresponds to BTA_GATT_REQ_NOT_SUPPORTED. </em>/
    ESP_GATT_INVALID_OFFSET         =   0x07,   /<em> linked 0x07, Invalid offset. Corresponds to BTA_GATT_INVALID_OFFSET. </em>/
    ESP_GATT_INSUF_AUTHORIZATION    =   0x08,   /<em> linked 0x08, Insufficient authorization. Corresponds to BTA_GATT_INSUF_AUTHORIZATION. </em>/
    ESP_GATT_PREPARE_Q_FULL         =   0x09,   /<em> linked 0x09, Prepare queue full. Corresponds to BTA_GATT_PREPARE_Q_FULL. </em>/
    ESP_GATT_NOT_FOUND              =   0x0a,   /<em> linked 0x0a, Not found. Corresponds to BTA_GATT_NOT_FOUND. </em>/
    ESP_GATT_NOT_LONG               =   0x0b,   /<em> linked 0x0b, Not long. Corresponds to BTA_GATT_NOT_LONG. </em>/
    ESP_GATT_INSUF_KEY_SIZE         =   0x0c,   /<em> linked 0x0c, Insufficient key size. Corresponds to BTA_GATT_INSUF_KEY_SIZE. </em>/
    ESP_GATT_INVALID_ATTR_LEN       =   0x0d,   /<em> linked 0x0d, Invalid attribute length. Corresponds to BTA_GATT_INVALID_ATTR_LEN. </em>/
    ESP_GATT_ERR_UNLIKELY           =   0x0e,   /<em> linked 0x0e, Unlikely error. Corresponds to BTA_GATT_ERR_UNLIKELY. </em>/
    ESP_GATT_INSUF_ENCRYPTION       =   0x0f,   /<em> linked 0x0f, Insufficient encryption. Corresponds to BTA_GATT_INSUF_ENCRYPTION. </em>/
    ESP_GATT_UNSUPPORT_GRP_TYPE     =   0x10,   /<em> linked 0x10, Unsupported group type. Corresponds to BTA_GATT_UNSUPPORT_GRP_TYPE. </em>/
    ESP_GATT_INSUF_RESOURCE         =   0x11,   /<em> linked 0x11, Insufficient resource. Corresponds to BTA_GATT_INSUF_RESOURCE. </em>/</p>
<div class="language-text highlight"><pre><span></span><code>/* Additional error codes specific to implementation or future use */
ESP_GATT_NO_RESOURCES           =   0x80,   /* linked 0x80, No resources. Corresponds to BTA_GATT_NO_RESOURCES. */
ESP_GATT_INTERNAL_ERROR         =   0x81,   /* linked 0x81, Internal error. Corresponds to BTA_GATT_INTERNAL_ERROR. */
ESP_GATT_WRONG_STATE            =   0x82,   /* linked 0x82, Wrong state. Corresponds to BTA_GATT_WRONG_STATE. */
ESP_GATT_DB_FULL                =   0x83,   /* linked 0x83, Database full. Corresponds to BTA_GATT_DB_FULL. */
ESP_GATT_BUSY                   =   0x84,   /* linked 0x84, Busy. Corresponds to BTA_GATT_BUSY. */
ESP_GATT_ERROR                  =   0x85,   /* linked 0x85, Generic error. Corresponds to BTA_GATT_ERROR. */
ESP_GATT_CMD_STARTED            =   0x86,   /* linked 0x86, Command started. Corresponds to BTA_GATT_CMD_STARTED. */
ESP_GATT_ILLEGAL_PARAMETER      =   0x87,   /* linked 0x87, Illegal parameter. Corresponds to BTA_GATT_ILLEGAL_PARAMETER. */
ESP_GATT_PENDING                =   0x88,   /* linked 0x88, Operation pending. Corresponds to BTA_GATT_PENDING. */
ESP_GATT_AUTH_FAIL              =   0x89,   /* linked 0x89, Authentication failed. Corresponds to BTA_GATT_AUTH_FAIL. */
ESP_GATT_MORE                   =   0x8a,   /* linked 0x8a, More data available. Corresponds to BTA_GATT_MORE. */
ESP_GATT_INVALID_CFG            =   0x8b,   /* linked 0x8b, Invalid configuration. Corresponds to BTA_GATT_INVALID_CFG. */
ESP_GATT_SERVICE_STARTED        =   0x8c,   /* linked 0x8c, Service started. Corresponds to BTA_GATT_SERVICE_STARTED. */
ESP_GATT_ENCRYPTED_MITM         =   ESP_GATT_OK, /* linked 0x0, Encrypted, with MITM protection. Corresponds to BTA_GATT_ENCRYPTED_MITM. */
ESP_GATT_ENCRYPTED_NO_MITM      =   0x8d,   /* linked 0x8d, Encrypted, without MITM protection. Corresponds to BTA_GATT_ENCRYPTED_NO_MITM. */
ESP_GATT_NOT_ENCRYPTED          =   0x8e,   /* linked 0x8e, Not encrypted. Corresponds to BTA_GATT_NOT_ENCRYPTED. */
ESP_GATT_CONGESTED              =   0x8f,   /* linked 0x8f, Congested. Corresponds to BTA_GATT_CONGESTED. */
ESP_GATT_DUP_REG                =   0x90,   /* linked 0x90, Duplicate registration. Corresponds to BTA_GATT_DUP_REG. */
ESP_GATT_ALREADY_OPEN           =   0x91,   /* linked 0x91, Already open. Corresponds to BTA_GATT_ALREADY_OPEN. */
ESP_GATT_CANCEL                 =   0x92,   /* linked 0x92, Operation cancelled. Corresponds to BTA_GATT_CANCEL. */
/* 0xE0 ~ 0xFC reserved for future use */
ESP_GATT_STACK_RSP              =   0xe0,   /* linked 0xe0, Stack response. Corresponds to BTA_GATT_STACK_RSP. */
ESP_GATT_APP_RSP                =   0xe1,   /* linked 0xe1, Application response. Corresponds to BTA_GATT_APP_RSP. */
/* Error caused by customer application or stack bug */
ESP_GATT_UNKNOWN_ERROR          =   0xef,   /* linked 0xef, Unknown error. Corresponds to BTA_GATT_UNKNOWN_ERROR. */
ESP_GATT_CCC_CFG_ERR            =   0xfd,   /* linked 0xfd, Client Characteristic Configuration Descriptor improperly configured. Corresponds to BTA_GATT_CCC_CFG_ERR. */
ESP_GATT_PRC_IN_PROGRESS        =   0xfe,   /* linked 0xfe, Procedure already in progress. Corresponds to BTA_GATT_PRC_IN_PROGRESS. */
ESP_GATT_OUT_OF_RANGE           =   0xff    /* linked 0xff, Attribute value out of range. Corresponds to BTA_GATT_OUT_OF_RANGE. */
</code></pre></div>
<p>} esp_gatt_status_t;</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>