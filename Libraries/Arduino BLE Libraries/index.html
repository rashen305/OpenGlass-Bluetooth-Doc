
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://sitename.example/Libraries/Arduino%20BLE%20Libraries/">
      
      
        <link rel="prev" href="../../Firmware/">
      
      
        <link rel="next" href="../ESP-IDF/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Arduino BLE Libraries - OpenGlass Firmware Bluetooth Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather+Sans:300,300i,400,400i,700,700i%7CRed+Hat+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Merriweather Sans";--md-code-font:"Red Hat Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bleuuid-constructor" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OpenGlass Firmware Bluetooth Documentation" class="md-header__button md-logo" aria-label="OpenGlass Firmware Bluetooth Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OpenGlass Firmware Bluetooth Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Arduino BLE Libraries
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OpenGlass Firmware Bluetooth Documentation" class="md-nav__button md-logo" aria-label="OpenGlass Firmware Bluetooth Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    OpenGlass Firmware Bluetooth Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to MkDocs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Firmware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Firmware
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Libraries
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Libraries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Arduino BLE Libraries
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Arduino BLE Libraries
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bleuuid-constructor" class="md-nav__link">
    <span class="md-ellipsis">
      BLEUUID Constructor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservercallbacks" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServerCallbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristiccallbacks" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristicCallbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#characteristic-getlength" class="md-nav__link">
    <span class="md-ellipsis">
      characteristic-&gt;getLength()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#characteristic-getdata" class="md-nav__link">
    <span class="md-ellipsis">
      characteristic-&gt;getData()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blevalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLEValue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledeviceinit" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDevice::init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btstart" class="md-nav__link">
    <span class="md-ellipsis">
      btStart()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btstartmode" class="md-nav__link">
    <span class="md-ellipsis">
      btStartMode()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledevicecreateserver" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDevice::createServer()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleserverbleserver" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServer::BLEServer()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservercreateapp" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServer::createApp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleserverregisterapp" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServer::registerApp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#m_semaphoreregisterappevt" class="md-nav__link">
    <span class="md-ellipsis">
      m_semaphoreRegisterAppEvt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setcallbacks" class="md-nav__link">
    <span class="md-ellipsis">
      setCallbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-createservice" class="md-nav__link">
    <span class="md-ellipsis">
      server-&gt;createService
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservercreateservice" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServer::createService
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservicebleservice" class="md-nav__link">
    <span class="md-ellipsis">
      BLEService::BLEService
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservicemap" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServiceMap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservicemapgetbyuuid" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServiceMap::getByUUID
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservicemapsetbyuuid" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServiceMap::setByUUID
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stdmap" class="md-nav__link">
    <span class="md-ellipsis">
      std::map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleserviceexecutecreate" class="md-nav__link">
    <span class="md-ellipsis">
      BLEService::executeCreate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-createcharacteristic" class="md-nav__link">
    <span class="md-ellipsis">
      server-&gt;createCharacteristic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicblecharacteristic" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic::BLECharacteristic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#addcharacteristic" class="md-nav__link">
    <span class="md-ellipsis">
      addCharacteristic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicsetbroadcastproperty" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic::setBroadcastProperty
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ble2902" class="md-nav__link">
    <span class="md-ellipsis">
      BLE2902()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledescriptorsetvalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDescriptor::setValue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setnotifications" class="md-nav__link">
    <span class="md-ellipsis">
      setNotifications()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledescriptorgetvalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDescriptor::getValue()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adddescriptor" class="md-nav__link">
    <span class="md-ellipsis">
      addDescriptor()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stdmap_1" class="md-nav__link">
    <span class="md-ellipsis">
      std::map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristic-setvalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic-&gt;setValue()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicsetvalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic::setValue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blevaluesetvalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLEValue::setValue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservice-start" class="md-nav__link">
    <span class="md-ellipsis">
      BLEservice-&gt;start()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicexecutecreate" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic::executeCreate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledescriptorexecutecreate" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDescriptor::executeCreate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledescriptormap" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDescriptorMap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledescriptorbledescriptor" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDescriptor::BLEDescriptor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicmap" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristicMap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicmapgetfirst" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristicMap::getFirst()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicmapgetnext" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristicMap::getNext
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledevicegetadvertising" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDevice::getAdvertising
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleadvertisingbleadvertising" class="md-nav__link">
    <span class="md-ellipsis">
      BLEAdvertising::BLEAdvertising()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleadvertising-addserviceuuid" class="md-nav__link">
    <span class="md-ellipsis">
      BLEAdvertising-&gt;addServiceUUID()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservice-getuuid" class="md-nav__link">
    <span class="md-ellipsis">
      BLEService-&gt;getUUID()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleadvertising-setscanresponse" class="md-nav__link">
    <span class="md-ellipsis">
      BLEAdvertising-&gt;setScanResponse()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleadvertising-setminmaxpreferred" class="md-nav__link">
    <span class="md-ellipsis">
      BLEAdvertising-&gt;setMin/MaxPreferred()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledevicestartadvertising" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDevice::startAdvertising()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledevicegetadvertising_1" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDevice::getAdvertising
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristic-notify" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic-&gt;notify()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicgetdescriptorbyuuid" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic::getDescriptorByUUID
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ble2902getnotifications" class="md-nav__link">
    <span class="md-ellipsis">
      BLE2902::getNotifications
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ble2902getindications" class="md-nav__link">
    <span class="md-ellipsis">
      BLE2902::getIndications
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservergetpeerdevices" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServer::getPeerDevices
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ESP-IDF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ESP IDF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Telink/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Telink
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bleuuid-constructor" class="md-nav__link">
    <span class="md-ellipsis">
      BLEUUID Constructor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservercallbacks" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServerCallbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristiccallbacks" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristicCallbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#characteristic-getlength" class="md-nav__link">
    <span class="md-ellipsis">
      characteristic-&gt;getLength()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#characteristic-getdata" class="md-nav__link">
    <span class="md-ellipsis">
      characteristic-&gt;getData()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blevalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLEValue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledeviceinit" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDevice::init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btstart" class="md-nav__link">
    <span class="md-ellipsis">
      btStart()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btstartmode" class="md-nav__link">
    <span class="md-ellipsis">
      btStartMode()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledevicecreateserver" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDevice::createServer()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleserverbleserver" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServer::BLEServer()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservercreateapp" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServer::createApp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleserverregisterapp" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServer::registerApp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#m_semaphoreregisterappevt" class="md-nav__link">
    <span class="md-ellipsis">
      m_semaphoreRegisterAppEvt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setcallbacks" class="md-nav__link">
    <span class="md-ellipsis">
      setCallbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-createservice" class="md-nav__link">
    <span class="md-ellipsis">
      server-&gt;createService
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservercreateservice" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServer::createService
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservicebleservice" class="md-nav__link">
    <span class="md-ellipsis">
      BLEService::BLEService
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservicemap" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServiceMap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservicemapgetbyuuid" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServiceMap::getByUUID
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservicemapsetbyuuid" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServiceMap::setByUUID
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stdmap" class="md-nav__link">
    <span class="md-ellipsis">
      std::map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleserviceexecutecreate" class="md-nav__link">
    <span class="md-ellipsis">
      BLEService::executeCreate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-createcharacteristic" class="md-nav__link">
    <span class="md-ellipsis">
      server-&gt;createCharacteristic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicblecharacteristic" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic::BLECharacteristic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#addcharacteristic" class="md-nav__link">
    <span class="md-ellipsis">
      addCharacteristic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicsetbroadcastproperty" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic::setBroadcastProperty
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ble2902" class="md-nav__link">
    <span class="md-ellipsis">
      BLE2902()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledescriptorsetvalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDescriptor::setValue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setnotifications" class="md-nav__link">
    <span class="md-ellipsis">
      setNotifications()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledescriptorgetvalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDescriptor::getValue()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adddescriptor" class="md-nav__link">
    <span class="md-ellipsis">
      addDescriptor()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stdmap_1" class="md-nav__link">
    <span class="md-ellipsis">
      std::map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristic-setvalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic-&gt;setValue()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicsetvalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic::setValue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blevaluesetvalue" class="md-nav__link">
    <span class="md-ellipsis">
      BLEValue::setValue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservice-start" class="md-nav__link">
    <span class="md-ellipsis">
      BLEservice-&gt;start()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicexecutecreate" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic::executeCreate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledescriptorexecutecreate" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDescriptor::executeCreate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledescriptormap" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDescriptorMap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledescriptorbledescriptor" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDescriptor::BLEDescriptor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicmap" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristicMap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicmapgetfirst" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristicMap::getFirst()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicmapgetnext" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristicMap::getNext
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledevicegetadvertising" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDevice::getAdvertising
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleadvertisingbleadvertising" class="md-nav__link">
    <span class="md-ellipsis">
      BLEAdvertising::BLEAdvertising()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleadvertising-addserviceuuid" class="md-nav__link">
    <span class="md-ellipsis">
      BLEAdvertising-&gt;addServiceUUID()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservice-getuuid" class="md-nav__link">
    <span class="md-ellipsis">
      BLEService-&gt;getUUID()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleadvertising-setscanresponse" class="md-nav__link">
    <span class="md-ellipsis">
      BLEAdvertising-&gt;setScanResponse()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleadvertising-setminmaxpreferred" class="md-nav__link">
    <span class="md-ellipsis">
      BLEAdvertising-&gt;setMin/MaxPreferred()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledevicestartadvertising" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDevice::startAdvertising()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bledevicegetadvertising_1" class="md-nav__link">
    <span class="md-ellipsis">
      BLEDevice::getAdvertising
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristic-notify" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic-&gt;notify()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blecharacteristicgetdescriptorbyuuid" class="md-nav__link">
    <span class="md-ellipsis">
      BLECharacteristic::getDescriptorByUUID
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ble2902getnotifications" class="md-nav__link">
    <span class="md-ellipsis">
      BLE2902::getNotifications
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ble2902getindications" class="md-nav__link">
    <span class="md-ellipsis">
      BLE2902::getIndications
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bleservergetpeerdevices" class="md-nav__link">
    <span class="md-ellipsis">
      BLEServer::getPeerDevices
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Arduino BLE Libraries</h1>

<h6 id="bleuuid-constructor">BLEUUID Constructor</h6>
<p><a href="../ESP-IDF/#uuid-type">esp_bt_uuid_t</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">BLEUUID</span><span class="o">::</span><span class="n">BLEUUID</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="c1">//Serial.printf(&quot;BLEUUID constructor from String=\&quot;%s\&quot;\n&quot;, value.c_str());</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="n">m_valueSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="n">m_uuid</span><span class="p">.</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_UUID_LEN_16</span><span class="p">;</span><span class="w"> </span><span class="c1">//defined as linked m_uuid;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="n">m_uuid</span><span class="p">.</span><span class="n">uuid</span><span class="p">.</span><span class="n">uuid16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">length</span><span class="p">();)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">MSB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">c_str</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">LSB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">c_str</span><span class="p">()[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MSB</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">        </span><span class="n">MSB</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LSB</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">        </span><span class="n">LSB</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">      </span><span class="n">m_uuid</span><span class="p">.</span><span class="n">uuid</span><span class="p">.</span><span class="n">uuid16</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(((</span><span class="n">MSB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0F</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">LSB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0F</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">      </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">    </span><span class="n">m_uuid</span><span class="p">.</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_UUID_LEN_32</span><span class="p">;</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">    </span><span class="n">m_uuid</span><span class="p">.</span><span class="n">uuid</span><span class="p">.</span><span class="n">uuid32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">length</span><span class="p">();)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">MSB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">c_str</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">LSB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">c_str</span><span class="p">()[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MSB</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="w">        </span><span class="n">MSB</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LSB</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="w">        </span><span class="n">LSB</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="w">      </span><span class="n">m_uuid</span><span class="p">.</span><span class="n">uuid</span><span class="p">.</span><span class="n">uuid32</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(((</span><span class="n">MSB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0F</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">LSB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0F</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="w">      </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">length</span><span class="p">()</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="w">             </span><span class="o">==</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// How we can have 16 byte length string representing 128 bit uuid??? needs to be investigated (lack of time) - maybe raw data encoded as String (128b==16B)?</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="w">    </span><span class="n">m_uuid</span><span class="p">.</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_UUID_LEN_128</span><span class="p">;</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="w">    </span><span class="n">memrcpy</span><span class="p">(</span><span class="n">m_uuid</span><span class="p">.</span><span class="n">uuid</span><span class="p">.</span><span class="n">uuid128</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">value</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="w">    </span><span class="c1">//log_d(&quot;36 characters:&quot;);</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="w">    </span><span class="c1">// If the length of the string is 36 bytes then we will assume it is a long hex string in</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="w">    </span><span class="c1">// UUID format.</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="w">    </span><span class="n">m_uuid</span><span class="p">.</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_UUID_LEN_128</span><span class="p">;</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">length</span><span class="p">();)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">c_str</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;-&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="w">        </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">MSB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">c_str</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">LSB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">c_str</span><span class="p">()[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MSB</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="w">        </span><span class="n">MSB</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LSB</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="w">        </span><span class="n">LSB</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="w">      </span><span class="n">m_uuid</span><span class="p">.</span><span class="n">uuid</span><span class="p">.</span><span class="n">uuid128</span><span class="p">[</span><span class="mi">15</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">MSB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0F</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">LSB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0F</span><span class="p">);</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="w">      </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="w">    </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;ERROR: UUID value not 2, 4, 16 or 36 bytes&quot;</span><span class="p">);</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="w">    </span><span class="n">m_valueSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="p">}</span><span class="w">  </span><span class="c1">//BLEUUID(String)</span>
</span></code></pre></div></p>
<h6 id="bleservercallbacks">BLEServerCallbacks</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEServerCallbacks::onConnect</span><span class="p">(</span><span class="n">BLEServer</span><span class="w"> </span><span class="o">*</span><span class="n">pServer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;BLEServerCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;&gt; onConnect(): Default&quot;</span><span class="p">);</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;BLEServerCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Device: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BLEDevice</span><span class="o">::</span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;BLEServerCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&lt;&lt; onConnect()&quot;</span><span class="p">);</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="p">}</span><span class="w">  </span><span class="c1">// onConnect</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEServerCallbacks::onDisconnect</span><span class="p">(</span><span class="n">BLEServer</span><span class="w"> </span><span class="o">*</span><span class="n">pServer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;BLEServerCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;&gt; onDisconnect(): Default&quot;</span><span class="p">);</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;BLEServerCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Device: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BLEDevice</span><span class="o">::</span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;BLEServerCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&lt;&lt; onDisconnect()&quot;</span><span class="p">);</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="p">}</span><span class="w">  </span><span class="c1">// onDisconnect</span>
</span></code></pre></div>
<h6 id="blecharacteristiccallbacks">BLECharacteristicCallbacks</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLECharacteristicCallbacks::onWrite</span><span class="p">(</span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;&gt;&gt; onWrite: default&quot;</span><span class="p">);</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;&lt;&lt; onWrite&quot;</span><span class="p">);</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="p">}</span><span class="w">  </span><span class="c1">// onWrite</span>
</span></code></pre></div>
<h6 id="characteristic-getlength">characteristic-&gt;getLength()</h6>
<p><a href="./#blevalue">BLEValue</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kt">size_t</span><span class="w"> </span><span class="nf">BLECharacteristic::getLength</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">m_value</span><span class="p">.</span><span class="n">getLength</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked m_value; private variable in the class</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// getLength</span>
</span></code></pre></div></p>
<h6 id="characteristic-getdata">characteristic-&gt;getData()</h6>
<p><a href="./#blevalue">BLEValue</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="nf">BLECharacteristic::getData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">m_value</span><span class="p">.</span><span class="n">getData</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked m_value; private variable in the class</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// getData</span>
</span></code></pre></div></p>
<h6 id="blevalue">BLEValue</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">BLEValue</span><span class="o">::</span><span class="n">BLEValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="n">m_accumulation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">//String m_accumulation;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="n">m_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">//String m_value;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="n">m_readOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">//uint16_t m_readOffset;</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="p">}</span><span class="w">  </span><span class="c1">// BLEValue</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="kt">size_t</span><span class="w"> </span><span class="n">BLEValue</span><span class="o">::</span><span class="n">getLength</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">m_value</span><span class="p">.</span><span class="n">length</span><span class="p">();</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="p">}</span><span class="w">  </span><span class="c1">// getLength</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">BLEValue</span><span class="o">::</span><span class="n">getData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">m_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="bledeviceinit">BLEDevice::init</h6>
<p><a href="./#btstart">btStart()</a><br />
<a href="../ESP-IDF/#esp_err_t">esp_err_t</a><br />
<a href="../ESP-IDF/#nvs_flash_init">nvs_flash_init</a><br />
<a href="../ESP-IDF/#esp_bt_controller_mem_release">esp_bt_controller_mem_release</a><br />
<a href="../ESP-IDF/#esp_bt_mode_t">esp_bt_mode_t</a><br />
<a href="../ESP-IDF/#esp_bt_controller_config_t">esp_bt_controller_config_t</a><br />
<a href="../ESP-IDF/#bt_controller_init_config_default">BT_CONTROLLER_INIT_CONFIG_DEFAULT</a><br />
<a href="../ESP-IDF/#esp_bt_controller_init">esp_bt_controller_init</a><br />
<a href="../ESP-IDF/#esp_bt_controller_enable">esp_bt_controller_enable</a><br />
<a href="../ESP-IDF/#esp_bluedroid_status_t">esp_bluedroid_status_t</a><br />
<a href="../ESP-IDF/#esp_bluedroid_get_status">esp_bluedroid_get_status</a><br />
<a href="../ESP-IDF/#esp_bluedroid_init">esp_bluedroid_init</a><br />
<a href="../ESP-IDF/#esp_bluedroid_enable">esp_bluedroid_enable</a><br />
<a href="../ESP-IDF/#esp_ble_gap_register_callback">esp_ble_gap_register_callback</a><br />
<a href="../ESP-IDF/#esp_ble_gattc_register_callback">esp_ble_gattc_register_callback</a><br />
<a href="../ESP-IDF/#esp_ble_gap_set_device_name">esp_ble_gap_set_device_name</a><br />
<a href="../ESP-IDF/#esp_ble_gap_set_security_param">esp_ble_gap_set_security_param</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="cm">/* STATIC */</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">BLEDevice::init</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">deviceName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">initialized</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="n">initialized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">  </span><span class="c1">// Set the initialization flag to ensure we are only initialized once.</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="cp">#ifdef ARDUINO_ARCH_ESP32</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">btStart</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">      </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_FAIL</span><span class="p">;</span><span class="w"> </span><span class="c1">//linked errRc; #define ESP_FAIL        -1</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="cp">#else</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="n">nvs_flash_init</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//#define ESP_OK 0</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;nvs_flash_init: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="cp">#ifndef CONFIG_BT_CLASSIC_ENABLED</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">    </span><span class="n">esp_bt_controller_mem_release</span><span class="p">(</span><span class="n">ESP_BT_MODE_CLASSIC_BT</span><span class="p">);</span><span class="w"> </span><span class="c1">// linked and (linked mode);</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="cp">#endif</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">    </span><span class="n">esp_bt_controller_config_t</span><span class="w"> </span><span class="n">bt_cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT_CONTROLLER_INIT_CONFIG_DEFAULT</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked and linked</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">    </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_bt_controller_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bt_cfg</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;esp_bt_controller_init: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="cp">#ifndef CONFIG_BT_CLASSIC_ENABLED</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">    </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_bt_controller_enable</span><span class="p">(</span><span class="n">ESP_BT_MODE_BLE</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;esp_bt_controller_enable: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="cp">#else</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="w">    </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_bt_controller_enable</span><span class="p">(</span><span class="n">ESP_BT_MODE_BTDM</span><span class="p">);</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;esp_bt_controller_enable: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="cp">#endif</span>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="cp">#endif</span>
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="w">    </span><span class="n">esp_bluedroid_status_t</span><span class="w"> </span><span class="n">bt_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_bluedroid_get_status</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked and linked</span>
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bt_state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BLUEDROID_STATUS_UNINITIALIZED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="w">      </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_bluedroid_init</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="w">        </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;esp_bluedroid_init: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>
</span><span id="__span-6-52"><a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bt_state</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_BLUEDROID_STATUS_ENABLED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-53"><a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="w">      </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_bluedroid_enable</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-6-54"><a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-55"><a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="w">        </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;esp_bluedroid_enable: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-6-56"><a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-57"><a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-6-58"><a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-59"><a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a>
</span><span id="__span-6-60"><a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="w">    </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_ble_gap_register_callback</span><span class="p">(</span><span class="n">BLEDevice</span><span class="o">::</span><span class="n">gapEventHandler</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-6-61"><a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-62"><a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;esp_ble_gap_register_callback: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-6-63"><a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-64"><a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-65"><a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a>
</span><span id="__span-6-66"><a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="cp">#ifdef CONFIG_GATTC_ENABLE  </span><span class="c1">// Check that BLE client is configured in make menuconfig</span>
</span><span id="__span-6-67"><a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a><span class="w">    </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_ble_gattc_register_callback</span><span class="p">(</span><span class="n">BLEDevice</span><span class="o">::</span><span class="n">gattClientEventHandler</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-6-68"><a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-69"><a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;esp_ble_gattc_register_callback: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-6-70"><a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-71"><a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-72"><a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a><span class="cp">#endif  </span><span class="c1">// CONFIG_GATTC_ENABLE</span>
</span><span id="__span-6-73"><a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a>
</span><span id="__span-6-74"><a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a><span class="cp">#ifdef CONFIG_GATTS_ENABLE  </span><span class="c1">// Check that BLE server is configured in make menuconfig</span>
</span><span id="__span-6-75"><a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a><span class="w">    </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_ble_gatts_register_callback</span><span class="p">(</span><span class="n">BLEDevice</span><span class="o">::</span><span class="n">gattServerEventHandler</span><span class="p">);</span>
</span><span id="__span-6-76"><a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-77"><a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;esp_ble_gatts_register_callback: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-6-78"><a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-79"><a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-80"><a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a><span class="cp">#endif  </span><span class="c1">// CONFIG_GATTS_ENABLE</span>
</span><span id="__span-6-81"><a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a>
</span><span id="__span-6-82"><a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a><span class="w">    </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="n">esp_ble_gap_set_device_name</span><span class="p">(</span><span class="n">deviceName</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-6-83"><a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-84"><a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;esp_ble_gap_set_device_name: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-6-85"><a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-86"><a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-6-87"><a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a>
</span><span id="__span-6-88"><a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a><span class="cp">#ifdef CONFIG_BLE_SMP_ENABLE  </span><span class="c1">// Check that BLE SMP (security) is configured in make menuconfig</span>
</span><span id="__span-6-89"><a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a><span class="w">    </span><span class="n">esp_ble_io_cap_t</span><span class="w"> </span><span class="n">iocap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_IO_CAP_NONE</span><span class="p">;</span>
</span><span id="__span-6-90"><a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a><span class="w">    </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="n">esp_ble_gap_set_security_param</span><span class="p">(</span><span class="n">ESP_BLE_SM_IOCAP_MODE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iocap</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">));</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-6-91"><a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-92"><a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;esp_ble_gap_set_security_param: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-6-93"><a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-6-94"><a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-6-95"><a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a><span class="cp">#endif  </span><span class="c1">// CONFIG_BLE_SMP_ENABLE</span>
</span><span id="__span-6-96"><a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-97"><a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a><span class="w">  </span><span class="n">vTaskDelay</span><span class="p">(</span><span class="mi">200</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">portTICK_PERIOD_MS</span><span class="p">);</span><span class="w">  </span><span class="c1">// Delay for 200 msecs as a workaround to an apparent Arduino environment issue.</span>
</span><span id="__span-6-98"><a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a><span class="p">}</span><span class="w">  </span><span class="c1">// init</span>
</span></code></pre></div></p>
<h6 id="btstart">btStart()</h6>
<p><a href="./#btstartmode">btStartMode()</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">btStart</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">btStartMode</span><span class="p">(</span><span class="n">BT_MODE</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="btstartmode">btStartMode()</h6>
<p><a href="../ESP-IDF/#esp_bt_controller_get_status">esp_bt_controller_get_status</a><br />
<a href="../ESP-IDF/#esp_err_to_name">esp_err_to_name</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">btStartMode</span><span class="p">(</span><span class="n">bt_mode</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="n">esp_bt_mode_t</span><span class="w"> </span><span class="n">esp_bt_mode</span><span class="p">;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="n">esp_bt_controller_config_t</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT_CONTROLLER_INIT_CONFIG_DEFAULT</span><span class="p">();</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="cp">#if CONFIG_IDF_TARGET_ESP32</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">BT_MODE_BLE</span><span class="p">:</span><span class="w">        </span><span class="n">esp_bt_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_BT_MODE_BLE</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">BT_MODE_CLASSIC_BT</span><span class="p">:</span><span class="w"> </span><span class="n">esp_bt_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_BT_MODE_CLASSIC_BT</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">BT_MODE_BTDM</span><span class="p">:</span><span class="w">       </span><span class="n">esp_bt_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_BT_MODE_BTDM</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w">                 </span><span class="n">esp_bt_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT_MODE</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">  </span><span class="c1">// esp_bt_controller_enable(MODE) This mode must be equal as the mode in &quot;cfg&quot; of esp_bt_controller_init().</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">  </span><span class="n">cfg</span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_bt_mode</span><span class="p">;</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BT_MODE_CLASSIC_BT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">    </span><span class="n">esp_bt_controller_mem_release</span><span class="p">(</span><span class="n">ESP_BT_MODE_BLE</span><span class="p">);</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="cp">#else</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">  </span><span class="c1">// other esp variants dont support BT-classic / DM.</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">  </span><span class="n">esp_bt_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BT_MODE</span><span class="p">;</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="cp">#endif</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">esp_bt_controller_get_status</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_ENABLED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">  </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">esp_bt_controller_get_status</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_IDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_bt_controller_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cfg</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;initialize controller failed: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">esp_err_to_name</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">esp_bt_controller_get_status</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_IDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">esp_bt_controller_get_status</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_INITED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_bt_controller_enable</span><span class="p">(</span><span class="n">esp_bt_mode</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;BT Enable mode=%d failed %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BT_MODE</span><span class="p">,</span><span class="w"> </span><span class="n">esp_err_to_name</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">esp_bt_controller_get_status</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_BT_CONTROLLER_STATUS_ENABLED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">  </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;BT Start failed&quot;</span><span class="p">);</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="bledevicecreateserver">BLEDevice::createServer()</h6>
<p><a href="./#bleserverbleserver">BLEServer::BLEServer()</a><br />
<a href="./#bleservercreateapp">BLEServer::createApp</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="cm">/**</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="cm"> * @brief Create a new instance of a server.</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="cm"> * @return A new instance of the server.</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="cm"> */</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="cm">/* STATIC */</span><span class="w"> </span><span class="n">BLEServer</span><span class="o">*</span><span class="w"> </span><span class="nf">BLEDevice::createServer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="n">ESP_LOGD</span><span class="p">(</span><span class="n">LOG_TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;&gt; createServer&quot;</span><span class="p">);</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="cp">#ifndef CONFIG_GATTS_ENABLE  </span><span class="c1">// Check that BLE GATTS is enabled in make menuconfig</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="n">ESP_LOGE</span><span class="p">(</span><span class="n">LOG_TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;BLE GATTS is not enabled - CONFIG_GATTS_ENABLE not defined&quot;</span><span class="p">);</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="n">abort</span><span class="p">();</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="cp">#endif </span><span class="c1">// CONFIG_GATTS_ENABLE</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">    </span><span class="n">m_pServer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BLEServer</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">    </span><span class="n">m_pServer</span><span class="o">-&gt;</span><span class="n">createApp</span><span class="p">(</span><span class="n">m_appId</span><span class="o">++</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">    </span><span class="n">ESP_LOGD</span><span class="p">(</span><span class="n">LOG_TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&lt;&lt; createServer&quot;</span><span class="p">);</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">m_pServer</span><span class="p">;</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="p">}</span><span class="w"> </span><span class="c1">// createServer</span>
</span></code></pre></div></p>
<h6 id="bleserverbleserver">BLEServer::BLEServer()</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">BLEServer</span><span class="o">::</span><span class="n">BLEServer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="n">m_appId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_GATT_IF_NONE</span><span class="p">;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="n">m_gatts_if</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_GATT_IF_NONE</span><span class="p">;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="n">m_connectedCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">  </span><span class="n">m_connId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_GATT_IF_NONE</span><span class="p">;</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="n">m_pServerCallbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="p">}</span><span class="w">  </span><span class="c1">// BLEServer</span>
</span></code></pre></div>
<h6 id="bleservercreateapp">BLEServer::createApp</h6>
<p><a href="./#bleserverregisterapp">BLEServer::registerApp</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEServer::createApp</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">appId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="n">m_appId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appId</span><span class="p">;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="n">registerApp</span><span class="p">(</span><span class="n">appId</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="p">}</span><span class="w">  </span><span class="c1">// createApp</span>
</span></code></pre></div></p>
<h6 id="bleserverregisterapp">BLEServer::registerApp</h6>
<p><a href="./#m_semaphoreregisterappevt">m_semaphoreRegisterAppEvt</a><br />
<a href="../ESP-IDF/#esp_ble_gatts_app_register">esp_ble_gatts_app_register</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEServer::registerApp</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">m_appId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&gt;&gt; registerApp - %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_appId</span><span class="p">);</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span><span class="n">m_semaphoreRegisterAppEvt</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="s">&quot;registerApp&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// Take the mutex, will be released by ESP_GATTS_REG_EVT event.</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span><span class="c1">//linked</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">  </span><span class="o">::</span><span class="n">esp_ble_gatts_app_register</span><span class="p">(</span><span class="n">m_appId</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">  </span><span class="n">m_semaphoreRegisterAppEvt</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="s">&quot;registerApp&quot;</span><span class="p">);</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; registerApp&quot;</span><span class="p">);</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="p">}</span><span class="w">  </span><span class="c1">// registerApp</span>
</span></code></pre></div></p>
<h6 id="m_semaphoreregisterappevt">m_semaphoreRegisterAppEvt</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">FreeRTOS</span><span class="o">::</span><span class="n">Semaphore</span><span class="w"> </span><span class="n">m_semaphoreRegisterAppEvt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FreeRTOS</span><span class="o">::</span><span class="n">Semaphore</span><span class="p">(</span><span class="s">&quot;RegisterAppEvt&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h6 id="setcallbacks">setCallbacks</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEServer::setCallbacks</span><span class="p">(</span><span class="n">BLEServerCallbacks</span><span class="w"> </span><span class="o">*</span><span class="n">pCallbacks</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="n">m_pServerCallbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCallbacks</span><span class="p">;</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// setCallbacks</span>
</span></code></pre></div>
<h6 id="server-createservice">server-&gt;createService</h6>
<p><a href="./#bleservercreateservice">BLEServer::createService</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="nf">BLEServer::createService</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">uuid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">createService</span><span class="p">(</span><span class="n">BLEUUID</span><span class="p">(</span><span class="n">uuid</span><span class="p">));</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="bleservercreateservice">BLEServer::createService</h6>
<p><a href="./#bleservicemap">BLEServiceMap</a><br />
<a href="./#bleservicemapgetbyuuid">BLEServiceMap::getByUUID</a><br />
<a href="./#bleservicebleservice">BLEService::BLEService</a><br />
<a href="./#bleservicemapsetbyuuid">BLEServiceMap::setByUUID</a><br />
<a href="./#bleserviceexecutecreate">executeCreate</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="nf">BLEServer::createService</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">numHandles</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">inst_id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&gt;&gt; createService - %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">uuid</span><span class="p">.</span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="n">m_semaphoreCreateEvt</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="s">&quot;createService&quot;</span><span class="p">);</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">  </span><span class="c1">// Check that a service with the supplied UUID does not already exist.</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_serviceMap</span><span class="p">.</span><span class="n">getByUUID</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//linked and linked</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="n">log_w</span><span class="p">(</span><span class="s">&quot;&lt;&lt; Attempt to create a new service with uuid %s but a service with that UUID already exists.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">uuid</span><span class="p">.</span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">  </span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="n">pService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BLEService</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="n">numHandles</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">  </span><span class="n">pService</span><span class="o">-&gt;</span><span class="n">m_instId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inst_id</span><span class="p">;</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">  </span><span class="n">m_serviceMap</span><span class="p">.</span><span class="n">setByUUID</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="n">pService</span><span class="p">);</span><span class="w">  </span><span class="c1">// Save a reference to this service being on this server. linked</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">  </span><span class="n">pService</span><span class="o">-&gt;</span><span class="n">executeCreate</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">           </span><span class="c1">// Perform the API calls to actually create the service. linked</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">  </span><span class="n">m_semaphoreCreateEvt</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="s">&quot;createService&quot;</span><span class="p">);</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; createService&quot;</span><span class="p">);</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">pService</span><span class="p">;</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="p">}</span><span class="w">  </span><span class="c1">// createService</span>
</span></code></pre></div></p>
<h6 id="bleservicebleservice">BLEService::BLEService</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">BLEService</span><span class="o">::</span><span class="n">BLEService</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">numHandles</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">BLEService</span><span class="p">(</span><span class="n">BLEUUID</span><span class="p">(</span><span class="n">uuid</span><span class="p">),</span><span class="w"> </span><span class="n">numHandles</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="cm">/**</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="cm"> * @brief Construct an instance of the BLEService</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="cm"> * @param [in] uuid The UUID of the service.</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="cm"> * @param [in] numHandles The maximum number of handles associated with the service.</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="cm"> */</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="n">BLEService</span><span class="o">::</span><span class="n">BLEService</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">numHandles</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">  </span><span class="n">m_uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uuid</span><span class="p">;</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">  </span><span class="n">m_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NULL_HANDLE</span><span class="p">;</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">  </span><span class="n">m_pServer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">  </span><span class="c1">//m_serializeMutex.setName(&quot;BLEService&quot;);</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">  </span><span class="n">m_lastCreatedCharacteristic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">  </span><span class="n">m_numHandles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numHandles</span><span class="p">;</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="p">}</span><span class="w">  </span><span class="c1">// BLEService</span>
</span></code></pre></div>
<h6 id="bleservicemap">BLEServiceMap</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">BLEServiceMap</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">  </span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="n">getByHandle</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">handle</span><span class="p">);</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">  </span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="nf">getByUUID</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">uuid</span><span class="p">);</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">  </span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="nf">getByUUID</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">inst_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleGATTServerEvent</span><span class="p">(</span><span class="n">esp_gatts_cb_event_t</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">esp_gatt_if_t</span><span class="w"> </span><span class="n">gatts_if</span><span class="p">,</span><span class="w"> </span><span class="n">esp_ble_gatts_cb_param_t</span><span class="w"> </span><span class="o">*</span><span class="n">param</span><span class="p">);</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">setByHandle</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="n">service</span><span class="p">);</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">setByUUID</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="n">service</span><span class="p">);</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">setByUUID</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="n">service</span><span class="p">);</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">();</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">  </span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="nf">getFirst</span><span class="p">();</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">  </span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="nf">getNext</span><span class="p">();</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">removeService</span><span class="p">(</span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="n">service</span><span class="p">);</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">getRegisteredServiceCount</span><span class="p">();</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">uint16_t</span><span class="p">,</span><span class="w"> </span><span class="n">BLEService</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_handleMap</span><span class="p">;</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_uuidMap</span><span class="p">;</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">m_iterator</span><span class="p">;</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="p">};</span>
</span></code></pre></div>
<h6 id="bleservicemapgetbyuuid">BLEServiceMap::getByUUID</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="nf">BLEServiceMap::getByUUID</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">uuid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">getByUUID</span><span class="p">(</span><span class="n">BLEUUID</span><span class="p">(</span><span class="n">uuid</span><span class="p">));</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="p">}</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="cm">/**</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="cm"> * @brief Return the service by UUID.</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="cm"> * @param [in] UUID The UUID to look up the service.</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="cm"> * @return The characteristic.</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="cm"> */</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="nf">BLEServiceMap::getByUUID</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">inst_id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">myPair</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_uuidMap</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">myPair</span><span class="p">.</span><span class="n">first</span><span class="o">-&gt;</span><span class="n">getUUID</span><span class="p">().</span><span class="n">equals</span><span class="p">(</span><span class="n">uuid</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">myPair</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">  </span><span class="c1">//return m_uuidMap.at(uuid.toString());</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="p">}</span><span class="w">  </span><span class="c1">// getByUUID</span>
</span></code></pre></div>
<h6 id="bleservicemapsetbyuuid">BLEServiceMap::setByUUID</h6>
<p><a href="./#stdmap">std::map</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEServiceMap::setByUUID</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="n">service</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">  </span><span class="n">m_uuidMap</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">uuid</span><span class="p">.</span><span class="n">toString</span><span class="p">()));</span><span class="w"> </span><span class="c1">// linked&lt;BLEService *, String&gt; m_uuidMap</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// setByUUID</span>
</span></code></pre></div></p>
<h6 id="stdmap">std::map</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_uuidMap</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="bleserviceexecutecreate">BLEService::executeCreate</h6>
<p><a href="../ESP-IDF/#esp_ble_gatts_create_service">esp_ble_gatts_create_service</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEService::executeCreate</span><span class="p">(</span><span class="n">BLEServer</span><span class="w"> </span><span class="o">*</span><span class="n">pServer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&gt;&gt; executeCreate() - Creating service (esp_ble_gatts_create_service) service uuid: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">getUUID</span><span class="p">().</span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">  </span><span class="n">m_pServer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pServer</span><span class="p">;</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">  </span><span class="n">m_semaphoreCreateEvt</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="s">&quot;executeCreate&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// Take the mutex and release at event ESP_GATTS_CREATE_EVT</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">  </span><span class="n">esp_gatt_srvc_id_t</span><span class="w"> </span><span class="n">srvc_id</span><span class="p">;</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">  </span><span class="n">srvc_id</span><span class="p">.</span><span class="n">is_primary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">  </span><span class="n">srvc_id</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">inst_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_instId</span><span class="p">;</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">  </span><span class="n">srvc_id</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">m_uuid</span><span class="p">.</span><span class="n">getNative</span><span class="p">();</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">  </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">    </span><span class="o">::</span><span class="n">esp_ble_gatts_create_service</span><span class="p">(</span><span class="n">getServer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getGattsIf</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">srvc_id</span><span class="p">,</span><span class="w"> </span><span class="n">m_numHandles</span><span class="p">);</span><span class="w">  </span><span class="c1">// The maximum number of handles associated with the service.</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="c1">//linked</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">    </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;esp_ble_gatts_create_service: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">  </span><span class="n">m_semaphoreCreateEvt</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="s">&quot;executeCreate&quot;</span><span class="p">);</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; executeCreate&quot;</span><span class="p">);</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="p">}</span><span class="w">  </span><span class="c1">// executeCreate</span>
</span></code></pre></div></p>
<h6 id="server-createcharacteristic">server-&gt;createCharacteristic</h6>
<p><a href="./#blecharacteristicblecharacteristic">BLECharacteristic::BLECharacteristic</a><br />
<a href="./#addcharacteristic">addCharacteristic</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="nf">BLEService::createCharacteristic</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">createCharacteristic</span><span class="p">(</span><span class="n">BLEUUID</span><span class="p">(</span><span class="n">uuid</span><span class="p">),</span><span class="w"> </span><span class="n">properties</span><span class="p">);</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="p">}</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="cm">/**</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="cm"> * @brief Create a new BLE Characteristic associated with this service.</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="cm"> * @param [in] uuid - The UUID of the characteristic.</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="cm"> * @param [in] properties - The properties of the characteristic.</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="cm"> * @return The new BLE characteristic.</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="cm"> */</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="nf">BLEService::createCharacteristic</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">  </span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BLECharacteristic</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">  </span><span class="n">addCharacteristic</span><span class="p">(</span><span class="n">pCharacteristic</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="p">;</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="p">}</span><span class="w">  </span><span class="c1">// createCharacteristic</span>
</span></code></pre></div></p>
<h6 id="blecharacteristicblecharacteristic">BLECharacteristic::BLECharacteristic</h6>
<p><a href="./#blecharacteristicsetbroadcastproperty">BLECharacteristic::setBroadcastProperty</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">BLECharacteristic</span><span class="o">::</span><span class="n">BLECharacteristic</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">  </span><span class="n">m_bleUUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uuid</span><span class="p">;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">  </span><span class="n">m_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NULL_HANDLE</span><span class="p">;</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">  </span><span class="n">m_properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">esp_gatt_char_prop_t</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">  </span><span class="n">m_pCallbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">defaultCallback</span><span class="p">;</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">  </span><span class="n">setBroadcastProperty</span><span class="p">((</span><span class="n">properties</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">PROPERTY_BROADCAST</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">  </span><span class="n">setReadProperty</span><span class="p">((</span><span class="n">properties</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">PROPERTY_READ</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">  </span><span class="n">setWriteProperty</span><span class="p">((</span><span class="n">properties</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">PROPERTY_WRITE</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w">  </span><span class="n">setNotifyProperty</span><span class="p">((</span><span class="n">properties</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">PROPERTY_NOTIFY</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">  </span><span class="n">setIndicateProperty</span><span class="p">((</span><span class="n">properties</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">PROPERTY_INDICATE</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">  </span><span class="n">setWriteNoResponseProperty</span><span class="p">((</span><span class="n">properties</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">PROPERTY_WRITE_NR</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="p">}</span><span class="w">  </span><span class="c1">// BLECharacteristic</span>
</span></code></pre></div></p>
<h6 id="addcharacteristic">addCharacteristic</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEService::addCharacteristic</span><span class="p">(</span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="c1">// We maintain a mapping of characteristics owned by this service.  These are managed by the</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="c1">// BLECharacteristicMap class instance found in m_characteristicMap.  We add the characteristic</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">  </span><span class="c1">// to the map and then ask the service to add the characteristic at the BLE level (ESP-IDF).</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&gt;&gt; addCharacteristic()&quot;</span><span class="p">);</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;Adding characteristic: uuid=%s to service: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">getUUID</span><span class="p">().</span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">  </span><span class="c1">// Check that we don&#39;t add the same characteristic twice.</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_characteristicMap</span><span class="p">.</span><span class="n">getByUUID</span><span class="p">(</span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">getUUID</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">    </span><span class="n">log_w</span><span class="p">(</span><span class="s">&quot;&lt;&lt; Adding a new characteristic with the same UUID as a previous one&quot;</span><span class="p">);</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">    </span><span class="c1">//return;</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">  </span><span class="c1">// Remember this characteristic in our map of characteristics.  At this point, we can lookup by UUID</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">  </span><span class="c1">// but not by handle.  The handle is allocated to us on the ESP_GATTS_ADD_CHAR_EVT.</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">  </span><span class="n">m_characteristicMap</span><span class="p">.</span><span class="n">setByUUID</span><span class="p">(</span><span class="n">pCharacteristic</span><span class="p">,</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">getUUID</span><span class="p">());</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; addCharacteristic()&quot;</span><span class="p">);</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="p">}</span><span class="w">  </span><span class="c1">// addCharacteristic</span>
</span></code></pre></div>
<h6 id="blecharacteristicsetbroadcastproperty">BLECharacteristic::setBroadcastProperty</h6>
<p><a href="../ESP-IDF/#esp_gatt_char_prop_t">esp_gatt_char_prop_t</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLECharacteristic::setBroadcastProperty</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="c1">//log_d(&quot;setBroadcastProperty(%d)&quot;, value);</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="n">m_properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">esp_gatt_char_prop_t</span><span class="p">)(</span><span class="n">m_properties</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ESP_GATT_CHAR_PROP_BIT_BROADCAST</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked m_properties;</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">    </span><span class="n">m_properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">esp_gatt_char_prop_t</span><span class="p">)(</span><span class="n">m_properties</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">ESP_GATT_CHAR_PROP_BIT_BROADCAST</span><span class="p">);</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="p">}</span><span class="w">  </span><span class="c1">// setBroadcastProperty</span>
</span></code></pre></div></p>
<h6 id="ble2902">BLE2902()</h6>
<p><a href="./#bledescriptorsetvalue">BLEDescriptor::setValue</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">BLE2902</span><span class="o">::</span><span class="n">BLE2902</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">BLEDescriptor</span><span class="p">(</span><span class="n">BLEUUID</span><span class="p">((</span><span class="kt">uint16_t</span><span class="p">)</span><span class="mh">0x2902</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">};</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span><span class="n">setValue</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="p">}</span><span class="w">  </span><span class="c1">// BLE2902</span>
</span></code></pre></div></p>
<h6 id="bledescriptorsetvalue">BLEDescriptor::setValue</h6>
<p><a href="../ESP-IDF/#esp_attr_value_t">esp_attr_value_t</a><br />
<a href="../ESP-IDF/#esp_ble_gatts_set_attr_value">esp_ble_gatts_set_attr_value</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEDescriptor::setValue</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ESP_GATT_MAX_ATTR_LEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;Size %d too large, must be no bigger than %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">ESP_GATT_MAX_ATTR_LEN</span><span class="p">);</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">  </span><span class="n">m_value</span><span class="p">.</span><span class="n">attr_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="c1">//linked m_value;</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">  </span><span class="n">memcpy</span><span class="p">(</span><span class="n">m_value</span><span class="p">.</span><span class="n">attr_value</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_handle</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NULL_HANDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">    </span><span class="n">esp_ble_gatts_set_attr_value</span><span class="p">(</span><span class="n">m_handle</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">    </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;Set the value in the GATTS database using handle 0x%x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_handle</span><span class="p">);</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="p">}</span><span class="w">  </span><span class="c1">// setValue</span>
</span></code></pre></div></p>
<h6 id="setnotifications">setNotifications()</h6>
<p><a href="./#bledescriptorgetvalue">BLEDescriptor::getValue()</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLE2902::setNotifications</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">pValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getValue</span><span class="p">();</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">    </span><span class="n">pValue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">    </span><span class="n">pValue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">  </span><span class="n">setValue</span><span class="p">(</span><span class="n">pValue</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="p">}</span><span class="w">  </span><span class="c1">// setNotifications</span>
</span></code></pre></div></p>
<h6 id="bledescriptorgetvalue">BLEDescriptor::getValue()</h6>
<p><a href="../ESP-IDF/#esp_attr_value_t">esp_attr_value_t</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="nf">BLEDescriptor::getValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">m_value</span><span class="p">.</span><span class="n">attr_value</span><span class="p">;</span><span class="w"> </span><span class="c1">//linked m_value;</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// getValue</span>
</span></code></pre></div></p>
<h6 id="adddescriptor">addDescriptor()</h6>
<p><a href="./#stdmap">std::map</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLECharacteristic::addDescriptor</span><span class="p">(</span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="n">pDescriptor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="c1">//BLEDescriptor is the parent class of BLE2902</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&gt;&gt; addDescriptor(): Adding %s to %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pDescriptor</span><span class="o">-&gt;</span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">  </span><span class="n">m_descriptorMap</span><span class="p">.</span><span class="n">setByUUID</span><span class="p">(</span><span class="n">pDescriptor</span><span class="o">-&gt;</span><span class="n">getUUID</span><span class="p">(),</span><span class="w"> </span><span class="n">pDescriptor</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">  </span><span class="c1">//linked&lt;std::string, BLERemoteDescriptor *&gt; m_descriptorMap;</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; addDescriptor()&quot;</span><span class="p">);</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="p">}</span><span class="w">  </span><span class="c1">// addDescriptor</span>
</span></code></pre></div></p>
<h6 id="stdmap_1">std::map</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">BLERemoteDescriptor</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_descriptorMap</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="blecharacteristic-setvalue">BLECharacteristic-&gt;setValue()</h6>
<p><a href="./#blecharacteristicsetvalue">BLECharacteristic::setValue</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLECharacteristic::setValue</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">  </span><span class="n">setValue</span><span class="p">((</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">value</span><span class="p">.</span><span class="n">c_str</span><span class="p">()),</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">length</span><span class="p">());</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// setValue</span>
</span></code></pre></div></p>
<h6 id="blecharacteristicsetvalue">BLECharacteristic::setValue</h6>
<p><a href="./#blevalue">BLEValue</a><br />
<a href="./#blevaluesetvalue">BLEValue::setValue</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLECharacteristic::setValue</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="c1">// The call to BLEUtils::buildHexData() doesn&#39;t output anything if the log level is not</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="c1">// &quot;VERBOSE&quot;. As it is quite CPU intensive, it is much better to not call it if not needed.</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="cp">#if ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_VERBOSE</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">pHex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLEUtils</span><span class="o">::</span><span class="n">buildHexData</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&gt;&gt; setValue: length=%d, data=%s, characteristic UUID=%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">pHex</span><span class="p">,</span><span class="w"> </span><span class="n">getUUID</span><span class="p">().</span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">pHex</span><span class="p">);</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="cp">#endif</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ESP_GATT_MAX_ATTR_LEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">    </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;Size %d too large, must be no bigger than %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">ESP_GATT_MAX_ATTR_LEN</span><span class="p">);</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">  </span><span class="n">m_semaphoreSetValue</span><span class="p">.</span><span class="n">take</span><span class="p">();</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">  </span><span class="n">m_value</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked m_value; and linked</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w">  </span><span class="n">m_semaphoreSetValue</span><span class="p">.</span><span class="n">give</span><span class="p">();</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; setValue&quot;</span><span class="p">);</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="p">}</span><span class="w">  </span><span class="c1">// setValue</span>
</span></code></pre></div></p>
<h6 id="blevaluesetvalue">BLEValue::setValue</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEValue::setValue</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">  </span><span class="n">m_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// setValue</span>
</span></code></pre></div>
<h6 id="bleservice-start">BLEservice-&gt;start()</h6>
<p><a href="./#blecharacteristicmap">BLECharacteristicMap</a><br />
<a href="./#blecharacteristicmapgetfirst">BLECharacteristicMap::getFirst()</a><br />
<a href="./#blecharacteristicexecutecreate">BLECharacteristic::executeCreate</a><br />
<a href="./#blecharacteristicmapgetnext">BLECharacteristicMap::getNext</a><br />
<a href="../ESP-IDF/#esp_ble_gatts_start_service">esp_ble_gatts_start_service</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEService::start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">  </span><span class="c1">// We ask the BLE runtime to start the service and then create each of the characteristics.</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">  </span><span class="c1">// We start the service through its local handle which was returned in the ESP_GATTS_CREATE_EVT event</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">  </span><span class="c1">// obtained as a result of calling esp_ble_gatts_create_service().</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">  </span><span class="c1">//</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&gt;&gt; start(): Starting service (esp_ble_gatts_start_service): %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_handle</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NULL_HANDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">    </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;&lt;&lt; !!! We attempted to start a service but don&#39;t know its handle!&quot;</span><span class="p">);</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">  </span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_characteristicMap</span><span class="p">.</span><span class="n">getFirst</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked m_characteristicMap; and linked</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">pCharacteristic</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">    </span><span class="n">m_lastCreatedCharacteristic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="p">;</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="w">    </span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">executeCreate</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="w">    </span><span class="n">pCharacteristic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_characteristicMap</span><span class="p">.</span><span class="n">getNext</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="w">  </span><span class="c1">// Start each of the characteristics ... these are found in the m_characteristicMap.</span>
</span><span id="__span-36-21"><a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a>
</span><span id="__span-36-22"><a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a><span class="w">  </span><span class="n">m_semaphoreStartEvt</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="s">&quot;start&quot;</span><span class="p">);</span>
</span><span id="__span-36-23"><a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a><span class="w">  </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="n">esp_ble_gatts_start_service</span><span class="p">(</span><span class="n">m_handle</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-36-24"><a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a>
</span><span id="__span-36-25"><a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-26"><a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a><span class="w">    </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;&lt;&lt; esp_ble_gatts_start_service: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-36-27"><a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-36-28"><a id="__codelineno-36-28" name="__codelineno-36-28" href="#__codelineno-36-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-36-29"><a id="__codelineno-36-29" name="__codelineno-36-29" href="#__codelineno-36-29"></a><span class="w">  </span><span class="n">m_semaphoreStartEvt</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="s">&quot;start&quot;</span><span class="p">);</span>
</span><span id="__span-36-30"><a id="__codelineno-36-30" name="__codelineno-36-30" href="#__codelineno-36-30"></a>
</span><span id="__span-36-31"><a id="__codelineno-36-31" name="__codelineno-36-31" href="#__codelineno-36-31"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; start()&quot;</span><span class="p">);</span>
</span><span id="__span-36-32"><a id="__codelineno-36-32" name="__codelineno-36-32" href="#__codelineno-36-32"></a><span class="p">}</span><span class="w">  </span><span class="c1">// start</span>
</span></code></pre></div></p>
<h6 id="blecharacteristicexecutecreate">BLECharacteristic::executeCreate</h6>
<p><a href="../ESP-IDF/#esp_attr_control_t">esp_attr_control_t</a><br />
<a href="../ESP-IDF/#esp_gatt_perm_t">esp_gatt_perm_t</a><br />
<a href="./#bledescriptorbledescriptor">BLEDescriptor::BLEDescriptor</a><br />
<a href="./#bledescriptormap">BLEDescriptorMap</a><br />
<a href="./#bledescriptorexecutecreate">BLEDescriptor::executeCreate</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLECharacteristic::executeCreate</span><span class="p">(</span><span class="n">BLEService</span><span class="w"> </span><span class="o">*</span><span class="n">pService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&gt;&gt; executeCreate()&quot;</span><span class="p">);</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_handle</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NULL_HANDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">    </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;Characteristic already has a handle.&quot;</span><span class="p">);</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="w">  </span><span class="n">m_pService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pService</span><span class="p">;</span><span class="w">  </span><span class="c1">// Save the service to which this characteristic belongs.</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;Registering characteristic (esp_ble_gatts_add_char): uuid: %s, service: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">getUUID</span><span class="p">().</span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">m_pService</span><span class="o">-&gt;</span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="w">  </span><span class="n">esp_attr_control_t</span><span class="w"> </span><span class="n">control</span><span class="p">;</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="w">  </span><span class="n">control</span><span class="p">.</span><span class="n">auto_rsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_GATT_RSP_BY_APP</span><span class="p">;</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a><span class="w">  </span><span class="n">m_semaphoreCreateEvt</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="s">&quot;executeCreate&quot;</span><span class="p">);</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="w">  </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="n">esp_ble_gatts_add_char</span><span class="p">(</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="w">    </span><span class="n">m_pService</span><span class="o">-&gt;</span><span class="n">getHandle</span><span class="p">(),</span><span class="w"> </span><span class="n">getUUID</span><span class="p">().</span><span class="n">getNative</span><span class="p">(),</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">esp_gatt_perm_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_permissions</span><span class="p">),</span><span class="w"> </span><span class="n">getProperties</span><span class="p">(),</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a><span class="w">    </span><span class="o">&amp;</span><span class="n">control</span>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a><span class="w">  </span><span class="p">);</span><span class="w">  </span><span class="c1">// Whether to auto respond or not.</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a><span class="w">  </span><span class="c1">//linked</span>
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a>
</span><span id="__span-37-23"><a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-24"><a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a><span class="w">    </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;&lt;&lt; esp_ble_gatts_add_char: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-37-25"><a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-37-26"><a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-37-27"><a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a><span class="w">  </span><span class="n">m_semaphoreCreateEvt</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="s">&quot;executeCreate&quot;</span><span class="p">);</span>
</span><span id="__span-37-28"><a id="__codelineno-37-28" name="__codelineno-37-28" href="#__codelineno-37-28"></a>
</span><span id="__span-37-29"><a id="__codelineno-37-29" name="__codelineno-37-29" href="#__codelineno-37-29"></a><span class="w">  </span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="n">pDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_descriptorMap</span><span class="p">.</span><span class="n">getFirst</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked and linked m_descriptorMap;</span>
</span><span id="__span-37-30"><a id="__codelineno-37-30" name="__codelineno-37-30" href="#__codelineno-37-30"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">pDescriptor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-31"><a id="__codelineno-37-31" name="__codelineno-37-31" href="#__codelineno-37-31"></a><span class="w">    </span><span class="n">pDescriptor</span><span class="o">-&gt;</span><span class="n">executeCreate</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-37-32"><a id="__codelineno-37-32" name="__codelineno-37-32" href="#__codelineno-37-32"></a><span class="w">    </span><span class="n">pDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_descriptorMap</span><span class="p">.</span><span class="n">getNext</span><span class="p">();</span>
</span><span id="__span-37-33"><a id="__codelineno-37-33" name="__codelineno-37-33" href="#__codelineno-37-33"></a><span class="w">  </span><span class="p">}</span><span class="w">  </span><span class="c1">// End while</span>
</span><span id="__span-37-34"><a id="__codelineno-37-34" name="__codelineno-37-34" href="#__codelineno-37-34"></a>
</span><span id="__span-37-35"><a id="__codelineno-37-35" name="__codelineno-37-35" href="#__codelineno-37-35"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; executeCreate&quot;</span><span class="p">);</span>
</span><span id="__span-37-36"><a id="__codelineno-37-36" name="__codelineno-37-36" href="#__codelineno-37-36"></a><span class="p">}</span><span class="w">  </span><span class="c1">// executeCreate</span>
</span></code></pre></div></p>
<h6 id="bledescriptorexecutecreate">BLEDescriptor::executeCreate</h6>
<p><a href="../ESP-IDF/#esp_ble_gatts_add_char_descr">esp_ble_gatts_add_char_descr</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEDescriptor::executeCreate</span><span class="p">(</span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&gt;&gt; executeCreate(): %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_handle</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NULL_HANDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">    </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;Descriptor already has a handle.&quot;</span><span class="p">);</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">  </span><span class="n">m_pCharacteristic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="p">;</span><span class="w">  </span><span class="c1">// Save the characteristic associated with this service.</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="w">  </span><span class="n">esp_attr_control_t</span><span class="w"> </span><span class="n">control</span><span class="p">;</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="w">  </span><span class="n">control</span><span class="p">.</span><span class="n">auto_rsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_GATT_AUTO_RSP</span><span class="p">;</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="w">  </span><span class="n">m_semaphoreCreateEvt</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="s">&quot;executeCreate&quot;</span><span class="p">);</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="w">  </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="w">    </span><span class="o">::</span><span class="n">esp_ble_gatts_add_char_descr</span><span class="p">(</span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">getService</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getHandle</span><span class="p">(),</span><span class="w"> </span><span class="n">getUUID</span><span class="p">().</span><span class="n">getNative</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="n">esp_gatt_perm_t</span><span class="p">)</span><span class="n">m_permissions</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_value</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">control</span><span class="p">);</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="w">    </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;&lt;&lt; esp_ble_gatts_add_char_descr: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a><span class="w">  </span><span class="n">m_semaphoreCreateEvt</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="s">&quot;executeCreate&quot;</span><span class="p">);</span>
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; executeCreate&quot;</span><span class="p">);</span>
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a><span class="p">}</span><span class="w">  </span><span class="c1">// executeCreate</span>
</span></code></pre></div></p>
<h6 id="bledescriptormap">BLEDescriptorMap</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">BLEDescriptorMap</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">setByUUID</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="n">pDescriptor</span><span class="p">);</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">setByUUID</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="n">pDescriptor</span><span class="p">);</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">setByHandle</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="n">pDescriptor</span><span class="p">);</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">  </span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="nf">getByUUID</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">uuid</span><span class="p">);</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">  </span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="nf">getByUUID</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">);</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">  </span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="nf">getByHandle</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">handle</span><span class="p">);</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">();</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleGATTServerEvent</span><span class="p">(</span><span class="n">esp_gatts_cb_event_t</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">esp_gatt_if_t</span><span class="w"> </span><span class="n">gatts_if</span><span class="p">,</span><span class="w"> </span><span class="n">esp_ble_gatts_cb_param_t</span><span class="w"> </span><span class="o">*</span><span class="n">param</span><span class="p">);</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">  </span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="nf">getFirst</span><span class="p">();</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="w">  </span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="nf">getNext</span><span class="p">();</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_uuidMap</span><span class="p">;</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">uint16_t</span><span class="p">,</span><span class="w"> </span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_handleMap</span><span class="p">;</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">m_iterator</span><span class="p">;</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="p">};</span>
</span></code></pre></div>
<h6 id="bledescriptorbledescriptor">BLEDescriptor::BLEDescriptor</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">BLEDescriptor</span><span class="o">::</span><span class="n">BLEDescriptor</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">max_len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span><span class="n">m_bleUUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uuid</span><span class="p">;</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">  </span><span class="n">m_value</span><span class="p">.</span><span class="n">attr_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">            </span><span class="c1">// Initial length is 0.</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">  </span><span class="n">m_value</span><span class="p">.</span><span class="n">attr_max_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_len</span><span class="p">;</span><span class="w">  </span><span class="c1">// Maximum length of the data.</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">  </span><span class="n">m_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NULL_HANDLE</span><span class="p">;</span><span class="w">          </span><span class="c1">// Handle is initially unknown.</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">  </span><span class="n">m_pCharacteristic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w">     </span><span class="c1">// No initial characteristic.</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">  </span><span class="n">m_pCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w">           </span><span class="c1">// No initial callback.</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">  </span><span class="n">m_value</span><span class="p">.</span><span class="n">attr_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">max_len</span><span class="p">);</span><span class="w">  </span><span class="c1">// Allocate storage for the value.</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="p">}</span><span class="w">  </span><span class="c1">// BLEDescriptor</span>
</span></code></pre></div>
<h6 id="blecharacteristicmap">BLECharacteristicMap</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">BLECharacteristicMap</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">setByUUID</span><span class="p">(</span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">uuid</span><span class="p">);</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">setByUUID</span><span class="p">(</span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">,</span><span class="w"> </span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">);</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">setByHandle</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">);</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">  </span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="nf">getByUUID</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">uuid</span><span class="p">);</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">  </span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="nf">getByUUID</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">uuid</span><span class="p">);</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">  </span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="nf">getByHandle</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">handle</span><span class="p">);</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">  </span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="nf">getFirst</span><span class="p">();</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">  </span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="nf">getNext</span><span class="p">();</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">();</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleGATTServerEvent</span><span class="p">(</span><span class="n">esp_gatts_cb_event_t</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">esp_gatt_if_t</span><span class="w"> </span><span class="n">gatts_if</span><span class="p">,</span><span class="w"> </span><span class="n">esp_ble_gatts_cb_param_t</span><span class="w"> </span><span class="o">*</span><span class="n">param</span><span class="p">);</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_uuidMap</span><span class="p">;</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">uint16_t</span><span class="p">,</span><span class="w"> </span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_handleMap</span><span class="p">;</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">m_iterator</span><span class="p">;</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="p">};</span>
</span></code></pre></div>
<h6 id="blecharacteristicmapgetfirst">BLECharacteristicMap::getFirst()</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="nf">BLECharacteristicMap::getFirst</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">  </span><span class="n">m_iterator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_uuidMap</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_iterator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m_uuidMap</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">  </span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pRet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_iterator</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">  </span><span class="n">m_iterator</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">pRet</span><span class="p">;</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="p">}</span><span class="w">  </span><span class="c1">// getFirst</span>
</span></code></pre></div>
<h6 id="blecharacteristicmapgetnext">BLECharacteristicMap::getNext</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="nf">BLECharacteristicMap::getNext</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_iterator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m_uuidMap</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//std::map&lt;BLECharacteristic *, String&gt; m_uuidMap;</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">  </span><span class="n">BLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pRet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_iterator</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">  </span><span class="n">m_iterator</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">pRet</span><span class="p">;</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="p">}</span><span class="w">  </span><span class="c1">// getNext</span>
</span></code></pre></div>
<h6 id="bledevicegetadvertising">BLEDevice::getAdvertising</h6>
<p><a href="./#bleadvertisingbleadvertising">BLEAdvertising::BLEAdvertising()</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">BLEAdvertising</span><span class="w"> </span><span class="o">*</span><span class="nf">BLEDevice::getAdvertising</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_bleAdvertising</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">    </span><span class="n">m_bleAdvertising</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BLEAdvertising</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">    </span><span class="n">log_i</span><span class="p">(</span><span class="s">&quot;create advertising&quot;</span><span class="p">);</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;get advertising&quot;</span><span class="p">);</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">m_bleAdvertising</span><span class="p">;</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="bleadvertisingbleadvertising">BLEAdvertising::BLEAdvertising()</h6>
<p><a href="../ESP-IDF/#esp_ble_adv_data_type">esp_ble_adv_data_t</a><br />
<a href="../ESP-IDF/#esp_ble_adv_params_t">esp_ble_adv_params_t</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">BLEAdvertising</span><span class="o">::</span><span class="n">BLEAdvertising</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_scanRespData</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">set_scan_rsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">//linked m_advData;</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">include_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">include_txpower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">min_interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x20</span><span class="p">;</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">max_interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x40</span><span class="p">;</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">appearance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00</span><span class="p">;</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">manufacturer_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">p_manufacturer_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">service_data_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">p_service_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">service_uuid_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">p_service_uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ESP_BLE_ADV_FLAG_GEN_DISC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ESP_BLE_ADV_FLAG_BREDR_NOT_SPT</span><span class="p">);</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="w">  </span><span class="n">m_advParams</span><span class="p">.</span><span class="n">adv_int_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x20</span><span class="p">;</span><span class="w"> </span><span class="c1">//linked m_advParams;</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="w">  </span><span class="n">m_advParams</span><span class="p">.</span><span class="n">adv_int_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x40</span><span class="p">;</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="w">  </span><span class="n">m_advParams</span><span class="p">.</span><span class="n">adv_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ADV_TYPE_IND</span><span class="p">;</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="w">  </span><span class="n">m_advParams</span><span class="p">.</span><span class="n">own_addr_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLE_ADDR_TYPE_PUBLIC</span><span class="p">;</span>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="w">  </span><span class="n">m_advParams</span><span class="p">.</span><span class="n">channel_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ADV_CHNL_ALL</span><span class="p">;</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a><span class="w">  </span><span class="n">m_advParams</span><span class="p">.</span><span class="n">adv_filter_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ADV_FILTER_ALLOW_SCAN_ANY_CON_ANY</span><span class="p">;</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a><span class="w">  </span><span class="n">m_advParams</span><span class="p">.</span><span class="n">peer_addr_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLE_ADDR_TYPE_PUBLIC</span><span class="p">;</span>
</span><span id="__span-45-23"><a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a>
</span><span id="__span-45-24"><a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a><span class="w">  </span><span class="n">m_customAdvData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">           </span><span class="c1">// No custom advertising data</span>
</span><span id="__span-45-25"><a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a><span class="w">  </span><span class="n">m_customScanResponseData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// No custom scan response data</span>
</span><span id="__span-45-26"><a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="p">}</span><span class="w">  </span><span class="c1">// BLEAdvertising</span>
</span></code></pre></div></p>
<h6 id="bleadvertising-addserviceuuid">BLEAdvertising-&gt;addServiceUUID()</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEAdvertising::addServiceUUID</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">serviceUUID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">  </span><span class="n">m_serviceUUIDs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">serviceUUID</span><span class="p">);</span><span class="w"> </span><span class="c1">//std::vector&lt;BLEUUID&gt; m_serviceUUIDs;</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// addServiceUUID</span>
</span></code></pre></div>
<h6 id="bleservice-getuuid">BLEService-&gt;getUUID()</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">BLEUUID</span><span class="w"> </span><span class="nf">BLEService::getUUID</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">m_uuid</span><span class="p">;</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// getUUID</span>
</span></code></pre></div>
<h6 id="bleadvertising-setscanresponse">BLEAdvertising-&gt;setScanResponse()</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEAdvertising::setScanResponse</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">set</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">  </span><span class="n">m_scanResp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set</span><span class="p">;</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="p">}</span>
</span></code></pre></div>
<h6 id="bleadvertising-setminmaxpreferred">BLEAdvertising-&gt;setMin/MaxPreferred()</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEAdvertising::setMinPreferred</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">mininterval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">min_interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mininterval</span><span class="p">;</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">//</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEAdvertising::setMaxPreferred</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">maxinterval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">  </span><span class="n">m_advData</span><span class="p">.</span><span class="n">max_interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxinterval</span><span class="p">;</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="p">}</span><span class="w">  </span><span class="c1">//</span>
</span></code></pre></div>
<h6 id="bledevicestartadvertising">BLEDevice::startAdvertising()</h6>
<p><a href="./#bledevicegetadvertising">BLEDevice::getAdvertising</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLEDevice::startAdvertising</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&gt;&gt; startAdvertising&quot;</span><span class="p">);</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">  </span><span class="n">getAdvertising</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; startAdvertising&quot;</span><span class="p">);</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="p">}</span><span class="w">  </span><span class="c1">// startAdvertising</span>
</span></code></pre></div></p>
<h6 id="bledevicegetadvertising_1">BLEDevice::getAdvertising</h6>
<p><a href="./#bleadvertisingbleadvertising">BLEAdvertising::BLEAdvertising()</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="n">BLEAdvertising</span><span class="w"> </span><span class="o">*</span><span class="nf">BLEDevice::getAdvertising</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_bleAdvertising</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">    </span><span class="n">m_bleAdvertising</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BLEAdvertising</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">    </span><span class="n">log_i</span><span class="p">(</span><span class="s">&quot;create advertising&quot;</span><span class="p">);</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">  </span><span class="n">log_d</span><span class="p">(</span><span class="s">&quot;get advertising&quot;</span><span class="p">);</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">m_bleAdvertising</span><span class="p">;</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="p">}</span>
</span></code></pre></div></p>
<h6 id="blecharacteristic-notify">BLECharacteristic-&gt;notify()</h6>
<p><a href="./#blecharacteristicgetdescriptorbyuuid">BLECharacteristic::getDescriptorByUUID</a><br />
<a href="./#ble2902getnotifications">BLE2902::getNotifications</a><br />
<a href="./#ble2902getindications">BLE2902::getIndications</a><br />
<a href="./#bleservergetpeerdevices">BLEServer::getPeerDevices</a><br />
<a href="../ESP-IDF/#esp_ble_gatts_send_indicate">esp_ble_gatts_send_indicate</a><br />
<a href="../ESP-IDF/#esp_gatt_status_t">esp_gatt_status_t</a>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">BLECharacteristic::notify</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">is_notification</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&gt;&gt; notify: length: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_value</span><span class="p">.</span><span class="n">getValue</span><span class="p">().</span><span class="n">length</span><span class="p">());</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">getService</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">getService</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getServer</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="w">  </span><span class="n">m_pCallbacks</span><span class="o">-&gt;</span><span class="n">onNotify</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">  </span><span class="c1">// Invoke the notify callback.</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="w">  </span><span class="c1">// GeneralUtils::hexDump() doesn&#39;t output anything if the log level is not</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="w">  </span><span class="c1">// &quot;VERBOSE&quot;. Additionally, it is very CPU intensive, even when it doesn&#39;t</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="w">  </span><span class="c1">// output anything! So it is much better to *not* call it at all if not needed.</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="w">  </span><span class="c1">// In a simple program which calls BLECharacteristic::notify() every 50 ms,</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="w">  </span><span class="c1">// the performance gain of this little optimization is 37% in release mode</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="w">  </span><span class="c1">// (-O3) and 57% in debug mode.</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="w">  </span><span class="c1">// Of course, the &quot;#if ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_VERBOSE&quot; guard</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="w">  </span><span class="c1">// could also be put inside the GeneralUtils::hexDump() function itself. But</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="w">  </span><span class="c1">// it&#39;s better to put it here also, as it is clearer (indicating a verbose log</span>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="w">  </span><span class="c1">// thing) and it allows to remove the &quot;m_value.getValue().c_str()&quot; call, which</span>
</span><span id="__span-52-19"><a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a><span class="w">  </span><span class="c1">// is, in itself, quite CPU intensive.</span>
</span><span id="__span-52-20"><a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="cp">#if ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_VERBOSE</span>
</span><span id="__span-52-21"><a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a><span class="w">  </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">hexDump</span><span class="p">((</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">m_value</span><span class="p">.</span><span class="n">getValue</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">m_value</span><span class="p">.</span><span class="n">getValue</span><span class="p">().</span><span class="n">length</span><span class="p">());</span>
</span><span id="__span-52-22"><a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="cp">#endif</span>
</span><span id="__span-52-23"><a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a>
</span><span id="__span-52-24"><a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getService</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getServer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getConnectedCount</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-25"><a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a><span class="w">    </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; notify: No connected clients.&quot;</span><span class="p">);</span>
</span><span id="__span-52-26"><a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a><span class="w">    </span><span class="n">m_pCallbacks</span><span class="o">-&gt;</span><span class="n">onStatus</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">BLECharacteristicCallbacks</span><span class="o">::</span><span class="n">Status</span><span class="o">::</span><span class="n">ERROR_NO_CLIENT</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-52-27"><a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-52-28"><a id="__codelineno-52-28" name="__codelineno-52-28" href="#__codelineno-52-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-52-29"><a id="__codelineno-52-29" name="__codelineno-52-29" href="#__codelineno-52-29"></a>
</span><span id="__span-52-30"><a id="__codelineno-52-30" name="__codelineno-52-30" href="#__codelineno-52-30"></a><span class="w">  </span><span class="c1">// Test to see if we have a 0x2902 descriptor.  If we do, then check to see if notification is enabled</span>
</span><span id="__span-52-31"><a id="__codelineno-52-31" name="__codelineno-52-31" href="#__codelineno-52-31"></a><span class="w">  </span><span class="c1">// and, if not, prevent the notification.</span>
</span><span id="__span-52-32"><a id="__codelineno-52-32" name="__codelineno-52-32" href="#__codelineno-52-32"></a>
</span><span id="__span-52-33"><a id="__codelineno-52-33" name="__codelineno-52-33" href="#__codelineno-52-33"></a><span class="w">  </span><span class="n">BLE2902</span><span class="w"> </span><span class="o">*</span><span class="n">p2902</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BLE2902</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">getDescriptorByUUID</span><span class="p">((</span><span class="kt">uint16_t</span><span class="p">)</span><span class="mh">0x2902</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-52-34"><a id="__codelineno-52-34" name="__codelineno-52-34" href="#__codelineno-52-34"></a><span class="w">  </span><span class="c1">//linked</span>
</span><span id="__span-52-35"><a id="__codelineno-52-35" name="__codelineno-52-35" href="#__codelineno-52-35"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_notification</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-36"><a id="__codelineno-52-36" name="__codelineno-52-36" href="#__codelineno-52-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p2902</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">p2902</span><span class="o">-&gt;</span><span class="n">getNotifications</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-52-37"><a id="__codelineno-52-37" name="__codelineno-52-37" href="#__codelineno-52-37"></a><span class="w">    </span><span class="c1">//linked</span>
</span><span id="__span-52-38"><a id="__codelineno-52-38" name="__codelineno-52-38" href="#__codelineno-52-38"></a><span class="w">      </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; notifications disabled; ignoring&quot;</span><span class="p">);</span>
</span><span id="__span-52-39"><a id="__codelineno-52-39" name="__codelineno-52-39" href="#__codelineno-52-39"></a><span class="w">      </span><span class="n">m_pCallbacks</span><span class="o">-&gt;</span><span class="n">onStatus</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">BLECharacteristicCallbacks</span><span class="o">::</span><span class="n">Status</span><span class="o">::</span><span class="n">ERROR_NOTIFY_DISABLED</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Invoke the notify callback.</span>
</span><span id="__span-52-40"><a id="__codelineno-52-40" name="__codelineno-52-40" href="#__codelineno-52-40"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-52-41"><a id="__codelineno-52-41" name="__codelineno-52-41" href="#__codelineno-52-41"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-42"><a id="__codelineno-52-42" name="__codelineno-52-42" href="#__codelineno-52-42"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-43"><a id="__codelineno-52-43" name="__codelineno-52-43" href="#__codelineno-52-43"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p2902</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">p2902</span><span class="o">-&gt;</span><span class="n">getIndications</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-52-44"><a id="__codelineno-52-44" name="__codelineno-52-44" href="#__codelineno-52-44"></a><span class="w">      </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; indications disabled; ignoring&quot;</span><span class="p">);</span>
</span><span id="__span-52-45"><a id="__codelineno-52-45" name="__codelineno-52-45" href="#__codelineno-52-45"></a><span class="w">      </span><span class="n">m_pCallbacks</span><span class="o">-&gt;</span><span class="n">onStatus</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">BLECharacteristicCallbacks</span><span class="o">::</span><span class="n">Status</span><span class="o">::</span><span class="n">ERROR_INDICATE_DISABLED</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Invoke the notify callback.</span>
</span><span id="__span-52-46"><a id="__codelineno-52-46" name="__codelineno-52-46" href="#__codelineno-52-46"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-52-47"><a id="__codelineno-52-47" name="__codelineno-52-47" href="#__codelineno-52-47"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-48"><a id="__codelineno-52-48" name="__codelineno-52-48" href="#__codelineno-52-48"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-52-49"><a id="__codelineno-52-49" name="__codelineno-52-49" href="#__codelineno-52-49"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">myPair</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">getService</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getServer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getPeerDevices</span><span class="p">(</span><span class="nb">false</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-52-50"><a id="__codelineno-52-50" name="__codelineno-52-50" href="#__codelineno-52-50"></a><span class="w">  </span><span class="c1">// linked</span>
</span><span id="__span-52-51"><a id="__codelineno-52-51" name="__codelineno-52-51" href="#__codelineno-52-51"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">_mtu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">myPair</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">mtu</span><span class="p">);</span>
</span><span id="__span-52-52"><a id="__codelineno-52-52" name="__codelineno-52-52" href="#__codelineno-52-52"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_value</span><span class="p">.</span><span class="n">getValue</span><span class="p">().</span><span class="n">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">_mtu</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-53"><a id="__codelineno-52-53" name="__codelineno-52-53" href="#__codelineno-52-53"></a><span class="w">      </span><span class="n">log_w</span><span class="p">(</span><span class="s">&quot;- Truncating to %d bytes (maximum notify size)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_mtu</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
</span><span id="__span-52-54"><a id="__codelineno-52-54" name="__codelineno-52-54" href="#__codelineno-52-54"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-55"><a id="__codelineno-52-55" name="__codelineno-52-55" href="#__codelineno-52-55"></a>
</span><span id="__span-52-56"><a id="__codelineno-52-56" name="__codelineno-52-56" href="#__codelineno-52-56"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_value</span><span class="p">.</span><span class="n">getValue</span><span class="p">().</span><span class="n">length</span><span class="p">();</span>
</span><span id="__span-52-57"><a id="__codelineno-52-57" name="__codelineno-52-57" href="#__codelineno-52-57"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">is_notification</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// is indication</span>
</span><span id="__span-52-58"><a id="__codelineno-52-58" name="__codelineno-52-58" href="#__codelineno-52-58"></a><span class="w">      </span><span class="n">m_semaphoreConfEvt</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="s">&quot;indicate&quot;</span><span class="p">);</span>
</span><span id="__span-52-59"><a id="__codelineno-52-59" name="__codelineno-52-59" href="#__codelineno-52-59"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-60"><a id="__codelineno-52-60" name="__codelineno-52-60" href="#__codelineno-52-60"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">errRc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="n">esp_ble_gatts_send_indicate</span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-52-61"><a id="__codelineno-52-61" name="__codelineno-52-61" href="#__codelineno-52-61"></a><span class="w">    </span><span class="c1">//linked</span>
</span><span id="__span-52-62"><a id="__codelineno-52-62" name="__codelineno-52-62" href="#__codelineno-52-62"></a><span class="w">      </span><span class="n">getService</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getServer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getGattsIf</span><span class="p">(),</span><span class="w"> </span><span class="n">myPair</span><span class="p">.</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">getHandle</span><span class="p">(),</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">m_value</span><span class="p">.</span><span class="n">getValue</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="o">!</span><span class="n">is_notification</span>
</span><span id="__span-52-63"><a id="__codelineno-52-63" name="__codelineno-52-63" href="#__codelineno-52-63"></a><span class="w">    </span><span class="p">);</span><span class="w">  </span><span class="c1">// The need_confirm = false makes this a notify.</span>
</span><span id="__span-52-64"><a id="__codelineno-52-64" name="__codelineno-52-64" href="#__codelineno-52-64"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errRc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ESP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-65"><a id="__codelineno-52-65" name="__codelineno-52-65" href="#__codelineno-52-65"></a><span class="w">      </span><span class="n">log_e</span><span class="p">(</span><span class="s">&quot;&lt;&lt; esp_ble_gatts_send_ %s: rc=%d %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">is_notification</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;notify&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;indicate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">,</span><span class="w"> </span><span class="n">GeneralUtils</span><span class="o">::</span><span class="n">errorToString</span><span class="p">(</span><span class="n">errRc</span><span class="p">));</span>
</span><span id="__span-52-66"><a id="__codelineno-52-66" name="__codelineno-52-66" href="#__codelineno-52-66"></a><span class="w">      </span><span class="n">m_semaphoreConfEvt</span><span class="p">.</span><span class="n">give</span><span class="p">();</span>
</span><span id="__span-52-67"><a id="__codelineno-52-67" name="__codelineno-52-67" href="#__codelineno-52-67"></a><span class="w">      </span><span class="n">m_pCallbacks</span><span class="o">-&gt;</span><span class="n">onStatus</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">BLECharacteristicCallbacks</span><span class="o">::</span><span class="n">Status</span><span class="o">::</span><span class="n">ERROR_GATT</span><span class="p">,</span><span class="w"> </span><span class="n">errRc</span><span class="p">);</span><span class="w">  </span><span class="c1">// Invoke the notify callback.</span>
</span><span id="__span-52-68"><a id="__codelineno-52-68" name="__codelineno-52-68" href="#__codelineno-52-68"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-52-69"><a id="__codelineno-52-69" name="__codelineno-52-69" href="#__codelineno-52-69"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-70"><a id="__codelineno-52-70" name="__codelineno-52-70" href="#__codelineno-52-70"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">is_notification</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// is indication</span>
</span><span id="__span-52-71"><a id="__codelineno-52-71" name="__codelineno-52-71" href="#__codelineno-52-71"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">m_semaphoreConfEvt</span><span class="p">.</span><span class="n">timedWait</span><span class="p">(</span><span class="s">&quot;indicate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">indicationTimeout</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-72"><a id="__codelineno-52-72" name="__codelineno-52-72" href="#__codelineno-52-72"></a><span class="w">        </span><span class="n">m_pCallbacks</span><span class="o">-&gt;</span><span class="n">onStatus</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">BLECharacteristicCallbacks</span><span class="o">::</span><span class="n">Status</span><span class="o">::</span><span class="n">ERROR_INDICATE_TIMEOUT</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Invoke the notify callback.</span>
</span><span id="__span-52-73"><a id="__codelineno-52-73" name="__codelineno-52-73" href="#__codelineno-52-73"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-74"><a id="__codelineno-52-74" name="__codelineno-52-74" href="#__codelineno-52-74"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">esp_gatt_status_t</span><span class="p">)</span><span class="n">m_semaphoreConfEvt</span><span class="p">.</span><span class="n">value</span><span class="p">();</span><span class="w"> </span><span class="c1">//linked</span>
</span><span id="__span-52-75"><a id="__codelineno-52-75" name="__codelineno-52-75" href="#__codelineno-52-75"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_GATT_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-76"><a id="__codelineno-52-76" name="__codelineno-52-76" href="#__codelineno-52-76"></a><span class="w">          </span><span class="n">m_pCallbacks</span><span class="o">-&gt;</span><span class="n">onStatus</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">BLECharacteristicCallbacks</span><span class="o">::</span><span class="n">Status</span><span class="o">::</span><span class="n">SUCCESS_INDICATE</span><span class="p">,</span><span class="w"> </span><span class="n">code</span><span class="p">);</span><span class="w">  </span><span class="c1">// Invoke the notify callback.</span>
</span><span id="__span-52-77"><a id="__codelineno-52-77" name="__codelineno-52-77" href="#__codelineno-52-77"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-78"><a id="__codelineno-52-78" name="__codelineno-52-78" href="#__codelineno-52-78"></a><span class="w">          </span><span class="n">m_pCallbacks</span><span class="o">-&gt;</span><span class="n">onStatus</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">BLECharacteristicCallbacks</span><span class="o">::</span><span class="n">Status</span><span class="o">::</span><span class="n">ERROR_INDICATE_FAILURE</span><span class="p">,</span><span class="w"> </span><span class="n">code</span><span class="p">);</span>
</span><span id="__span-52-79"><a id="__codelineno-52-79" name="__codelineno-52-79" href="#__codelineno-52-79"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-52-80"><a id="__codelineno-52-80" name="__codelineno-52-80" href="#__codelineno-52-80"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-52-81"><a id="__codelineno-52-81" name="__codelineno-52-81" href="#__codelineno-52-81"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-82"><a id="__codelineno-52-82" name="__codelineno-52-82" href="#__codelineno-52-82"></a><span class="w">      </span><span class="n">m_pCallbacks</span><span class="o">-&gt;</span><span class="n">onStatus</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">BLECharacteristicCallbacks</span><span class="o">::</span><span class="n">Status</span><span class="o">::</span><span class="n">SUCCESS_NOTIFY</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Invoke the notify callback.</span>
</span><span id="__span-52-83"><a id="__codelineno-52-83" name="__codelineno-52-83" href="#__codelineno-52-83"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-84"><a id="__codelineno-52-84" name="__codelineno-52-84" href="#__codelineno-52-84"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-52-85"><a id="__codelineno-52-85" name="__codelineno-52-85" href="#__codelineno-52-85"></a><span class="w">  </span><span class="n">log_v</span><span class="p">(</span><span class="s">&quot;&lt;&lt; notify&quot;</span><span class="p">);</span>
</span><span id="__span-52-86"><a id="__codelineno-52-86" name="__codelineno-52-86" href="#__codelineno-52-86"></a><span class="p">}</span><span class="w">  </span><span class="c1">// Notify</span>
</span></code></pre></div></p>
<h6 id="blecharacteristicgetdescriptorbyuuid">BLECharacteristic::getDescriptorByUUID</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">BLEDescriptor</span><span class="w"> </span><span class="o">*</span><span class="nf">BLECharacteristic::getDescriptorByUUID</span><span class="p">(</span><span class="n">BLEUUID</span><span class="w"> </span><span class="n">descriptorUUID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">m_descriptorMap</span><span class="p">.</span><span class="n">getByUUID</span><span class="p">(</span><span class="n">descriptorUUID</span><span class="p">);</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// getDescriptorByUUID</span>
</span></code></pre></div>
<h6 id="ble2902getnotifications">BLE2902::getNotifications</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">BLE2902::getNotifications</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// getNotifications</span>
</span></code></pre></div>
<h6 id="ble2902getindications">BLE2902::getIndications</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">BLE2902::getIndications</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="p">}</span><span class="w">  </span><span class="c1">// getIndications</span>
</span></code></pre></div>
<h6 id="bleservergetpeerdevices">BLEServer::getPeerDevices</h6>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">uint16_t</span><span class="p">,</span><span class="w"> </span><span class="n">conn_status_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">BLEServer</span><span class="o">::</span><span class="n">getPeerDevices</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">_client</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">m_connectedServersMap</span><span class="p">;</span><span class="w"> </span><span class="c1">//std::map&lt;uint16_t, conn_status_t&gt; m_connectedServersMap;</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="p">}</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>